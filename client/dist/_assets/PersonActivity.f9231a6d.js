import{d as e,z as t,I as n,U as a,P as i,F as o,f as r,T as s,n as l,u,i as d,S as p,e as v,M as c,C as m,_ as y}from"./index.60247fbf.js";import{s as h}from"./page.5682baa0.js";function g(e){if(!e)return"";const t=Math.floor(e/60).toString();return 30===e?"½ hour":60===e?"1 hour":e%60!=0?`${t}½ hours`:`${t} hours`}const f=e({name:"PersonActivityEvent",props:{event:{type:Object,required:!0},typesColumn:{type:Boolean,required:!0}},setup:e=>(t((()=>e.event),(()=>{e.event.minutes||!e.event.canEdit||e.event.canViewType||(e.event.type=e.event.placeholder?"Volunteer":"Absent")}),{immediate:!0}),function(){const t=`${e.event.placeholder?e.event.date.substr(0,7):e.event.date} ${e.event.name}`;return n(o,[n("div",{class:"person-activity-label"},t),e.typesColumn&&e.event.minutes?n(a,{class:"person-activity-type",value:e.event.placeholder?"Volunteer":e.event.type,disabled:!e.event.canViewType||!e.event.canEdit||e.event.placeholder,onUpdate:t=>e.event.type=t}):e.typesColumn?n("div"):null,e.event.canEdit?n(i,{class:"person-activity-hours",modelValue:(e.event.minutes/60).toString(),type:"number",min:"0",step:"0.5","onUpdate:modelValue":t=>{e.event.minutes=60*parseFloat(t),isNaN(e.event.minutes)&&(e.event.minutes=0)}}):n("div",{class:"person-activity-hours"},g(e.event.minutes))])})}),b=e({name:"PersonActivity",props:{onLoadPerson:{type:Function,required:!0}},setup(e){const t=l(),a=u(),i=d("me");h({title:"Volunteer Activity",browserTitle:"Activity"});const o=r(),c=r(!1),g=r(!1);async function f(e){e.preventDefault();const n=new FormData;o.value.events.forEach((e=>{e.canEdit&&n.append(`e${e.id}`,`${e.minutes}:${e.type}`)})),await y.post(`/api/people/${t.params.id}/hours/${t.params.month}`,n),i.value?a.push(`/people/${i.value.id}`):g.value=!0}return s((async()=>{if(t.params.month)if("current"!==t.params.month)try{o.value=(await y.get(`/api/people/${t.params.id}/hours/${t.params.month}`)).data,h({title:o.value.name,browserTitle:"Activity"}),o.value.canHours=!0,e.onLoadPerson(o.value)}catch(e){if(e.response&&403===e.response.status&&!i.value&&a.replace({path:"/login",query:{redirect:t.fullPath}}),!e.response||404!==e.response.status||i.value)throw e;c.value=!0}else{const e=m(),n=e.date()<=10?e.subtract(1,"month"):e;a.replace(`/people/${t.params.id}/activity/${n.format("YYYY-MM")}`)}})),function(){if(c.value)return n("div",{id:"person-activity"},[n("div","The link you used is not valid or has expired."),n("div",{style:"margin-top: 1.5rem"},[n(p,{to:"/login",variant:"primary"},"Go to Login Page")])]);if(g.value)return n("div",{id:"person-activity"},[n("div","Your volunteer hours have been saved. Thank you for volunteering!"),n("div",{style:"margin-top: 1.5rem"},[n(p,{to:"/login",variant:"primary"},"Go to Login Page")])]);if(!o.value)return n("div",{id:"person-activity"},n(v));if(o.value.needsVolgistics&&(!i.value||i.value.id===o.value.id))return n("div",{id:"person-activity-unregistered"},["You are not currently registered as a City of Sunnyvale volunteer. We appreciate your volunteer efforts, but we cannot record your hours until you are registered. To do so, please fill out ",n("a",{href:"https://www.volgistics.com/ex/portal.dll/ap?AP=929478828",target:"_blank"},"this form"),". In the “City employee status or referral” box, please enter",n("pre","Rebecca Elizondo\nDepartment of Public Safety"),"and the names of the organizations you’re volunteering for (CERT, Listos, SARES, and/or SNAP). Come back a week or so later and we should have your registration on file. If you have any difficulties with this, please contact Rebecca at ",n("a",{href:"mailto:RElizondo@sunnyvale.ca.gov"},"RElizondo@sunnyvale.ca.gov"),"."]);const e=o.value.events.some((e=>e.canEdit));return n(e?"form":"div",{id:"person-activity",onSubmit:f},[R(t,a),S(o.value.events),e?E(!!i.value,a):null,e?n("table",{id:"person-activity-guide"},[n("tr",[n("td","Volunteer Hours"),n("td","Not Volunteer Hours")]),n("tr",[n("td","In general, time you spend helping or preparing to help the community as part of SERV. For example:"),n("td","In general, time you spend preparing yourself or your household; or time you spend becoming a SERV volunteer. For example:")]),n("tr",[n("td","Organizing or teaching CERT Basic, Listos, PEP, or SNAP events"),n("td","Attending CERT Basic, Listos, PEP, or ham cram classes")]),n("tr",[n("td","Preparing and maintaining a CERT or SARES “go kit” for deployment"),n("td","Preparing and maintaining a personal or household evacuation kit")]),n("tr",[n("td","SERV team meetings, radio nets, and drills; CERT continuing education seminars; SARES or county ARES training classes"),n("td","SERV team social gatherings")]),n("tr",[n("td","Responding in an emergency when activated by the city"),n("td","Responding in an emergency when not activated by the city")]),n("tr",[n("td","Travel to and from the above"),n("td")]),n("tr",[n("td","SERV administration activities"),n("td")])]):null])}}});function E(e,t){return n("div",{id:"person-activity-buttons"},[n(p,{type:"submit",variant:"primary"},(()=>"Save Activity")),e?n(p,{onClick:function(){t.go(-1)}},(()=>"Cancel")):null])}function w(e){const t=e.reduce(((e,t)=>e+t.minutes),0),a=e.reduce(((e,t)=>e+(t.minutes?1:0)),0),i=e.some((e=>e.canViewType));return a>1?[n("div",{id:"person-activity-total-label"},"TOTAL"),i?n("div"):null,n("div",{style:"person-activity-total"},g(t))]:null}function S(e){if(!e.length)return n("div","No activity has been recorded for this month.");const t=e.some((e=>e.canEdit)),a=e.some((e=>e.canViewType));e.reduce(((e,t)=>e+t.minutes),0);return n("div",{id:"person-activity-grid",class:{"person-activity-editable":t,"person-activity-with-types":a}},[n("div",{style:"font-weight: bold"},"Event"),a?n("div",{style:"font-weight: bold"},"Type"):null,n("div",{style:"font-weight: bold"},"Hours"),e.map((e=>n(f,{event:e,typesColumn:a}))),w(e)])}function R(e,t){return n("div",{id:"person-activity-month"},n(c,{modelValue:e.params.month,"onUpdate:modelValue":n=>{t.replace(`/people/${e.params.id}/activity/${n}`)}}))}export default b;
