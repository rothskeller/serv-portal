let e=document.createElement("style");e.innerHTML="#files-addf-progress,#files-editf-progress{margin:0 .75rem}.files-doc{display:flex;align-items:center;min-height:0;min-width:0}.files-doc-icon{height:1rem;width:1.5rem;margin-right:.25rem;flex:none}.files-doc-link{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.files-folder{display:flex;align-items:center;min-height:0;min-width:0}.files-folder-icon{flex:none;height:1rem;width:1.5rem;margin-right:.25rem}.files-folder-link{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.files-trash{display:flex;align-items:center;min-height:0;min-width:0;color:red;margin-top:1.5rem}.files-trash-icon{flex:none;height:1rem;width:1.5rem;margin-right:.25rem}.files-trash-text{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#files{margin:1.5rem .75rem;display:grid;grid:auto-flow -webkit-min-content/fit-content(100%);grid:auto-flow min-content/fit-content(100%);position:relative}.files-progress{position:absolute;top:-1.5rem;left:-.75rem;right:-.75rem}.files-item{transition:opacity .5s,height .5s,margin-left .5s;height:1.5rem}.files-enter-from,.files-leave-to{opacity:0;height:0}#files-buttons{margin-top:1.5rem}#files-buttons .sbtn{margin-right:.5rem}",document.head.appendChild(e);import{d as a,v as l,k as n,P as t,Q as o,f as r,A as s,_ as i,r as d,c as u,o as c,w as f,a as p,h as m,l as v,M as h,e as g,n as w,F as y,R as b,t as S,z as F,j as T,i as k,b as D,s as E,S as x,p as L,u as M,g as C,T as R}from"./index.c4f95515.js";import{s as $}from"./page.af55116f.js";import A from"./NotFound.cb2794df.js";var O=a({components:{Modal:l,SForm:n,SFFile:t,SProgress:o},setup(){const e=r(null);let a="";const l=r(null),n=r("");s(l,(()=>{n.value=""}));const t=r(!1);const o=r(0);function d(e){e.lengthComputable&&e.total&&(o.value=e.loaded/e.total)}return{files:l,filesError:function(e,a){if(!a)return"";if(!l.value||!l.value.length)return"Select the file(s) to be added.";for(let e=0;e<l.value.length;e++){const a=l.value.item(e);if(!a.name||"."===a.name[0]||a.name.includes(":")||a.name.includes("/"))return`“${a.name}” is not a legal file name.`}return n.value?n.value:""},modal:e,onCancel:function(){e.value.close(!1)},onSubmit:async function(){const r=new FormData;t.value=!0;try{for(let e=0;e<l.value.length;e++)r.append("name",l.value.item(e).name);await i.post(`/api/folders${a}?op=checkNames`,r),r.delete("name");for(let e=0;e<l.value.length;e++)r.append("file",l.value.item(e));await i.post(`/api/folders${a}?op=newFiles`,r,{onUploadProgress:d}),e.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;n.value=e.response.data}finally{t.value=!1,o.value=0}},progress:o,show:function(l){return a=l,e.value.show()},submitting:t}}});O.render=function(e,a,l,n,t,o){const r=d("SFFile"),s=d("SProgress"),i=d("SForm"),v=d("Modal");return c(),u(v,{ref:"modal"},{default:f((()=>[p(i,{dialog:"",variant:"primary",title:"Add Files",submitLabel:"Add",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:f((()=>[p(r,{id:"files-addf-files",label:"File(s)",multiple:"",modelValue:e.files,"onUpdate:modelValue":a[1]||(a[1]=a=>e.files=a),errorFn:e.filesError},null,8,["modelValue","errorFn"]),e.progress?(c(),u(s,{key:0,class:"form-item",id:"files-addf-progress",value:e.progress},null,8,["value"])):m("",!0)])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var V=a({components:{Modal:l,SForm:n,SFFile:t,SFInput:v,SProgress:o},setup(){const e=r(null);let a="",l="";const n=r("");const t=r(null),o=r("");const s=r(null),d=r(!1);const u=r(0);function c(e){e.lengthComputable&&e.total&&(u.value=e.loaded/e.total)}return{file:s,modal:e,nameError:function(e){return e?n.value?"."===n.value[0]||n.value.includes(":")||n.value.includes("/")?"This is not a legal file name.":n.value===o.value?"This name is already in use.":"":"The file name is required.":""},nameRef:t,newName:n,onCancel:function(){e.value.close(!1)},onSubmit:async function(){const t=new FormData;d.value=!0;try{t.append("name",n.value),s.value&&s.value.length&&t.append("file",s.value.item(0)),await i.post(`/api/document${a}/${encodeURIComponent(l)}?op=editFile`,t,{onUploadProgress:c}),e.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;o.value=n.value}finally{d.value=!1,u.value=0}},progress:u,show:function(o,r){return a=o,l=n.value=r,console.log("newName",r),h((()=>{h((()=>{t.value.focus()}))})),e.value.show()},submitting:d}}});V.render=function(e,a,l,n,t,o){const r=d("SFInput"),s=d("SFFile"),i=d("SProgress"),v=d("SForm"),h=d("Modal");return c(),u(h,{ref:"modal"},{default:f((()=>[p(v,{dialog:"",variant:"primary",title:"Edit File",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:f((()=>[p(r,{id:"files-editf-name",ref:"nameRef",label:"Name",trim:"",modelValue:e.newName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.newName=a),errorFn:e.nameError},null,8,["modelValue","errorFn"]),p(s,{id:"files-editf-file",label:"File",modelValue:e.file,"onUpdate:modelValue":a[2]||(a[2]=a=>e.file=a)},null,8,["modelValue"]),e.progress?(c(),u(i,{key:0,class:"form-item",id:"files-editf-progress",value:e.progress},null,8,["value"])):m("",!0)])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var I=a({components:{Modal:l,SForm:n,SFInput:v,SSpinner:g},setup(){const e=r(null),a=r(""),l=r("");const n=r({}),t=r(!0);const o=r(null),s=r("");const d=w((()=>l.value?"Edit Link":"Add Link")),u=w((()=>l.value?"Save":"Add")),c=r(!1);return{link:n,loading:t,modal:e,nameError:function(e){return e?n.value.name?n.value.name===s.value?"This name is already in use.":"":"The link name is required.":""},nameRef:o,onCancel:function(){e.value.close(!1)},onSubmit:async function(){var t=new FormData;t.append("name",n.value.name),t.append("url",n.value.url),c.value=!0;try{l.value?await i.post(`/api/document${a.value}/${encodeURIComponent(l.value)}?op=editLink`,t):await i.post(`/api/folders${a.value}?op=newLink`,t),e.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;s.value=n.value.name}finally{c.value=!1}},showAdd:function(l){return a.value=l,n.value={name:"",url:""},t.value=!1,h((()=>{h((()=>{o.value.focus()}))})),e.value.show()},showEdit:function(r,s){return a.value=r,l.value=s,async function(){t.value=!0,n.value=(await i.get(`/api/document${a.value}/${encodeURIComponent(l.value)}?op=edit`)).data,t.value=!1,h((()=>{o.value.focus()}))}(),e.value.show()},submitLabel:u,submitting:c,title:d,urlError:function(e){return e?n.value.url?n.value.url.startsWith("http://")||n.value.url.startsWith("https://")?"":"The link URL must start with http:// or https://.":"The link URL is required.":""}}}});I.render=function(e,a,l,n,t,o){const r=d("SSpinner"),s=d("SFInput"),i=d("SForm"),m=d("Modal");return c(),u(m,{ref:"modal"},{default:f((()=>[p(i,{dialog:"",variant:"primary",title:e.title,submitLabel:e.submitLabel,disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:f((()=>[e.loading?(c(),u(r,{key:0})):(c(),u(y,{key:1},[p(s,{id:"files-editl-name",ref:"nameRef",label:"Name",trim:"",modelValue:e.link.name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.link.name=a),errorFn:e.nameError},null,8,["modelValue","errorFn"]),p(s,{id:"files-editl-url",label:"URL",trim:"",modelValue:e.link.url,"onUpdate:modelValue":a[2]||(a[2]=a=>e.link.url=a),errorFn:e.urlError},null,8,["modelValue","errorFn"])],64))])),_:1},8,["title","submitLabel","disabled","onSubmit","onCancel"])])),_:1},512)};var N=a({components:{FilesEditFile:V,FilesEditLink:I,SIcon:b},props:{folder:{type:Object,required:!0},doc:{type:Object,required:!0},indent:{type:Number,required:!0}},emits:["reload","showTrash"],setup(e,{emit:a}){const l=w((()=>!e.doc.url.startsWith("/"))),n=w((()=>i.value&&e.folder.canEdit?"edit":l.value?"link":e.doc.name.endsWith(".pdf")?"pdf":e.doc.name.endsWith(".docx")||e.doc.name.endsWith(".doc")?"word":e.doc.name.endsWith(".pptx")||e.doc.name.endsWith(".ppt")?"powerpoint":e.doc.name.endsWith(".xlsx")||e.doc.name.endsWith(".xls")?"excel":e.doc.name.endsWith(".jpeg")||e.doc.name.endsWith(".jpg")||e.doc.name.endsWith(".png")?"image":"file")),t=w((()=>i.value&&e.folder.canEdit?{color:"blue"}:null)),o=w((()=>({marginLeft:1.5*e.indent+"em"}))),s=w((()=>e.doc.newtab?"_blank":null));const i=r(!1),d=r(null),u=r(null);return{editFileModal:d,editLinkModal:u,icon:n,iconStyle:t,indentStyle:o,onDragEnd:function(){a("showTrash",!1)},onDragStart:function(n){if(!e.folder.canEdit)return;n.dataTransfer.setData("x-serv-document",JSON.stringify({name:e.doc.name,url:`${e.folder.url}/${encodeURIComponent(e.doc.name)}`,type:l.value?"link":"file"}));const t=l.value?e.doc.url:"https://sunnyvaleserv.org"+e.doc.url;n.dataTransfer.setData("text/uri-list",`${t}\r\n# ${e.doc.name}`),n.dataTransfer.setData("text/plain",t),a("showTrash",!0)},onEdit:async function(){e.folder.canEdit&&(l.value?await u.value.showEdit(e.folder.url,e.doc.name)&&a("reload"):await d.value.show(e.folder.url,e.doc.name)&&a("reload"))},onMouseOver:function(){i.value=!0},onMouseOut:function(){i.value=!1},target:s}}});N.render=function(e,a,l,n,t,o){const r=d("SIcon"),s=d("FilesEditFile"),i=d("FilesEditLink");return c(),u("div",{class:"files-doc",style:e.indentStyle,draggable:"folder.canEdit",onDragstart:a[1]||(a[1]=(...a)=>e.onDragStart(...a)),onDragend:a[2]||(a[2]=(...a)=>e.onDragEnd(...a)),onMouseover:a[3]||(a[3]=(...a)=>e.onMouseOver(...a)),onMouseout:a[4]||(a[4]=(...a)=>e.onMouseOut(...a))},[p(r,{class:"files-doc-icon",icon:e.icon,style:e.iconStyle,onClick:e.onEdit},null,8,["icon","style","onClick"]),p("a",{class:"files-doc-link",href:e.doc.url,target:e.target,draggable:"false",textContent:S(e.doc.name)},null,8,["href","target","textContent"]),e.folder.canEdit?(c(),u(s,{key:0,ref:"editFileModal"},null,512)):m("",!0),e.folder.canEdit?(c(),u(i,{key:1,ref:"editLinkModal"},null,512)):m("",!0)],36)};const P={public:"Public",serv:"SERV Volunteers",admin:"SERV Leads","cert-d":"CERT Deployment Teams","cert-t":"CERT Training Committee",listos:"Listos Team",sares:"SARES Members",snap:"SNAP Team"};var U=a({components:{Modal:l,SForm:n,SFInput:v,SFSelect:F,SSpinner:g},setup(){const e=r(null);let a,l;const n=r({}),t=r([]);async function o(){n.value=(await i.get(`/api/folders${a}?op=${l}`)).data,t.value=n.value.allowedVisibilities.map((e=>({value:e,label:P[e]}))),h((()=>{s.value.focus()}))}const s=r(null),d=r("");const u=w((()=>"newFolder"===l?"Add Folder":"Edit Folder")),c=w((()=>"newFolder"===l?"Add":"Save")),f=r(!1);return{folder:n,modal:e,nameError:function(e){return e?n.value.name?n.value.name===d.value?"This name is already in use.":"":"The folder name is required.":""},nameRef:s,onCancel:function(){e.value.close(!1)},onSubmit:async function(){f.value=!0;const t=new FormData;t.append("name",n.value.name),t.append("visibility",n.value.visibility);try{const n=(await i.post(`/api/folders${a}?op=${l}`,t)).data;e.value.close(n||!0)}catch(e){if(!e.response||409!=e.response.status)throw e;d.value=n.value.name}finally{f.value=!1}},showAdd:function(n){return a=n,l="newFolder",o(),e.value.show()},showEdit:function(n){return a=n,l="editFolder",o(),e.value.show()},submitLabel:c,submitting:f,title:u,visibilities:t}}});U.render=function(e,a,l,n,t,o){const r=d("SSpinner"),s=d("SFInput"),i=d("SFSelect"),m=d("SForm"),v=d("Modal");return c(),u(v,{ref:"modal"},{default:f((()=>[p(m,{dialog:"",variant:"primary",title:e.title,submitLabel:e.submitLabel,disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:f((()=>[e.visibilities.length?(c(),u(y,{key:1},[p(s,{id:"files-editf-name",ref:"nameRef",label:"Name",trim:"",modelValue:e.folder.name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.folder.name=a),errorFn:e.nameError},null,8,["modelValue","errorFn"]),p(i,{id:"files-editf-vis",label:"Visibility",options:e.visibilities,modelValue:e.folder.visibility,"onUpdate:modelValue":a[2]||(a[2]=a=>e.folder.visibility=a)},null,8,["options","modelValue"])],64)):(c(),u(r,{key:0}))])),_:1},8,["title","submitLabel","disabled","onSubmit","onCancel"])])),_:1},512)};var W=a({components:{FilesEditFolder:U,MessageBox:T,SIcon:b},props:{folder:{type:Object,required:!0},indent:{type:Number,required:!0}},emits:["progress","reload","showTrash"],setup(e,{emit:a}){const l=k("me"),n=w((()=>e.folder.url?e.folder.name:l.value?"Files":"Sunnyvale SERV")),t=w((()=>b.value&&e.folder.canEdit&&""!==e.folder.url?"edit":e.folder.url||l.value?"folder":"home")),o=w((()=>b.value&&e.folder.canEdit&&""!==e.folder.url?{color:"blue"}:null)),s=w((()=>({marginLeft:1.5*e.indent+"em"}))),d=w((()=>e.folder.url?"/files"+e.folder.url:l.value?"/files":"/")),u=w((()=>c.value?{backgroundColor:"#ccc"}:"")),c=r(0),f=(r([]),r("")),p=r(null);function m(a){return!(!e.folder||!e.folder.canEdit)&&(!!a.dataTransfer.types.includes("x-serv-folder")||""!==e.folder.url&&(!!a.dataTransfer.types.includes("x-serv-document")||(!!a.dataTransfer.types.includes("Files")||!!a.dataTransfer.types.includes("text/uri-list"))))}function v(e){e.lengthComputable&&e.total&&a("progress",e.loaded/e.total)}const h=r(null),g=r(""),y=r("");const b=r(!1),S=r(null);return{dragOverStyle:u,editFolderModal:S,errorModal:p,errorText:f,folderName:n,icon:t,iconStyle:o,indentStyle:s,onDragEnd:function(){a("showTrash",!1)},onDragEnter:function(e){m(e)&&(e.preventDefault(),c.value++)},onDragLeave:function(e){m(e)&&(e.preventDefault(),c.value&&c.value--)},onDragOver:function(e){m(e)&&e.preventDefault()},onDragStart:function(l){if(!e.folder.canEdit||""===e.folder.url)return;const n=JSON.stringify({name:e.folder.name,url:e.folder.url});l.dataTransfer.setData("x-serv-folder",n),l.dataTransfer.setData("text/uri-list",`https://sunnyvaleserv.org/${d.value}\r\n# ${e.folder.name}`),l.dataTransfer.setData("text/plain","https://sunnyvaleserv.org/"+d.value),a("showTrash",!0)},onDrop:async function(l){m(l)&&(l.preventDefault(),c.value=0,l.dataTransfer.types.includes("Files")?async function(l){const n=new FormData,t=new FormData;n.append("replace","true");for(let e=0;e<l.files.length;e++){const a=l.files[e];if(!a.type)return f.value="Only regular files can be added to the folder.",void await p.value.show();n.append("name",a.name),t.append("file",a)}try{await i.post(`/api/folders${e.folder.url}?op=checkNames`,n),await i.post(`/api/folders${e.folder.url}?op=newFiles`,t,{onUploadProgress:v}),a("reload")}catch(l){if(!l.response||409!==l.response.status)throw l;if(!l.response.headers["x-can-replace"])return f.value=l.response.data,void await p.value.show();if(g.value="Replace Files",y.value=l.response.data,!await h.value.show())return;await i.post(`/api/folders${e.folder.url}?op=newFiles`,t,{onUploadProgress:v}),a("reload")}finally{a("progress",0)}}(l.dataTransfer):l.dataTransfer.types.includes("x-serv-folder")?async function(l){const n=JSON.parse(l.getData("x-serv-folder"));if(n.url===e.folder.url)return;try{const l=(await i.post(`/api/folders${n.url}?op=move`,null,{params:{parent:e.folder.url}})).data;l!=e.folder.url?a("reload",(function(a){return a===e.folder.url?l:(a.startsWith(e.folder.url),l+a.substr(e.folder.url.length))})):a("reload")}catch(e){if(e.response&&409===e.response.status)return f.value=e.response.data,void await p.value.show();throw e}}(l.dataTransfer):l.dataTransfer.types.includes("x-serv-document")?async function(l){const n=JSON.parse(l.getData("x-serv-document"));if(n.url.replace(/\/[^/]*$/,"")===e.folder.url)return;try{await i.post(`/api/document${n.url}?op=move`,null,{params:{parent:e.folder.url}}),a("reload")}catch(l){if(!l.response||409!==l.response.status)throw l;if(!l.response.headers["x-can-replace"])return f.value=l.response.data,void await p.value.show();if(g.value="link"===n.type?"Replace Link":"Replace File",y.value=l.response.data,!await h.value.show())return;await i.post(`/api/document${n.url}?op=move&replace=true`,null,{params:{parent:e.folder.url}}),a("reload")}}(l.dataTransfer):l.dataTransfer.types.includes("text/uri-list")&&async function(l){const n=l.getData("text/uri-list").replace(/\r\n.*/,"");if(!n.startsWith("http://")&&!n.startsWith("https://"))return f.value="Only links starting with http:// or https:// are supported.",void await p.value.show();try{await i.post(`/api/folders${e.folder.url}?op=newLink`,null,{params:{url:n}}),a("reload")}catch(l){if(!l.response||409!==l.response.status)throw l;if(!l.response.headers["x-can-replace"])return f.value=l.response.data,void await p.value.show();if(g.value="Replace Link",y.value=l.response.data,!await h.value.show())return;await i.post(`/api/folders${e.folder.url}?op=newLink&replace=true`,null,{params:{url:n}}),a("reload")}}(l.dataTransfer))},onEdit:async function(){if(!e.folder.canEdit||""===e.folder.url)return;const l=await S.value.showEdit(e.folder.url);l&&l!=e.folder.url?a("reload",(function(a){return a===e.folder.url?l:(a.startsWith(e.folder.url),l+a.substr(e.folder.url.length))})):a("reload")},onMouseOver:function(){b.value=!0},onMouseOut:function(){b.value=!1},replaceModal:h,replaceText:y,replaceTitle:g,url:d}}});W.render=function(e,a,l,n,t,o){const r=d("SIcon"),s=d("router-link"),i=d("MessageBox"),m=d("FilesEditFolder");return c(),u("div",{class:"files-folder",style:[e.indentStyle,e.dragOverStyle],draggable:e.folder.canEdit&&""!==e.folder.url,onDragstart:a[1]||(a[1]=(...a)=>e.onDragStart(...a)),onDragenter:a[2]||(a[2]=(...a)=>e.onDragEnter(...a)),onDragover:a[3]||(a[3]=(...a)=>e.onDragOver(...a)),onDragleave:a[4]||(a[4]=(...a)=>e.onDragLeave(...a)),onDragend:a[5]||(a[5]=(...a)=>e.onDragEnd(...a)),onDrop:a[6]||(a[6]=(...a)=>e.onDrop(...a)),onMouseover:a[7]||(a[7]=(...a)=>e.onMouseOver(...a)),onMouseout:a[8]||(a[8]=(...a)=>e.onMouseOut(...a))},[p(r,{class:"files-folder-icon",icon:e.icon,style:e.iconStyle,onClick:e.onEdit},null,8,["icon","style","onClick"]),p(s,{class:"files-folder-link",to:e.url,draggable:"false",textContent:S(e.folderName)},null,8,["to","textContent"]),p(i,{ref:"errorModal",title:"Error",cancelLabel:"",variant:"danger"},{default:f((()=>[D(S(e.errorText),1)])),_:1},512),p(i,{ref:"replaceModal",title:e.replaceTitle,cancelLabel:"Keep",okLabel:"Replace",variant:"danger"},{default:f((()=>[D(S(e.replaceText),1)])),_:1},8,["title"]),p(m,{ref:"editFolderModal"},null,512)],44,["draggable"])};var _=a({components:{MessageBox:T,SIcon:b},emits:["reload","showTrash"],setup(e,{emit:a}){const l=w((()=>n.value?{backgroundColor:"#ccc"}:"")),n=r(0),t=r(""),o=r(""),s=r(null);function d(e){return!!e.dataTransfer.types.includes("x-serv-folder")||!!e.dataTransfer.types.includes("x-serv-document")}return{deleteModal:s,deleteText:t,deleteTitle:o,dragOverStyle:l,onDragEnter:function(e){d(e)&&(e.preventDefault(),n.value++)},onDragLeave:function(e){d(e)&&(e.preventDefault(),n.value&&n.value--)},onDragOver:function(e){d(e)&&e.preventDefault()},onDrop:async function(e){d(e)&&(e.preventDefault(),a("showTrash",!0),n.value=0,e.dataTransfer.types.includes("x-serv-folder")?async function(e){const l=JSON.parse(e.getData("x-serv-folder")),n=l.url.replace(/\/[^/]*$/,"");if(o.value="Delete Folder",t.value=`Are you sure you want to delete the folder “${l.name}”, along with all of its files and sub-folders?  It cannot be restored.`,!await s.value.show())return void a("showTrash",!1);await i.delete("/api/folders"+l.url),a("showTrash",!1),a("reload",(function(e){return e===l.url||e.startsWith(l.url+"/")?n:e}))}(e.dataTransfer):async function(e){const l=JSON.parse(e.getData("x-serv-document"));"link"===l.type?(o.value="Delete Link",t.value=`Are you sure you want to delete the link “${l.name}”?  It cannot be restored.`):(o.value="Delete File",t.value=`Are you sure you want to delete the file “${l.name}”?  It cannot be restored.`);if(!await s.value.show())return void a("showTrash",!1);await i.delete("/api/document"+l.url),a("showTrash",!1),a("reload")}(e.dataTransfer))}}}});const j=p("span",{class:"files-trash-text"},"Drag here to delete",-1);_.render=function(e,a,l,n,t,o){const r=d("SIcon"),s=d("MessageBox");return c(),u("div",{class:"files-trash",style:e.dragOverStyle,onDragenter:a[1]||(a[1]=(...a)=>e.onDragEnter(...a)),onDragover:a[2]||(a[2]=(...a)=>e.onDragOver(...a)),onDragleave:a[3]||(a[3]=(...a)=>e.onDragLeave(...a)),onDrop:a[4]||(a[4]=(...a)=>e.onDrop(...a))},[p(r,{class:"files-trash-icon",icon:"trash"}),j,p(s,{ref:"deleteModal",title:e.deleteTitle,cancelLabel:"Keep",okLabel:"Delete",variant:"danger"},{default:f((()=>[D(S(e.deleteText),1)])),_:1},8,["title"])],36)};var q=a({components:{FilesAddFiles:O,FilesDocument:N,FilesEditFolder:U,FilesEditLink:I,FilesFolder:W,FilesTrash:_,NotFound:A,SButton:E,SProgress:o,SSpinner:g},setup(){const e=L(),a=M(),l=k("me"),n=k("containerSize");$({title:l.value?"Files":""});const t=r({}),o=r(!1),s=r(!1);async function d(){try{const a=e.params.path?`/api/folders/${e.params.path}?op=browse`:"/api/folders?op=browse",l=await i.get(a);o.value=!1,t.value=l.data,s.value=t.value.ancestors[t.value.ancestors.length-1].canEdit}catch(e){if(!e.response||404!==e.response.status)throw e;o.value=!0}}x(d);const u=w((()=>n.w>=24?1:0)),c=w((()=>n.w>=24&&t.value.ancestors?t.value.ancestors.length:1)),f=r(0);const p=r(null),m=r(null),v=r(null);const h=r(0);return{addFilesModal:v,ancestorsIndent:u,canEdit:s,contentsIndent:c,editFolderModal:p,editLinkModal:m,folder:t,onReload:function(l){if(l){const n=e.params.path?"/"+e.params.path:"";let t=l(n);t!==n&&""!==t?a.replace("/files"+t):t!==n?a.replace("/files"):d()}else d()},notFound:o,onAddFiles:async function(){const e=t.value.ancestors[t.value.ancestors.length-1].url;await v.value.show(e)&&d()},onAddFolder:async function(){const e=t.value.ancestors[t.value.ancestors.length-1].url;await p.value.showAdd(e)&&d()},onAddURL:async function(){const e=t.value.ancestors[t.value.ancestors.length-1].url;await m.value.showAdd(e)&&d()},onProgress:function(e){h.value=e},onShowTrash:function(e){e?f.value++:f.value--},progress:h,showTrash:f}}});const B={key:1,id:"files"},J={key:2,id:"files"},z={key:2,id:"files-buttons"},K=D("Add Folder"),H=D("Add File"),Q=D("Add Link");q.render=function(e,a,l,n,t,o){const r=d("NotFound"),s=d("SSpinner"),i=d("SProgress"),v=d("FilesFolder"),h=d("FilesDocument"),g=d("FilesTrash"),w=d("SButton"),b=d("FilesEditFolder"),S=d("FilesEditLink"),F=d("FilesAddFiles");return e.notFound?(c(),u(r,{key:0})):e.folder.ancestors?(c(),u("div",J,[e.progress?(c(),u(i,{key:0,class:"files-progress",value:e.progress},null,8,["value"])):m("",!0),p(R,{name:"files"},{default:f((()=>[(c(!0),u(y,null,C(e.folder.ancestors,((a,l)=>(c(),u(v,{class:"files-item",folder:a,key:a.url,indent:l*e.ancestorsIndent,onProgress:e.onProgress,onReload:e.onReload,onShowTrash:e.onShowTrash},null,8,["folder","indent","onProgress","onReload","onShowTrash"])))),128)),(c(!0),u(y,null,C(e.folder.children,(a=>(c(),u(v,{class:"files-item",folder:a,key:a.url,indent:e.contentsIndent,onProgress:e.onProgress,onReload:e.onReload,onShowTrash:e.onShowTrash},null,8,["folder","indent","onProgress","onReload","onShowTrash"])))),128)),(c(!0),u(y,null,C(e.folder.documents,(a=>(c(),u(h,{class:"files-item",folder:e.folder.ancestors[e.folder.ancestors.length-1],doc:a,key:a.name,indent:e.contentsIndent,onProgress:e.onProgress,onReload:e.onReload,onShowTrash:e.onShowTrash},null,8,["folder","doc","indent","onProgress","onReload","onShowTrash"])))),128)),e.folder.children.length||e.folder.documents.length?m("",!0):(c(),u("div",{key:".empty",style:{marginLeft:1.5*e.contentsIndent+.25+"rem"}},"(folder is empty)",4))])),_:1}),e.showTrash>0?(c(),u(g,{key:1,onReload:e.onReload,onShowTrash:e.onShowTrash},null,8,["onReload","onShowTrash"])):e.canEdit?(c(),u("div",z,[p(w,{variant:"primary",small:"",onClick:e.onAddFolder},{default:f((()=>[K])),_:1},8,["onClick"]),p(w,{variant:"primary",small:"",onClick:e.onAddFiles},{default:f((()=>[H])),_:1},8,["onClick"]),p(w,{variant:"primary",small:"",onClick:e.onAddURL},{default:f((()=>[Q])),_:1},8,["onClick"])])):m("",!0),e.canEdit?(c(),u(b,{key:3,ref:"editFolderModal"},null,512)):m("",!0),e.canEdit?(c(),u(S,{key:4,ref:"editLinkModal"},null,512)):m("",!0),e.canEdit?(c(),u(F,{key:5,ref:"addFilesModal"},null,512)):m("",!0)])):(c(),u("div",B,[p(s)]))};export default q;
