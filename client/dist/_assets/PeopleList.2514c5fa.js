import{d as e,P as l,U as o,f as a,E as n,z as i,$ as s,n as r,u as p,i as t,N as c,S as u,e as v,a0 as d,_ as m,K as f}from"./index.ee07c48d.js";import{s as g}from"./page.e7f3e6d2.js";const h=e({name:"PersonDetailsPopup",props:{person:{type:Object,required:!0}},setup:e=>()=>l("div",{id:"person-details"},[l("div",{id:"person-details-name"},e.person.informalName),l("div",{id:"person-details-roles"},...e.person.roles.map((e=>l("div",e)))),e.person.email||e.person.email2?l("div",{class:"person-details-spacer"}):null,e.person.email?S(e.person.email):null,e.person.email2?S(e.person.email2):null,e.person.cellPhone||e.person.homePhone||e.person.workPhone?l("div",{class:"person-details-spacer"}):null,e.person.cellPhone?k(e.person.cellPhone,"cell",!0):null,e.person.homePhone?k(e.person.homePhone,"home",!1):null,e.person.workPhone?k(e.person.workPhone,"work",!1):null])});function S(e){return[l("div",e),l("div"),l("div",{class:"person-details-icon",onClick:()=>{window.open(`mailto:${encodeURIComponent(e)}`,"_blank")}},l("a",{href:`mailto:${encodeURIComponent(e)}`,target:"_blank"},l(o,{icon:"email"})))]}function k(e,a,n){return[l("div",`${e} (${a})`),n?l("div",{class:"person-details-icon",onClick:()=>{window.open(`sms:${encodeURIComponent(e)}`,"_blank")}},l("a",{href:`sms:${encodeURIComponent(e)}`,target:"_blank"},l(o,{icon:"message"}))):l("div"),l("div",{class:"person-details-icon",onClick:()=>{window.open(`tel:${encodeURIComponent(e)}`,"_blank")}},l("a",{href:`tel:${encodeURIComponent(e)}`,target:"_blank"},l(o,{icon:"phone"})))]}const C=e({name:"PeopleList",props:{onLoadPerson:Function},setup(){const e=r(),o=p(),c=t("touch");g({title:"People"});const u=a("priority");function d(e,l){switch(u.value){case"priority":if(e.priority!==l.priority)return e.priority-l.priority;case"name":return e.sortName.localeCompare(l.sortName);case"callSignSuffix":const o=y(e.callSign),a=y(l.callSign);if(o!==a)return o.localeCompare(a);case"callSign":return e.callSign!==l.callSign?e.callSign.localeCompare(l.callSign):e.sortName.localeCompare(l.sortName);default:return 0}}function h(){switch(u.value){case"priority":u.value="name";break;case"name":u.value=$.value>0?"callSignSuffix":"priority",$.value=$.value>0?2:$.value;break;case"callSignSuffix":u.value="callSign",$.value=1;break;case"callSign":u.value="priority"}b.value.sort(d)}const S=a(parseInt(e.query.role||n.get("serv-people-role")||"0")),k=a([]),C=a(!0),b=a([]),$=a(0),R=a(!1),x=a(!1);i(S,(async()=>{n.set("serv-people-role",S.value.toString(),{expires:3650}),C.value=!0;const e=(await m.get("/api/people",{params:{role:S.value}})).data;$.value=e.showCallSign?"callSignSuffix"===u.value?2:1:0,e.showCallSign||"callSign"!==u.value&&"callSignSuffix"!==u.value||(u.value="priority"),b.value=e.people.sort(d),R.value=e.canAdd,e.viewableRoles.length>1&&(e.viewableRoles.sort(((e,l)=>e.name.localeCompare(l.name))),e.viewableRoles.unshift({id:0,name:"(all)"}),k.value=e.viewableRoles),x.value=!1,_.value=0,C.value=!1,f((()=>f(N)))}),{immediate:!0});const U=a(),I=s(),_=a(0);function N(){if(console.log("setCompact actual",I.pw,"desired",_.value),!_.value){if(!U.value)return void console.log("no grid ref");_.value=U.value.scrollWidth}x.value=I.pw<_.value}i([U,()=>I.pw],N);const j=a(null);return function(){return l("div",{id:"people"},[w(k.value,S,!C.value&&!!b.value.length,h),C.value?l(v):P(b.value,$.value,c.value,x.value,!_.value,(e=>{f((()=>U.value=e))}),o,j),R.value?void 0:null])}}});function w(e,o,a,n){return l("div",{id:"people-controls"},[e.length>1?l(c,{options:e,valueKey:"id",labelKey:"name",modelValue:o.value,"onUpdate:modelValue":e=>o.value=e}):null,a?l(u,{small:!0,onClick:n},(()=>"Sort")):null])}function P(e,a,n,i,s,r,p,t){return l("div",{id:"people-grid",class:{"people-compact":i,"people-grid-measure":s},ref:r},e.map((e=>function(e,a,n,i,s){const r=e.email||e.email2||"",p=e.cellPhone||e.homePhone||e.workPhone||"",t=function(e){return e.length?1===e.length?e[0]:`${e[0]}, ...`:""}(e.roles);function c(){i.push(`/people/${e.id}`)}return[l("div",{class:"people-callSign-prefix",onClick:c},2===a?b(e.callSign):""),l("div",{class:"people-callSign-suffix",onClick:c},2===a?y(e.callSign):1===a?e.callSign:""),l("div",{class:"people-nameRoles",onClick:c},[l(d,{to:`/people/${e.id}`,class:"people-name"},(()=>e.sortName)),l("div",{class:"people-roles-n"},t)]),l("div",{class:"people-roles",onClick:c},t),l("div",{class:"people-email"},r?l("a",{href:`mailto:${encodeURIComponent(r)}`,target:"_blank"},r):null),l("div",{class:"people-phone"},p),l("div",{class:"people-details",onClick:()=>s.value=s.value===e?null:e},[l(o,{icon:"info"}),s.value===e?l(h,{person:e}):null])]}(e,a,0,p,t))))}function b(e){return e.replace(/[A-Z]*$/,"")}function y(e){return e.replace(/^[A-Z]*\d/,"")}export default C;
