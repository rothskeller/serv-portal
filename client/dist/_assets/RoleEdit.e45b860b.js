let e=document.createElement("style");e.innerHTML="#role{margin:1.5rem .75rem}",document.head.appendChild(e);import{d as l,s as a,q as o,S as t,j as i,v as s,x as n,k as u,l as r,y as d,e as m,f as p,_ as v,z as b,m as c,n as S,u as g,r as h,c as f,p as L,w as M,o as V,a as y,h as w,F as E,g as F,A as R,t as C,b as O}from"./index.273d8127.js";import{s as k}from"./page.7a502acd.js";const A=[{value:"admin",label:"Admin"},{value:"cert-d",label:"CERT-D"},{value:"cert-t",label:"CERT-T"},{value:"listos",label:"Listos"},{value:"sares",label:"SARES"},{value:"snap",label:"SNAP"}],N=[{value:"",label:"(none)"},{value:"student",label:"Student"},{value:"member",label:"Member"},{value:"leader",label:"Leader"}],U=[{value:"",label:"(none)"}],$=[{value:"showRoster",label:"Available choice on People list page"},{value:"implicitOnly",label:"Role can only be implied, not assigned"}],D={allow:"manual subscr.",auto:"auto subscr.",warn:"warn on unsub."},T=[{value:"",label:"No Subscription"},{value:"allow",label:"Manual Subscription"},{value:"auto",label:"Automatic Subscription"},{value:"warn",label:"Warn on Unsubscribe"}];var x=l({components:{MessageBox:a,Modal:o,SButton:t,SForm:i,SFCheck:s,SFCheckGroup:n,SFInput:u,SFRadioGroup:r,SFSelect:d,SSpinner:m},setup(){const e=S(),l=g();k({title:"NEW"===e.params.lid?"Add Role":"Edit Role"});const a="NEW"===e.params.lid?"Add Role":"Save Role",o=p(!0),t=p({}),i=p(new Set),s=p(new Set);v.get(`/api/roles/${e.params.rid}`).then((e=>{t.value=e.data,i.value.clear(),t.value.showRoster&&i.value.add("showRoster"),t.value.implicitOnly&&i.value.add("implicitOnly"),s.value=new Set(t.value.implies),o.value=!1}));const n=p("");const u=p("");b(c((()=>t.value.name)),((e,l)=>{t.value.title===l&&(t.value.title=e)}));const r=p(!1);const d=p(null),m=p({}),h=p([]);const f=p(null);return{deleteModal:f,editList:async function(e){if(h.value=t.value.lists.filter((l=>l===e||!l.subModel&&!l.sender)),h.value.forEach((e=>{e.nameFmt="sms"===e.type?`SMS: ${e.name}`:`${e.name}@SunnyvaleSERV.org`})),e)m.value.list=e.id,m.value.subModel=e.subModel,m.value.sender=e.sender;else{if(!h.value.length)return;m.value.list=h.value[0].id,m.value.subModel="",m.value.sender=!1}await d.value.show()&&(e&&e.id!==m.value.list&&(e.subModel="",e.sender=!1),(e=t.value.lists.find((e=>e.id===parseInt(m.value.list)))).subModel=m.value.subModel,e.sender=m.value.sender)},editingList:m,flags:i,flagOptions:$,implies:s,listEditModal:d,loading:o,nameError:function(e){return e?t.value.name?n.value===t.value.name?"Another role has this name.":"":"The role name is required.":""},onDelete:async function(){if(f.value){await f.value.show()&&(r.value=!0,await v.delete(`/api/roles/${e.params.rid}`),r.value=!1,l.push("/admin/roles"))}},onSubmit:async function(){const a=new FormData;a.append("name",t.value.name),a.append("title",t.value.title),a.append("org",t.value.org),a.append("privLevel",t.value.org?t.value.privLevel:""),a.append("showRoster",i.value.has("showRoster").toString()),a.append("implicitOnly",i.value.has("implicitOnly").toString()),s.value.forEach((e=>{a.append("implies",e.toString())})),t.value.lists.forEach((e=>{(e.subModel||e.sender)&&a.append("lists",`${e.id}:${e.subModel}:${e.sender}`)})),r.value=!0;const o=(await v.post(`/api/roles/${e.params.rid}`,a)).data;r.value=!1,o?(o.duplicateName&&(n.value=t.value.name),o.duplicateTitle&&(u.value=t.value.title)):l.push("/admin/roles")},orgOptions:A,privLevelNoOption:U,privLevelOptions:N,role:t,selectableLists:h,submitLabel:a,submitting:r,subModelNames:D,subModelOptions:T,titleError:function(e){return e&&u.value&&u.value===t.value.title?"Another role has this title.":""}}}});const K={id:"role"},_=y("label",{class:"form-item-label",id:"role-lists-label"},"Lists",-1),B={class:"form-item-input2"},G={key:0},I=O("Delete Role"),j=O("Are you sure you want to delete this role? All associated data, including role assignments, list associations, etc. will be permanently lost.");x.render=function(e,l,a,o,t,i){const s=h("SSpinner"),n=h("SFInput"),u=h("SFRadioGroup"),r=h("SFCheckGroup"),d=h("SButton"),m=h("SFSelect"),p=h("SFCheck"),v=h("SForm"),b=h("Modal"),c=h("MessageBox");return V(),f("div",K,[e.loading?(V(),f(s,{key:0})):(V(),f(v,{key:1,submitLabel:e.submitLabel,disabled:e.submitting,onSubmit:e.onSubmit},L({default:M((()=>[y(n,{id:"role-name",label:"Name",help:"Collective name for those who hold the role",trim:"",modelValue:e.role.name,"onUpdate:modelValue":l[1]||(l[1]=l=>e.role.name=l),errorFn:e.nameError},null,8,["modelValue","errorFn"]),y(n,{id:"role-title",label:"Title",help:"Name for a single person who holds this role, or empty",trim:"",modelValue:e.role.title,"onUpdate:modelValue":l[2]||(l[2]=l=>e.role.title=l),errorFn:e.titleError},null,8,["modelValue","errorFn"]),y(u,{id:"role-org",label:"Org",options:e.orgOptions,modelValue:e.role.org,"onUpdate:modelValue":l[3]||(l[3]=l=>e.role.org=l)},null,8,["options","modelValue"]),y(u,{id:"role-privLevel",label:"Priv Level",options:e.role.org?e.privLevelOptions:e.privLevelNoOption,modelValue:e.role.privLevel,"onUpdate:modelValue":l[4]||(l[4]=l=>e.role.privLevel=l)},null,8,["options","modelValue"]),y(r,{id:"role-flags",label:"Flags",options:e.flagOptions,modelValue:e.flags,"onUpdate:modelValue":l[5]||(l[5]=l=>e.flags=l)},null,8,["options","modelValue"]),e.role.impliable.length?(V(),f(r,{key:0,id:"role-implies",label:"Implies",options:e.role.impliable,valueKey:"id",labelKey:"name",modelValue:e.implies,"onUpdate:modelValue":l[6]||(l[6]=l=>e.implies=l)},null,8,["options","modelValue"])):w("",!0),_,y("div",B,[(V(!0),f(E,null,F(e.role.lists,(l=>(V(),f(E,null,[l.subModel||l.sender?(V(),f("div",G,[y("a",{href:"#",onClick:R((a=>e.editList(l)),["prevent"])},C("sms"===l.type?`SMS: ${l.name}`:`${l.name}@SunnyvaleSERV.org`),9,["onClick"]),O(": "+C(l.subModel?e.subModelNames[l.subModel]:"")+C(l.subModel&&l.sender?", ":"")+C(l.sender?"can send":""),1)])):w("",!0)],64)))),256)),y("div",null,[y("a",{href:"#",onClick:l[7]||(l[7]=R((l=>e.editList(null)),["prevent"]))},"Add List")])]),y(b,{ref:"listEditModal"},{default:M((({close:a})=>[y(v,{dialog:"",variant:"primary",title:"Connect to List",submitLabel:"OK",onSubmit:e=>a(!0),onCancel:e=>a(!1)},{default:M((()=>[y(m,{id:"role-listEdit-list",label:"List",options:e.selectableLists,valueKey:"id",labelKey:"nameFmt",modelValue:e.editingList.list,"onUpdate:modelValue":l[8]||(l[8]=l=>e.editingList.list=l)},null,8,["options","modelValue"]),y(u,{id:"role-listEdit-subModel",label:"Subscription",options:e.subModelOptions,modelValue:e.editingList.subModel,"onUpdate:modelValue":l[9]||(l[9]=l=>e.editingList.subModel=l)},null,8,["options","modelValue"]),y(p,{id:"role-listEdit-sender",label:"Can Send",modelValue:e.editingList.sender,"onUpdate:modelValue":l[10]||(l[10]=l=>e.editingList.sender=l)},null,8,["modelValue"])])),_:2},1032,["onSubmit","onCancel"])])),_:1},512),y(c,{ref:"deleteModal",title:"Delete Role",cancelLabel:"Keep",okLabel:"Delete",variant:"danger"},{default:M((()=>[j])),_:1},512)])),_:2},[e.role.id?{name:"extraButtons",fn:M((()=>[y(d,{onClick:e.onDelete,variant:"danger",disabled:e.submitting},{default:M((()=>[I])),_:1},8,["onClick","disabled"])]))}:void 0]),1032,["submitLabel","disabled","onSubmit"]))])};export default x;
