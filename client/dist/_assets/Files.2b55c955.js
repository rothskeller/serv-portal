let e=document.createElement("style");e.innerHTML="#files-add-doc-confirm-label{border-top:1px solid #dee2e6;padding:.75rem}#files-add-doc-confirm-buttons{padding:0 .75rem .75rem;text-align:right}#files-add-doc-confirm-buttons .sbtn{margin-left:.5rem}#files-edit-doc-confirm-label{border-top:1px solid #dee2e6;padding:.75rem}#files-edit-doc-confirm-buttons{padding:0 .75rem .75rem;text-align:right}#files-edit-doc-confirm-buttons .sbtn{margin-left:.5rem}#files-edit-folder-confirm-label{border-top:1px solid #dee2e6;padding:.75rem}#files-edit-folder-confirm-buttons{padding:0 .75rem .75rem;text-align:right}#files-edit-folder-confirm-buttons .sbtn{margin-left:.5rem}#files{position:relative;height:100%}.mouse #files{padding:1.5rem .75rem}#files.dragging{box-shadow:inset 0 0 0 .25rem #060}#files-progress{position:absolute;top:0;right:0;left:0}.files-line{display:flex;align-items:center}.touch .files-line{padding:.25rem .5rem;min-height:40px;border-bottom:1px solid #ccc}.files-icon{display:flex;flex:none;justify-content:center;align-items:center;margin-right:.5rem;padding:0;width:1rem;height:1rem;border:none;background-color:#fff;color:#000}.files-icon:active,.files-icon:focus,.files-icon:hover{background-color:#fff!important;color:#000!important}.touch .files-icon{width:1.5rem;height:1.5rem}.files-icon svg{width:100%;height:100%}.files-name{flex:1 1 auto;overflow:hidden;min-width:0;text-overflow:ellipsis;white-space:nowrap}.touch .files-name{white-space:normal;line-height:1.2}.files-pending{color:red}#files-add{margin-top:1rem}#files-add .sbtn{margin-right:.5rem}",document.head.appendChild(e);import{d as l,K as n,z as o,O as i,A as a,P as t,g as d,_ as r,r as s,c as u,o as c,w as f,a as m,J as p,Q as v,e as g,s as h,u as b,b as F,C as y,D,R as w,h as S,S as k,y as E,p as C,q as x,x as I,F as _,k as P}from"./index.ab3702d8.js";import{s as R}from"./page.112d2461.js";var A=l({components:{Modal:n,SButton:o,SFFile:i,SForm:a,SProgress:t},props:{parentID:{type:Number,required:!0},siblings:{type:Array,required:!0}},setup(e){const l=d(null);const n=d(null);const o=d([]),i=d(!1),a=d(null);function t(e){e.lengthComputable&&e.total&&(a.value=e.loaded/e.total)}async function s(){i.value=!1,a.value=0;const o=new FormData;for(let e=0;e<n.value.length;e++){const l=n.value.item(e);o.append("file",l)}const d=(await r.post(`/api/folders/${e.parentID}/NEW`,o,{onUploadProgress:t})).data;a.value=null,l.value.close(d)}return{cancelReplace:function(){i.value=!1},confirmReplace:s,confirmingReplace:i,files:n,filesError:function(e,l){return l?n.value&&n.value.length?"":"Select the file(s) to be added.":""},modal:l,replace:o,onCancel:function(){l.value.close(null)},onSubmit:function(){for(let l=0;l<n.value.length;l++){const i=n.value.item(l);e.siblings.find(e=>e.name===i.name)&&o.value.push(i.name)}o.value.length?i.value=!0:s()},show:function(){return i.value=!1,l.value.show()},uploadProgress:a}}});const V={class:"form-item",id:"files-add-doc-confirm-label"},q={class:"form-item",id:"files-add-doc-confirm-buttons"},N=g("Keep"),B=g("Replace"),K={class:"form-item"};A.render=function(e,l,n,o,i,a){const t=s("SFFile"),d=s("SButton"),r=s("SProgress"),g=s("SForm"),h=s("Modal");return c(),u(h,{ref:"modal"},{default:f(()=>[m(g,{dialog:"",title:"Add File",submitLabel:"OK",disabled:e.confirmingReplace||null!==e.uploadProgress,onSubmit:e.onSubmit,onCancel:e.onCancel},p({default:f(()=>[m(t,{id:"files-edit-doc-files",multiple:"",label:"File(s)",modelValue:e.files,"onUpdate:modelValue":l[1]||(l[1]=l=>e.files=l),errorFn:e.filesError},null,8,["modelValue","errorFn"])]),_:2},[e.confirmingReplace?{name:"feedback",fn:f(()=>[m("div",V,"This will replace "+v(e.replace.length>1?e.replace.length+" existing files with the same names":`the existing file named "${e.replace[0]}"`)+". Are you sure?",1),m("div",q,[m(d,{variant:"secondary",onClick:e.cancelReplace},{default:f(()=>[N]),_:1},8,["onClick"]),m(d,{variant:"warning",onClick:e.confirmReplace},{default:f(()=>[B]),_:1},8,["onClick"])])])}:void 0,null!==e.uploadProgress?{name:"feedback",fn:f(()=>[m("div",K,[m(r,{value:e.uploadProgress},null,8,["value"])])])}:void 0]),1032,["disabled","onSubmit","onCancel"])]),_:1},512)},A.__file="client/src/pages/files/FilesAddDocument.vue";var M=l({components:{SIcon:h},props:{folderID:{type:Number,required:!0},doc:{type:Object,required:!0},canEdit:{type:Boolean,required:!0}},emits:["edit"],setup(e,{emit:l}){const n=d(!1);return{docHRef:b(()=>`/api/folders/${e.folderID}/${e.doc.id}`),hovering:n,onEdit:function(){e.canEdit&&l("edit")}}}});const O={class:"files-name"},W={key:0,class:"files-pending"};function $(e){const l=e.lastIndexOf(".");return l<0?"":e.substr(l)}M.render=function(e,l,n,o,i,a){const t=s("SIcon");return c(),u("div",{class:"files-line",onMouseover:l[2]||(l[2]=l=>e.hovering=!0),onMouseout:l[3]||(l[3]=l=>e.hovering=!1)},[m("div",{class:"files-icon",onClick:l[1]||(l[1]=(...l)=>e.onEdit(...l))},[e.canEdit&&e.hovering?(c(),u(t,{key:0,icon:"edit"})):e.doc.name.endsWith(".docx")||e.doc.name.endsWith(".doc")?(c(),u(t,{key:1,icon:"word"})):e.doc.name.endsWith(".pdf")?(c(),u(t,{key:2,icon:"pdf"})):e.doc.name.endsWith(".ppt")||e.doc.name.endsWith(".pptx")?(c(),u(t,{key:3,icon:"powerpoint"})):e.doc.name.endsWith(".xls")||e.doc.name.endsWith(".xlsx")?(c(),u(t,{key:4,icon:"excel"})):e.doc.name.endsWith(".jpg")||e.doc.name.endsWith(".jpeg")?(c(),u(t,{key:5,icon:"image"})):(c(),u(t,{key:6,icon:"file"}))]),m("span",O,[m("a",{href:e.docHRef,download:""},v(e.doc.name),9,["href"]),e.doc.needsApproval?(c(),u("span",W,"[pending approval]")):F("v-if",!0)])],32)},M.__file="client/src/pages/files/FilesDocument.vue";var T=l({components:{Modal:n,SButton:o,SFInput:y,SForm:a,SFSelect:D},props:{allowedParents:{type:Array,required:!0},doc:Object,parentID:{type:Number,required:!0},siblings:{type:Array,required:!0}},setup(e){const l=d(null);const n=d(""),o=d(0);w(()=>{var l;n.value=(null==(l=e.doc)?void 0:l.name)||"",o.value=e.parentID});const i=d(null);S(()=>{i.value&&i.value.focus()});const a=d(!1);return{cancelDelete:function(){a.value=!1},confirmDelete:async function(){const n=(await r.delete(`/api/folders/${e.parentID}/${e.doc.id}`)).data;l.value.close(n)},confirmingDelete:a,folder:o,modal:l,name:n,nameError:function(l){return l?n.value?$(n.value)?$(n.value)!==$(e.doc.name)?`The new file name must end with "${$(e.doc.name)}".`:e.siblings.find(l=>l!==e.doc&&l.name===n.value)?"This file name is already in use.":"":"The file must have an extension indicating its type.":"The file name is required.":""},nameRef:i,onCancel:function(){l.value.close(null)},onDelete:function(){a.value=!0},onSubmit:async function(){const i=new FormData;i.append("name",n.value),i.append("folder",o.value.toString());const a=(await r.post(`/api/folders/${e.parentID}/${e.doc.id}`,i)).data;l.value.close(a)},show:function(){return a.value=!1,l.value.show()}}}});const j=g("Delete"),G={class:"form-item",id:"files-edit-doc-confirm-label"},L={class:"form-item",id:"files-edit-doc-confirm-buttons"},U=g("Keep"),H=g("Delete");T.render=function(e,l,n,o,i,a){const t=s("SFInput"),d=s("SFSelect"),r=s("SButton"),g=s("SForm"),h=s("Modal");return c(),u(h,{ref:"modal"},{default:f(()=>[e.doc?(c(),u(g,{key:0,dialog:"",title:"Edit File",submitLabel:"OK",disabled:e.confirmingDelete,onSubmit:e.onSubmit,onCancel:e.onCancel},p({extraButtons:f(()=>[m(r,{variant:"danger",disabled:e.confirmingDelete,onClick:e.onDelete},{default:f(()=>[j]),_:1},8,["disabled","onClick"])]),default:f(()=>[m(t,{id:"files-edit-doc-name",ref:"nameRef",label:"Name",trim:"",modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=l=>e.name=l),errorFn:e.nameError},null,8,["modelValue","errorFn"]),m(d,{id:"files-edit-doc-folder",label:"In Folder",options:e.allowedParents,modelValue:e.folder,"onUpdate:modelValue":l[2]||(l[2]=l=>e.folder=l),valueKey:"id",labelKey:"name"},null,8,["options","modelValue"])]),_:2},[e.confirmingDelete?{name:"feedback",fn:f(()=>[m("div",G,'Are you sure you want to delete the document "'+v(e.doc.name)+'"? It cannot be restored.',1),m("div",L,[m(r,{variant:"secondary",onClick:e.cancelDelete},{default:f(()=>[U]),_:1},8,["onClick"]),m(r,{variant:"danger",onClick:e.confirmDelete},{default:f(()=>[H]),_:1},8,["onClick"])])])}:void 0]),1032,["disabled","onSubmit","onCancel"])):F("v-if",!0)]),_:1},512)},T.__file="client/src/pages/files/FilesEditDocument.vue";var z=l({components:{Modal:n,SButton:o,SFInput:y,SForm:a,SFSelect:D},props:{allowedGroups:{type:Array,required:!0},allowedParents:{type:Array,required:!0},editFolder:Object,parentID:{type:Number,required:!0},siblings:{type:Array,required:!0}},emits:["delete"],setup(e,{emit:l}){const{allowedParents:n,editFolder:o,parentID:i}=k(e),a=d(null);const t=d(""),s=d(0),u=d(0);w(()=>{var e,l;t.value=(null==(e=null==o?void 0:o.value)?void 0:e.name)||"",s.value=(null==(l=null==o?void 0:o.value)?void 0:l.group)||0,u.value=i.value});const c=d(null);S(()=>{c.value&&c.value.focus()});const f=b(()=>{if(!o.value)return[];let e;return n.value.filter(l=>l.id===o.value.id?(e=l.indent,!1):!(null!==e&&l.indent>e)&&(e=null,!0))});const m=d(!1);return{allowedParents:f,cancelDelete:function(){m.value=!1},confirmDelete:async function(){const e=(await r.delete("/api/folders/"+o.value.id)).data;a.value.close(e)},confirmingDelete:m,editFolderGroup:s,editFolderName:t,editFolderNameError:function(l){return l?t.value?e.siblings.find(e=>e!==(null==o?void 0:o.value)&&e.name===t.value)?"This folder name is already in use.":"":"The folder name is required.":""},editFolderNameRef:c,editFolderParent:u,modal:a,onCancel:function(){a.value.close(null)},onDelete:function(){m.value=!0},onSubmit:async function(){const e=new FormData;let l;e.append("name",t.value),e.append("group",s.value.toString()),(null==o?void 0:o.value)&&e.append("parent",u.value.toString()),l=(null==o?void 0:o.value)?(await r.put("/api/folders/"+o.value.id,e)).data:(await r.post("/api/folders/"+i.value,e)).data,a.value.close(l)},show:function(){return m.value=!1,a.value.show()}}}});const J=g("Delete"),Q={class:"form-item",id:"files-edit-folder-confirm-label"},X={class:"form-item",id:"files-edit-folder-confirm-buttons"},Y=g("Keep"),Z=g("Delete");z.render=function(e,l,n,o,i,a){const t=s("SFInput"),d=s("SFSelect"),r=s("SButton"),g=s("SForm"),h=s("Modal");return c(),u(h,{ref:"modal"},{default:f(()=>[m(g,{id:"files-edit-folder-form",dialog:"",title:e.editFolder?"Edit Folder":"Add Folder",submitLabel:"OK",disabled:e.confirmingDelete,onSubmit:e.onSubmit,onCancel:e.onCancel},p({default:f(()=>[m(t,{id:"files-edit-folder-name",ref:"editFolderNameRef",label:"Name",trim:"",modelValue:e.editFolderName,"onUpdate:modelValue":l[1]||(l[1]=l=>e.editFolderName=l),errorFn:e.editFolderNameError},null,8,["modelValue","errorFn"]),m(d,{id:"files-edit-folder-group",label:"Group",modelValue:e.editFolderGroup,"onUpdate:modelValue":l[2]||(l[2]=l=>e.editFolderGroup=l),options:e.allowedGroups,valueKey:"id",labelKey:"name"},null,8,["modelValue","options"]),e.editFolder?(c(),u(d,{key:0,id:"files-edit-folder-parent",label:"Parent Folder",modelValue:e.editFolderParent,"onUpdate:modelValue":l[3]||(l[3]=l=>e.editFolderParent=l),options:e.allowedParents,valueKey:"id",labelKey:"name"},null,8,["modelValue","options"])):F("v-if",!0)]),_:2},[e.editFolder?{name:"extraButtons",fn:f(()=>[m(r,{onClick:e.onDelete,disabled:e.confirmingDelete,variant:"danger"},{default:f(()=>[J]),_:1},8,["onClick","disabled"])])}:void 0,e.confirmingDelete?{name:"feedback",fn:f(()=>[m("div",Q,'Are you sure you want to delete the folder "'+v(e.editFolder.name)+'", along with all of its files and sub-folders? It cannot be restored.',1),m("div",X,[m(r,{variant:"secondary",onClick:e.cancelDelete},{default:f(()=>[Y]),_:1},8,["onClick"]),m(r,{variant:"danger",onClick:e.confirmDelete},{default:f(()=>[Z]),_:1},8,["onClick"])])])}:void 0]),1032,["title","disabled","onSubmit","onCancel"])]),_:1},512)},z.__file="client/src/pages/files/FilesEditFolder.vue";var ee=l({components:{SIcon:h},props:{folder:{type:Object,required:!0},canEdit:{type:Boolean,required:!0}},emits:["edit"],setup:(e,{emit:l})=>({hovering:d(!1),onEdit:function(){e.canEdit&&l("edit")}})});const le={class:"files-name"},ne={key:0,class:"files-pending"};ee.render=function(e,l,n,o,i,a){const t=s("SIcon"),d=s("router-link");return c(),u("div",{class:"files-line",onMouseover:l[2]||(l[2]=l=>e.hovering=!0),onMouseout:l[3]||(l[3]=l=>e.hovering=!1)},[m("div",{class:"files-icon",onClick:l[1]||(l[1]=(...l)=>e.onEdit(...l))},[e.canEdit&&e.hovering?(c(),u(t,{key:0,icon:"edit"})):(c(),u(t,{key:1,icon:"folder"}))]),m("div",le,[m(d,{to:"/files/"+e.folder.id},{default:f(()=>[g(v(e.folder.name),1)]),_:1},8,["to"]),e.folder.approvals?(c(),u("span",ne,"[pending approvals]")):F("v-if",!0)])],32)},ee.__file="client/src/pages/files/FilesFolder.vue";var oe=l({components:{FilesAddDocument:A,FilesDocument:M,FilesEditDocument:T,FilesEditFolder:z,FilesFolder:ee,MessageBox:E,SButton:o,SIcon:h,SProgress:t,SSpinner:C},setup(){R({title:"Files"});const e=I(),l=d(null);x(l,()=>{l.value.children||(l.value.children=[]),l.value.documents||(l.value.documents=[]),R({title:l.value.name||"Files"})}),w(async()=>{l.value=(await r.get("/api/folders/"+e.params.id)).data});const n=d(!1),o=d(null),i=d([]),a=d(null);function t(e){e.lengthComputable&&e.total&&(o.value=e.loaded/e.total)}const s=d(null),u=d(null);const c=d(null),f=d(null);const m=d(null);return{addDocumentRef:m,dragging:n,editDocument:c,editDocumentRef:f,editFolder:s,editFolderRef:u,folder:l,onAddDocument:async function(){if(!l.value.canEdit)return;const e=await m.value.show();e&&(l.value=e)},onAddFolder:async function(){if(!l.value.canEdit)return;s.value=null;const e=await u.value.show();e&&(l.value=e)},onDragLeave:function(){n.value=!1},onDragOver:function(e){e.preventDefault(),n.value=!0},onDrop:async function(d){if(!l.value.canAdd&&!l.value.canEdit)return;d.preventDefault(),n.value=!1,i.value=[];const s=d.dataTransfer.files;for(let e=0;e<s.length;e++){const n=s[e];l.value.documents.find(e=>e.name===n.name)&&i.value.push(n.name)}if(i.value.length>0&&!await a.value.show())return;const u=new FormData;for(let e=0;e<s.length;e++)u.append("file",s[e]);l.value=(await r.post(`/api/folders/${e.params.id}/NEW`,u,{onUploadProgress:t})).data,o.value=null},onEditDocument:async function(e){if(!l.value.canEdit)return;c.value=e;const n=await f.value.show();n&&(l.value=n),c.value=null},onEditFolder:async function(e){if(!l.value.canEdit)return;s.value=e;const n=await u.value.show();n&&(l.value=n),s.value=null},replace:i,replaceConfirmRef:a,uploadProgress:o}}});const ie={key:0},ae={key:1,class:"files-line"},te={class:"files-icon"},de={key:2,id:"files-add"},re=g("Add Folder"),se=g("Add File");oe.render=function(e,l,n,o,i,a){const t=s("SSpinner"),d=s("SProgress"),r=s("SIcon"),p=s("router-link"),h=s("FilesFolder"),b=s("FilesDocument"),y=s("SButton"),D=s("MessageBox"),w=s("FilesAddDocument"),S=s("FilesEditDocument"),k=s("FilesEditFolder");return e.folder?(c(),u("div",{key:1,id:"files",class:e.dragging?"dragging":null,onDrop:l[1]||(l[1]=(...l)=>e.onDrop(...l)),onDragover:l[2]||(l[2]=(...l)=>e.onDragOver(...l)),onDragleave:l[3]||(l[3]=(...l)=>e.onDragLeave(...l))},[null!==e.uploadProgress?(c(),u(d,{key:0,id:"files-progress",value:e.uploadProgress},null,8,["value"])):F("v-if",!0),e.folder.id?(c(),u("div",ae,[m("div",te,[m(r,{icon:"up"})]),m(p,{class:"files-name",to:"/files/"+(e.folder.parent?e.folder.parent.id:0)},{default:f(()=>[g(v(e.folder.parent?e.folder.parent.name:"Files"),1)]),_:1},8,["to"])])):F("v-if",!0),(c(!0),u(_,null,P(e.folder.children,l=>(c(),u(h,{key:"f"+l.id,folder:l,canEdit:e.folder.canEdit,onEdit:n=>e.onEditFolder(l)},null,8,["folder","canEdit","onEdit"]))),128)),(c(!0),u(_,null,P(e.folder.documents,l=>(c(),u(b,{key:"d"+l.id,folderID:e.folder.id,doc:l,canEdit:e.folder.canEdit,onEdit:n=>e.onEditDocument(l)},null,8,["folderID","doc","canEdit","onEdit"]))),128)),e.folder.canEdit||e.folder.canAdd?(c(),u("div",de,[e.folder.canEdit?(c(),u(y,{key:0,variant:"primary",onClick:e.onAddFolder},{default:f(()=>[re]),_:1},8,["onClick"])):F("v-if",!0),m(y,{variant:"primary",onClick:e.onAddDocument},{default:f(()=>[se]),_:1},8,["onClick"])])):F("v-if",!0),m(D,{ref:"replaceConfirmRef",title:e.replace.length>1?"Replace Files":"Replace File",cancelLabel:"Keep",okLabel:"Replace",variant:"warning"},{default:f(()=>[g("This will replace "+v(e.replace.length>1?e.replace.length+" existing files with the same names":`the existing file named "${e.replace[0]}"`)+". Are you sure?",1)]),_:1},8,["title"]),m(w,{ref:"addDocumentRef",parentID:e.folder.id,siblings:e.folder.documents},null,8,["parentID","siblings"]),m(S,{ref:"editDocumentRef",doc:e.editDocument,allowedParents:e.folder.allowedParents,parentID:e.folder.id,siblings:e.folder.documents},null,8,["doc","allowedParents","parentID","siblings"]),m(k,{ref:"editFolderRef",allowedGroups:e.folder.allowedGroups,allowedParents:e.folder.allowedParents,editFolder:e.editFolder,parentID:e.folder.id,siblings:e.folder.children},null,8,["allowedGroups","allowedParents","editFolder","parentID","siblings"])],34)):(c(),u("div",ie,[m(t)]))},oe.__file="client/src/pages/Files.vue";export default oe;
