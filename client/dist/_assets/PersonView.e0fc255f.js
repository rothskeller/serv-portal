let e=document.createElement("style");e.innerHTML=".person-address-label-Mail,.person-address-label-Work{padding-top:0}.person-address-same-box{white-space:nowrap}.person-address-same-label{margin:0 0 0 .5rem}.person-address-input{display:block;width:100%;margin-top:.5rem}.person-address-input:first-child{margin-top:0}.person-emContact{margin:0 .75rem;border-top:1px solid #ccc;padding-top:.25rem}.person-view-section{margin-bottom:1.5rem}.person-view-section-header{display:flex;align-items:center;justify-content:space-between;background-color:#eee}.person-view-section-header-text{color:#000;font-size:1.25rem;padding-left:.75rem}.person-view-section-edit{flex:none;padding-left:.25rem;background-color:#fff}#person-view-emContacts,#person-view-emails{margin-top:.75rem}.person-view-email-label{color:#888}.person-view-phone{font-variant:tabular-nums}.person-view-phone-label{margin-left:.25rem;color:#888}.person-view-address,.person-view-clearances{margin-top:.75rem;line-height:1.2}.person-view-map{margin-left:1rem}.person-view-map::before{content:'['}.person-view-map::after{content:']'}.person-view-address-flag{color:#888;font-size:.875rem}#person-view-names{display:flex;justify-content:space-between;align-items:flex-start}#person-view-names-ifc{margin-bottom:1.5rem}#person-view-names-ic{font-size:1.25rem;line-height:1.2;color:#000}#person-view-names-i{display:inline;font-weight:700}#person-view-names-c{display:inline;margin-left:.5rem}#person-view-names-f{color:#888;line-height:1}#person-view-names-edit{margin-left:.5rem}#person-edit-note-help{margin:0 .75rem 1rem}.person-edit-note{display:grid;grid:auto-flow/-webkit-min-content 1fr;grid:auto-flow/min-content 1fr;margin:0 .75rem 1rem;-moz-column-gap:1rem;column-gap:1rem}#person-view-notes{margin-top:.75rem}.person-view-note{line-height:1.2;margin-left:2rem;text-indent:-2rem}.person-view-note-date{display:inline;margin-right:.75rem;color:#666;font-variant:tabular-nums}.person-view-note-text{display:inline;margin-left:.5rem}#person-view-roles-badges{display:grid;grid:auto-flow/-webkit-min-content 1fr;grid:auto-flow/min-content 1fr;min-width:0}.person-view-roles-badge{margin-top:1rem}.person-view-roles-titles{margin-top:1rem;line-height:1.2;min-width:0}.person-view-roles-title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#person-edbg-header{margin:0 .75rem;border-top:1px solid #ccc;padding-top:.25rem}#person-edbg-help{margin:0 .75rem;color:#6c757d;font-size:80%}#person-view-status-grid{margin-top:.75rem;display:grid;grid:auto-flow/1fr}#person-view-status-grid>div:nth-child(2n+1),#person-view-status-identification div{white-space:nowrap}#person-view-status-grid>div:nth-child(2n){margin-left:2rem}@media (min-width:400px){#person-view-status-grid{grid:auto-flow/-webkit-min-content 1fr;grid:auto-flow/min-content 1fr}#person-view-status-grid>div:nth-child(2n){margin-left:1rem}}#person-view-status-identification{display:flex;flex-wrap:wrap}#person-view-status-identification div::after{content:',Â '}#person-view-status-identification div:last-child::after{content:''}.person-view-status-date{font-variant-numeric:tabular-nums}.person-view-status-assumed{color:#f60}#person-view-lists-list{margin-top:.75rem;line-height:1.2;margin-left:2em;text-indent:-2em}#person-view{margin:1.5rem .75rem}#person-view-grid{display:grid;grid:auto-flow/1fr}.person-view-spacer{display:none}@media (min-width:740px){#person-view-status-grid{grid:auto-flow/1fr}#person-view-status-grid>div:nth-child(2n){margin-left:2rem}#person-view-grid{grid:auto-flow/1fr 1fr;-moz-column-gap:.75rem;column-gap:.75rem}.person-view-spacer{display:block}}@media (min-width:1048px){#person-view-grid{grid:auto-flow/1fr 1fr 1fr}.person-view-spacer{grid-column:span 2}}#person-view-chpw{display:grid;grid:auto/auto auto;-moz-column-gap:.5rem;column-gap:.5rem;margin-top:.75rem}",document.head.appendChild(e);import{d as o,q as n,j as t,k as a,$ as s,e as l,f as r,i,_ as d,O as u,r as p,c,o as m,w as v,a as h,F as f,h as w,a2 as g,z as C,a3 as y,t as b,G as k,a4 as S,a5 as E,y as P,S as V,a6 as A,b as x,m as R,C as F,g as N,x as M,a7 as $,T,I as D,v as B,A as U,s as H,n as _}from"./index.f027063b.js";import{s as I}from"./SubscriptionsForm.e948327a.js";var O=o({components:{Modal:n,SForm:t,SFInput:a,SFPassword:s,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=i("me"),n=r(null);const t=r([]),a=r(!0);const s=r(""),l=r(null),p=r(""),c=r(null),m=r("");const v=r(!1);return{hints:t,loading:a,me:o,modal:n,oldPassword:s,oldPasswordError:function(e,n){return n?!p.value||s.value||o.value.webmaster?s.value&&s.value===m.value?"This is not the correct old password.":"":"You must supply your old password in order to change your password.":""},oldPasswordRef:l,onCancel:function(){n.value.close(!1)},onSubmit:async function(){var o=new FormData;o.append("oldPassword",s.value),o.append("password",p.value),v.value=!0;try{await d.post(`/api/people/${e.pid}/password`,o),n.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;m.value=s.value}finally{v.value=!1}},password:p,passwordRef:c,show:function(){return s.value=p.value="",async function(){a.value=!0,t.value=(await d.get(`/api/people/${e.pid}/password`)).data,a.value=!1,u((()=>{o.value.webmaster?c.value.focus():l.value.focus()}))}(),n.value.show()},submitting:v}}});O.render=function(e,o,n,t,a,s){const l=p("SSpinner"),r=p("SFInput"),i=p("SFPassword"),d=p("SForm"),u=p("Modal");return m(),c(u,{ref:"modal"},{default:v((()=>[h(d,{dialog:"",variant:"primary",title:"Change Password",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.loading?(m(),c(l,{key:0})):(m(),c(f,{key:1},[e.me.webmaster?w("",!0):(m(),c(r,{key:0,id:"person-oldPassword",ref:"oldPasswordRef",type:"password",label:"Old Password",modelValue:e.oldPassword,"onUpdate:modelValue":o[1]||(o[1]=o=>e.oldPassword=o),errorFn:e.oldPasswordError},null,8,["modelValue","errorFn"])),h(i,{id:"person-password",ref:"passwordRef",label:"New Password",modelValue:e.password,"onUpdate:modelValue":o[2]||(o[2]=o=>e.password=o),allowBadPassword:e.me.webmaster,passwordHints:e.hints},null,8,["modelValue","allowBadPassword","passwordHints"])],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var q=o({props:{type:String,modelValue:{type:Object,required:!0},hasHome:{type:Boolean,default:!1},help:String},emits:["update:modelValue"],setup(e,{emit:o}){var n;const{modelValue:t}=g(e),a=r(""),s=r(""),l=r(!1);let d="",p=0,c=0;(null==(n=e.modelValue)?void 0:n.address)&&(d=e.modelValue.address,a.value=e.modelValue.address.split(",")[0],s.value=e.modelValue.address.replace(/^[^,]*, */,""),p=e.modelValue.latitude||0,c=e.modelValue.longitude||0),e.modelValue?l.value=e.modelValue.sameAsHome||!1:l.value="Mail"===e.type,C(a,(()=>{""===a.value?s.value="":""===s.value&&(s.value="Sunnyvale, CA")}));const m=r(null);C(l,(()=>{a.value=s.value="",o("update:modelValue",{address:"",latitude:0,longitude:0,sameAsHome:l.value}),l.value||u((()=>{var e;null==(e=m.value)||e.focus()}))}));const v=r(null);const h=r(""),f=i("setValidity");C(h,(()=>{null==f||f(`person-address-${e.type}`,!h.value)}));const{submitted:w}=y();async function b(){if(!a.value&&!s.value)return void o("update:modelValue",{address:"",latitude:0,longitude:0,sameAsHome:l.value});let e=`${a.value}, ${s.value}`;if(e.match(/\W[A-Za-z][A-Za-z]\W/)||(e+=", CA"),e===d)return;const n={address:{regionCode:"US",addressLines:[e]}},t=await fetch("https://addressvalidation.googleapis.com/v1:validateAddress?key=AIzaSyCgi3GzjWG35S89-tnkxHgi5TJVD2eUe2o",{method:"POST",body:JSON.stringify(n)});if(!t||!t.ok)return void(h.value="The address could not be verified because the address verification service is not available.");const r=(await t.json()).result;if("SUB_PREMISE"!==r.verdict.validationGranularity&&"PREMISE"!==r.verdict.validationGranularity)d=e,h.value="We couldn't locate this address.  Please provide a valid address.";else{let e=r.address.formattedAddress;a.value=e.split(",")[0],s.value=e.replace(/^[^,]*, */,""),s.value=s.value.replace(/-[0-8]{4}/,""),s.value=s.value.replace(", USA",""),d=a.value+", "+s.value,p=c=0,r.geocode&&r.geocode.location&&(p=r.geocode.location.latitude,c=r.geocode.location.longitude),o("update:modelValue",{address:d,latitude:p,longitude:c})}}C(w,b);const k="Home"===e.type?"Home Address":"Work"===e.type?"Business Hours Address":"Mailing Address";return{error:h,label:k,line1:a,line1input:m,line2:s,line2input:v,onFocusLine2:function(){var e;null==(e=v.value)||e.select()},onBlur:function(e){e.relatedTarget!==m.value&&e.relatedTarget!==v.value&&b()},sameAsHome:l}}});const z={class:"form-item-input"},L={key:0,class:"person-address-same-box"},Y={class:"form-item-help person-address-helpbox"};q.render=function(e,o,n,t,a,s){return m(),c(f,null,[h("label",{class:["form-item-label",`person-address-label-${e.type}`],textContent:b(e.label)},null,10,["textContent"]),h("div",z,["Home"!==e.type?(m(),c("div",L,[k(h("input",{class:"person-address-same",id:`person-address-${e.type}-same`,type:"checkbox",autocomplete:"off","onUpdate:modelValue":o[1]||(o[1]=o=>e.sameAsHome=o),disabled:!e.hasHome},null,8,["id","disabled"]),[[S,e.sameAsHome]]),h("label",{class:"person-address-same-label",for:`person-address-${e.type}-same`},"Same as home address",8,["for"])])):w("",!0),e.sameAsHome?w("",!0):k((m(),c("input",{key:1,class:["form-control person-address-input",{"form-control-invalid":e.error}],ref:"line1input",id:`person-address-${e.type}`,"onUpdate:modelValue":o[2]||(o[2]=o=>e.line1=o),onBlur:o[3]||(o[3]=(...o)=>e.onBlur&&e.onBlur(...o))},null,42,["id"])),[[E,e.line1]]),e.sameAsHome?w("",!0):k((m(),c("input",{key:2,class:["form-control person-address-input",{"form-control-invalid":e.error}],ref:"line2input","onUpdate:modelValue":o[4]||(o[4]=o=>e.line2=o),onFocus:o[5]||(o[5]=(...o)=>e.onFocusLine2&&e.onFocusLine2(...o)),onBlur:o[6]||(o[6]=(...o)=>e.onBlur&&e.onBlur(...o))},null,34)),[[E,e.line2]])]),h("div",Y,[e.help?(m(),c("div",{key:0,class:"form-item-help-text",textContent:b(e.help)},null,8,["textContent"])):w("",!0),e.error?(m(),c("div",{key:1,class:"form-item-error-text",textContent:b(e.error)},null,8,["textContent"])):w("",!0)])],64)};const W=["Co-worker","Daughter","Father","Friend","Mother","Neighbor","Other","Relative","Son","Spouse","Supervisor"];var G=o({components:{Modal:n,PersonEditAddress:q,SForm:t,SFInput:a,SFSelect:P,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=r(null);const n=r({}),t=r(!0);const a=r("");const s=r("");const l=r(!1);return{loading:t,modal:o,onCancel:function(){o.value.close(!1)},onSubmit:async function(){var t=new FormData;t.append("email",n.value.email),t.append("email2",n.value.email2),t.append("cellPhone",n.value.cellPhone),t.append("homePhone",n.value.homePhone),t.append("workPhone",n.value.workPhone),n.value.homeAddress.address&&(t.append("homeAddress",n.value.homeAddress.address),t.append("homeAddressLatitude",(n.value.homeAddress.latitude||0).toString()),t.append("homeAddressLongitude",(n.value.homeAddress.longitude||0).toString())),n.value.workAddress.address?(t.append("workAddress",n.value.workAddress.address),t.append("workAddressLatitude",(n.value.workAddress.latitude||0).toString()),t.append("workAddressLongitude",(n.value.workAddress.longitude||0).toString())):t.append("workAddressSameAsHome",n.value.workAddress.sameAsHome.toString()),n.value.mailAddress.address?t.append("mailAddress",n.value.mailAddress.address):t.append("mailAddressSameAsHome",n.value.mailAddress.sameAsHome.toString()),n.value.canEditEmContacts&&(t.append("emContact1Name",n.value.emContacts[0].name),t.append("emContact1HomePhone",n.value.emContacts[0].homePhone),t.append("emContact1CellPhone",n.value.emContacts[0].cellPhone),t.append("emContact1Relationship",n.value.emContacts[0].relationship),t.append("emContact2Name",n.value.emContacts[1].name),t.append("emContact2HomePhone",n.value.emContacts[1].homePhone),t.append("emContact2CellPhone",n.value.emContacts[1].cellPhone),t.append("emContact2Relationship",n.value.emContacts[1].relationship)),l.value=!0;try{await d.post(`/api/people/${e.pid}/contact`,t),o.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;switch(e.response.data){case"email":a.value=n.value.email;break;case"cellPhone":s.value=n.value.cellPhone}}finally{l.value=!1}},person:n,show:function(){return async function(){if(t.value=!0,n.value=(await d.get(`/api/people/${e.pid}/contact`)).data,n.value.canEditEmContacts)for(;n.value.emContacts.length<2;)n.value.emContacts.push({name:"",homePhone:"",cellPhone:"",relationship:""});t.value=!1}(),o.value.show()},submitting:l,emailError:function(e){var o;return e&&(null==(o=n.value)?void 0:o.email)?n.value.email.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)?a.value===n.value.email?"Another user has this email address.":"":"This is not a valid email address.":""},email2Error:function(e){var o;return e&&(null==(o=n.value)?void 0:o.email2)?n.value.email2.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)?n.value.email===n.value.email2?"The two email addresses should not be the same.  (Leave this field empty if you only have one.)":"":"This is not a valid email address.":""},cellPhoneError:function(e){var o;return(null==(o=n.value)?void 0:o.cellPhone)?e&&10!==n.value.cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":s.value===n.value.cellPhone?"A different person has this cell phone number.":"":""},homePhoneError:function(e){var o;return e&&(null==(o=n.value)?void 0:o.homePhone)&&10!==n.value.homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},workPhoneError:function(e){var o;return e&&(null==(o=n.value)?void 0:o.workPhone)&&10!==n.value.workPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},emContact1HomePhoneError:function(e,o){var t,a;return e?o&&n.value.emContacts[0].name&&!n.value.emContacts[0].homePhone&&!n.value.emContacts[0].cellPhone?"The emergency contact must have at least one phone number.":(null==(t=n.value)?void 0:t.emContacts)&&(null==(a=n.value)?void 0:a.emContacts[0].homePhone)&&10!==n.value.emContacts[0].homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":"":""},emContact1CellPhoneError:function(e,o){var t;return e&&(null==(t=n.value)?void 0:t.emContacts[0].cellPhone)&&10!==n.value.emContacts[0].cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},emContact1RelationshipError:function(e,o){return e&&o&&n.value.emContacts[0].name&&!n.value.emContacts[0].relationship?"The relationship is required.":""},emContact2HomePhoneError:function(e,o){var t,a;return e?o&&n.value.emContacts[1].name&&!n.value.emContacts[1].homePhone&&!n.value.emContacts[1].cellPhone?"The emergency contact must have at least one phone number.":(null==(t=n.value)?void 0:t.emContacts)&&(null==(a=n.value)?void 0:a.emContacts[1].homePhone)&&10!==n.value.emContacts[1].homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":"":""},emContact2CellPhoneError:function(e,o){var t;return e&&(null==(t=n.value)?void 0:t.emContacts[1].cellPhone)&&10!==n.value.emContacts[1].cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},emContact2RelationshipError:function(e,o){return e&&o&&n.value.emContacts[1].name&&!n.value.emContacts[1].relationship?"The relationship is required.":""},relationshipOptions:W}}});const Z=h("div",{class:"form-item person-emContact"},"Emergency Contact 1",-1),j=h("div",{class:"form-item person-emContact"},"Emergency Contact 2",-1);G.render=function(e,o,n,t,a,s){const l=p("SSpinner"),r=p("SFInput"),i=p("PersonEditAddress"),d=p("SFSelect"),u=p("SForm"),g=p("Modal");return m(),c(g,{ref:"modal"},{default:v((()=>[h(u,{dialog:"",variant:"primary",title:"Edit Contact Information",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.loading?(m(),c(l,{key:0})):(m(),c(f,{key:1},[h(r,{id:"person-email",label:"Email",help:"This is the email address you log in with.",trim:"",autofocus:"",modelValue:e.person.email,"onUpdate:modelValue":o[1]||(o[1]=o=>e.person.email=o),errorFn:e.emailError,style:{"text-transform":"lowercase"}},null,8,["modelValue","errorFn"]),h(r,{id:"person-email2",label:"Alt. Email",trim:"",modelValue:e.person.email2,"onUpdate:modelValue":o[2]||(o[2]=o=>e.person.email2=o),errorFn:e.email2Error,style:{"text-transform":"lowercase"}},null,8,["modelValue","errorFn"]),h(r,{id:"person-cellPhone",label:"Cell Phone",trim:"",modelValue:e.person.cellPhone,"onUpdate:modelValue":o[3]||(o[3]=o=>e.person.cellPhone=o),errorFn:e.cellPhoneError},null,8,["modelValue","errorFn"]),h(r,{id:"person-homePhone",label:"Home Phone",trim:"",modelValue:e.person.homePhone,"onUpdate:modelValue":o[4]||(o[4]=o=>e.person.homePhone=o),errorFn:e.homePhoneError},null,8,["modelValue","errorFn"]),h(r,{id:"person-workPhone",label:"Work Phone",trim:"",modelValue:e.person.workPhone,"onUpdate:modelValue":o[5]||(o[5]=o=>e.person.workPhone=o),errorFn:e.workPhoneError},null,8,["modelValue","errorFn"]),h(i,{type:"Home",modelValue:e.person.homeAddress,"onUpdate:modelValue":o[6]||(o[6]=o=>e.person.homeAddress=o)},null,8,["modelValue"]),h(i,{type:"Work",modelValue:e.person.workAddress,"onUpdate:modelValue":o[7]||(o[7]=o=>e.person.workAddress=o),hasHome:!!e.person.homeAddress.address},null,8,["modelValue","hasHome"]),h(i,{type:"Mail",modelValue:e.person.mailAddress,"onUpdate:modelValue":o[8]||(o[8]=o=>e.person.mailAddress=o),hasHome:!!e.person.homeAddress.address},null,8,["modelValue","hasHome"]),e.person.canEditEmContacts?(m(),c(f,{key:0},[Z,h(r,{id:"person-emContact1Name",label:"Name",trim:"",modelValue:e.person.emContacts[0].name,"onUpdate:modelValue":o[9]||(o[9]=o=>e.person.emContacts[0].name=o)},null,8,["modelValue"]),h(r,{id:"person-emContact1HomePhone",label:"Home Phone",trim:"",modelValue:e.person.emContacts[0].homePhone,"onUpdate:modelValue":o[10]||(o[10]=o=>e.person.emContacts[0].homePhone=o),errorFn:e.emContact1HomePhoneError},null,8,["modelValue","errorFn"]),h(r,{id:"person-emContact1CellPhone",label:"Cell Phone",trim:"",modelValue:e.person.emContacts[0].cellPhone,"onUpdate:modelValue":o[11]||(o[11]=o=>e.person.emContacts[0].cellPhone=o),errorFn:e.emContact1CellPhoneError},null,8,["modelValue","errorFn"]),h(d,{id:"person-emContact1Relationship",label:"Relationship",options:e.relationshipOptions,modelValue:e.person.emContacts[0].relationship,"onUpdate:modelValue":o[12]||(o[12]=o=>e.person.emContacts[0].relationship=o),errorFn:e.emContact1RelationshipError},null,8,["options","modelValue","errorFn"]),j,h(r,{id:"person-emContact2Name",label:"Name",trim:"",modelValue:e.person.emContacts[1].name,"onUpdate:modelValue":o[13]||(o[13]=o=>e.person.emContacts[1].name=o)},null,8,["modelValue"]),h(r,{id:"person-emContact2HomePhone",label:"Home Phone",trim:"",modelValue:e.person.emContacts[1].homePhone,"onUpdate:modelValue":o[14]||(o[14]=o=>e.person.emContacts[1].homePhone=o),errorFn:e.emContact2HomePhoneError},null,8,["modelValue","errorFn"]),h(r,{id:"person-emContact2CellPhone",label:"Cell Phone",trim:"",modelValue:e.person.emContacts[1].cellPhone,"onUpdate:modelValue":o[15]||(o[15]=o=>e.person.emContacts[1].cellPhone=o),errorFn:e.emContact2CellPhoneError},null,8,["modelValue","errorFn"]),h(d,{id:"person-emContact2Relationship",label:"Relationship",options:e.relationshipOptions,modelValue:e.person.emContacts[1].relationship,"onUpdate:modelValue":o[16]||(o[16]=o=>e.person.emContacts[1].relationship=o),errorFn:e.emContact2RelationshipError},null,8,["options","modelValue","errorFn"])],64)):w("",!0)],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var J=o({components:{SButton:V},props:{title:{type:String,required:!0},editable:{type:Boolean,required:!0}},emits:["edit"]});const K={class:"person-view-section-header"},Q={key:0,class:"person-view-section-edit"},X=x("Edit");J.render=function(e,o,n,t,a,s){const l=p("SButton");return m(),c("div",{class:["person-view-section",{"person-view-section-editable":e.editable}]},[h("div",K,[h("div",{class:"person-view-section-header-text",textContent:b(e.title)},null,8,["textContent"]),e.editable?(m(),c("div",Q,[h(l,{class:"person-view-section-ebtn",variant:"primary",small:"",onClick:o[1]||(o[1]=o=>e.$emit("edit"))},{default:v((()=>[X])),_:1})])):w("",!0)]),A(e.$slots,"default")],2)};var ee=o({components:{PersonEditContact:G,PersonViewSection:J},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=R((()=>!!e.person.contact&&(e.person.contact.email||e.person.contact.email2||e.person.contact.cellPhone||e.person.contact.homePhone||e.person.contact.workPhone||e.person.contact.homeAddress||e.person.contact.workAddress||e.person.contact.mailAddress))),t=r(null);return{editContactModal:t,hasContactInfo:n,onEditContact:async function(){await t.value.show()&&o("reload")}}}});const oe={key:0,id:"person-view-emails"},ne={key:0},te={key:1},ae={key:1,class:"person-view-phone"},se=h("span",{class:"person-view-phone-label"},"(Cell)",-1),le={key:2,class:"person-view-phone"},re=h("span",{class:"person-view-phone-label"},"(Home)",-1),ie={key:3,class:"person-view-phone"},de=h("span",{class:"person-view-phone-label"},"(Work)",-1),ue={key:4,class:"person-view-address"},pe={key:0},ce={key:1},me={key:5,class:"person-view-address"},ve=h("span",null,"Work Address:",-1),he={key:6,class:"person-view-address"},fe=h("div",null,"Mailing Address:",-1);ee.render=function(e,o,n,t,a,s){const l=p("PersonEditContact"),r=p("PersonViewSection");return e.hasContactInfo||e.person.canEdit?(m(),c(r,{key:0,title:"Contact Information",editable:e.person.canEdit,onEdit:e.onEditContact},{default:v((()=>[e.person.contact.email||e.person.contact.email2?(m(),c("div",oe,[e.person.contact.email?(m(),c("div",ne,[h("a",{href:`mailto:${e.person.contact.email}`,textContent:b(e.person.contact.email)},null,8,["href","textContent"])])):w("",!0),e.person.contact.email2?(m(),c("div",te,[h("a",{href:`mailto:${e.person.contact.email2}`,textContent:b(e.person.contact.email2)},null,8,["href","textContent"])])):w("",!0)])):w("",!0),e.person.contact.cellPhone?(m(),c("div",ae,[h("a",{href:`tel:${e.person.contact.cellPhone}`,textContent:b(e.person.contact.cellPhone)},null,8,["href","textContent"]),se])):w("",!0),e.person.contact.homePhone?(m(),c("div",le,[h("a",{href:`tel:${e.person.contact.homePhone}`,textContent:b(e.person.contact.homePhone)},null,8,["href","textContent"]),re])):w("",!0),e.person.contact.workPhone?(m(),c("div",ie,[h("a",{href:`tel:${e.person.contact.workPhone}`,textContent:b(e.person.contact.workPhone)},null,8,["href","textContent"]),de])):w("",!0),e.person.contact.homeAddress&&e.person.contact.homeAddress.address?(m(),c("div",ue,[h("div",null,[e.person.contact.workAddress&&e.person.contact.workAddress.sameAsHome?(m(),c("span",pe,"Home Address (all day):")):(m(),c("span",ce,"Home Address:")),h("a",{class:"person-view-map",target:"_blank",href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.person.contact.homeAddress.address)}`},"Map",8,["href"])]),h("div",{textContent:b(e.person.contact.homeAddress.address.split(",")[0])},null,8,["textContent"]),h("div",{textContent:b(e.person.contact.homeAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"]),e.person.contact.homeAddress.fireDistrict?(m(),c("div",{key:0,textContent:b(`Sunnyvale Fire District ${e.person.contact.homeAddress.fireDistrict}`)},null,8,["textContent"])):w("",!0)])):w("",!0),e.person.contact.workAddress&&e.person.contact.workAddress.address?(m(),c("div",me,[h("div",null,[ve,h("a",{class:"person-view-map",target:"_blank",href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.person.contact.workAddress.address)}`},"Map",8,["href"])]),h("div",{textContent:b(e.person.contact.workAddress.address.split(",")[0])},null,8,["textContent"]),h("div",{textContent:b(e.person.contact.workAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"]),e.person.contact.workAddress.fireDistrict?(m(),c("div",{key:0,textContent:b(`Sunnyvale Fire District ${e.person.contact.workAddress.fireDistrict}`)},null,8,["textContent"])):w("",!0)])):w("",!0),e.person.contact.mailAddress&&e.person.contact.mailAddress.address?(m(),c("div",he,[fe,h("div",{textContent:b(e.person.contact.mailAddress.address.split(",")[0])},null,8,["textContent"]),h("div",{textContent:b(e.person.contact.mailAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"])])):w("",!0),e.person.emContacts?(m(),c("div",{key:7,id:"person-view-emContacts",textContent:b(`${e.person.emContacts} emergency contact${e.person.emContacts>1?"s":""} on file`)},null,8,["textContent"])):w("",!0),e.person.canEdit?(m(),c(l,{key:8,ref:"editContactModal",pid:e.person.id},null,8,["pid"])):w("",!0)])),_:1},8,["editable","onEdit"])):w("",!0)};var we=o({components:{Modal:n,SForm:t,SFInput:a,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=r(null);const n=r({}),t=r(!0);const a=r(""),s=r("");function l(e){if(!e)return e;const o=e.split(/\s+/,2);return o.length>1?`${o[1]}, ${o[0]}`:e}C((()=>n.value.informalName),((e,o)=>{n.value.formalName===o&&(n.value.formalName=e),n.value.sortName===l(o)&&(n.value.sortName=l(e))}));const i=r(!1);return{birthdateError:function(e){return n.value.birthdate&&e&&!n.value.birthdate.match(/^(?:19|20)\d\d-\d\d-\d\d$/)?"This is not a valid YYYY-MM-DD date.":""},callSignError:function(e){var o;return n.value.callSign?e&&!n.value.callSign.match(/^[AKNW][A-Z]?[0-9][A-Z]{1,3}$/i)?"This is not a valid call sign.":a.value===(null==(o=n.value)?void 0:o.callSign)?"A different person has this call sign.":"":""},formalNameError:function(e){return e?n.value.formalName?"":"A name is required.":""},informalNameError:function(e){return e?n.value.informalName?"":"A name is required.":""},loading:t,modal:o,onCancel:function(){o.value.close(!1)},onSubmit:async function(){var t=new FormData;t.append("informalName",n.value.informalName),t.append("formalName",n.value.formalName),t.append("sortName",n.value.sortName),t.append("callSign",n.value.callSign),t.append("birthdate",n.value.birthdate),i.value=!0;try{await d.post(`/api/people/${e.pid}/names`,t),o.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;switch(e.response.data){case"sortName":s.value=n.value.sortName;break;case"callSign":a.value=n.value.callSign}}finally{i.value=!1}},person:n,show:function(){return async function(){t.value=!0,n.value=(await d.get(`/api/people/${e.pid}/names`)).data,t.value=!1}(),o.value.show()},sortNameError:function(e){var o;return n.value.sortName?s.value===(null==(o=n.value)?void 0:o.sortName)?"A different person has this name.":"":e?"A name is required.":""},submitting:i}}});we.render=function(e,o,n,t,a,s){const l=p("SSpinner"),r=p("SFInput"),i=p("SForm"),d=p("Modal");return m(),c(d,{ref:"modal"},{default:v((()=>[h(i,{dialog:"",variant:"primary",title:"Edit Names",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.loading?(m(),c(l,{key:0})):(m(),c(f,{key:1},[h(r,{id:"person-informalName",label:"Name",trim:"",autofocus:"",modelValue:e.person.informalName,"onUpdate:modelValue":o[1]||(o[1]=o=>e.person.informalName=o),errorFn:e.informalNameError,help:"What you like to be called, e.g. âJoe Banksâ"},null,8,["modelValue","errorFn"]),h(r,{id:"person-formalName",label:"Formal name",trim:"",modelValue:e.person.formalName,"onUpdate:modelValue":o[2]||(o[2]=o=>e.person.formalName=o),errorFn:e.formalNameError,help:"For formal documents, e.g. âJoseph A. Banks, Jr.â"},null,8,["modelValue","errorFn"]),h(r,{id:"person-sortName",label:"Sort name",trim:"",modelValue:e.person.sortName,"onUpdate:modelValue":o[3]||(o[3]=o=>e.person.sortName=o),errorFn:e.sortNameError,help:"For appearance in sorted lists, e.g. âBanks, Joeâ"},null,8,["modelValue","errorFn"]),h(r,{id:"person-callSign",label:"Call sign",trim:"",modelValue:e.person.callSign,"onUpdate:modelValue":o[4]||(o[4]=o=>e.person.callSign=o),errorFn:e.callSignError,help:"FCC amateur radio license",style:{"text-transform":"uppercase"}},null,8,["modelValue","errorFn"]),e.person.birthdate||""===e.person.birthdate?(m(),c(r,{key:0,id:"person-callSign",label:"Birthdate",type:"date",modelValue:e.person.birthdate,"onUpdate:modelValue":o[5]||(o[5]=o=>e.person.birthdate=o),errorFn:e.birthdateError},null,8,["modelValue","errorFn"])):w("",!0)],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var ge=o({components:{PersonEditNames:we,SButton:V},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=r(null);return{editNamesModal:n,onEditNames:async function(){await n.value.show()&&o("reload")}}}});const Ce={id:"person-view-names"},ye={id:"person-view-names-ifc"},be={id:"person-view-names-ic"},ke={key:0,id:"person-view-names-edit"},Se=x("Edit");ge.render=function(e,o,n,t,a,s){const l=p("SButton"),r=p("PersonEditNames");return m(),c("div",Ce,[h("div",ye,[h("div",be,[h("div",{id:"person-view-names-i",textContent:b(e.person.informalName)},null,8,["textContent"]),e.person.callSign?(m(),c("div",{key:0,id:"person-view-names-c",textContent:b(e.person.callSign)},null,8,["textContent"])):w("",!0)]),e.person.formalName!==e.person.informalName?(m(),c("div",{key:0,id:"person-view-names-f",textContent:b(`(${e.person.formalName})`)},null,8,["textContent"])):w("",!0)]),e.person.canEdit?(m(),c("div",ke,[h(l,{variant:"primary",small:"",onClick:e.onEditNames},{default:v((()=>[Se])),_:1},8,["onClick"])])):w("",!0),e.person.canEdit?(m(),c(r,{key:1,ref:"editNamesModal",pid:e.person.id},null,8,["pid"])):w("",!0)])};const Ee={webmaster:"Webmasters only",admin:"DPS staff only",leader:"SERV leads only",contact:"Anyone who can see contact info",person:"Anyone"};let Pe=[{value:"webmaster",label:"Webmasters only"},{value:"admin",label:"DPS staff only"},{value:"leader",label:"SERV leads only"},{value:"contact",label:"Anyone who can see contact info"},{value:"person",label:"Anyone"}];var Ve=o({components:{Modal:n,SButton:V,SForm:t,SFInput:a,SFSelect:P,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=r(null);const n=r([]),t=r([]),a=r({}),s=r(!0);const l=r(null);const i=r(!1);return{editNote:function(e){a.value.date&&a.value.note&&n.value.push(a.value),t.value.forEach((e=>n.value.push(e)));const o=n.value.findIndex((o=>o===e));t.value=n.value.splice(o+1),a.value=n.value.splice(o,1)[0],u((()=>{l.value.focus()}))},loading:s,modal:o,noteEditing:a,noteRef:l,notesAfter:t,notesBefore:n,onAdd:function(){a.value.date&&a.value.note&&n.value.push(a.value),t.value.forEach((e=>n.value.push(e))),t.value=[],a.value={date:F().format("YYYY-MM-DD"),note:"",visibility:Pe[0].value},u((()=>{l.value.focus()}))},onCancel:function(){o.value.close(!1)},onSubmit:async function(){var s=new FormData;n.value.forEach((e=>{s.append("note",e.note),s.append("date",e.date),s.append("visibility",e.visibility)})),a.value.date&&a.value.note&&(s.append("note",a.value.note),s.append("date",a.value.date),s.append("visibility",a.value.visibility)),t.value.forEach((e=>{s.append("note",e.note),s.append("date",e.date),s.append("visibility",e.visibility)})),i.value=!0,await d.post(`/api/people/${e.pid}/notes`,s),i.value=!1,o.value.close(!0)},show:function(){return async function(){s.value=!0;const o=(await d.get(`/api/people/${e.pid}/notes`)).data;n.value=o.notes,n.value.sort(((e,o)=>e.date!==o.date?e.date<o.date?-1:1:e.note.localeCompare(o.note))),t.value=[],Pe=Pe.filter((e=>o.visibilities.includes(e.value))),n.value.length?a.value={date:"",note:"",visibility:""}:a.value={date:F().format("YYYY-MM-DD"),note:"",visibility:Pe[0].value};s.value=!1}(),o.value.show()},submitting:i,visibilityLabels:Ee,visibilityOptions:Pe}}});const Ae={key:0,class:"form-item",id:"person-edit-note-help"},xe=h("div",null,"Date",-1),Re=h("div",null,"Note",-1),Fe=h("div",null,"Vis.",-1),Ne=h("div",null,"Date",-1),Me=h("div",null,"Note",-1),$e=h("div",null,"Vis.",-1),Te=x("Add");Ve.render=function(e,o,n,t,a,s){const l=p("SSpinner"),r=p("SFInput"),i=p("SFSelect"),d=p("SButton"),u=p("SForm"),g=p("Modal");return m(),c(g,{ref:"modal"},{default:v((()=>[h(u,{dialog:"",variant:"primary",title:"Edit Notes",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{extraButtons:v((()=>[h(d,{variant:"primary",onClick:e.onAdd},{default:v((()=>[Te])),_:1},8,["onClick"])])),default:v((()=>[e.loading?(m(),c(l,{key:0})):(m(),c(f,{key:1},[e.notesBefore.length||e.notesAfter.length?(m(),c("div",Ae,"Click on a note to edit it, or click the Add button to add one.")):w("",!0),(m(!0),c(f,null,N(e.notesBefore,(o=>(m(),c("div",{class:"person-edit-note form-item",onClick:n=>e.editNote(o)},[xe,h("div",{textContent:b(o.date)},null,8,["textContent"]),Re,h("div",{textContent:b(o.note)},null,8,["textContent"]),Fe,h("div",{textContent:b(e.visibilityLabels[o.visibility])},null,8,["textContent"])],8,["onClick"])))),256)),e.noteEditing.date?(m(),c(f,{key:1},[h(r,{id:"person-edit-note-date",label:"Date",type:"date",modelValue:e.noteEditing.date,"onUpdate:modelValue":o[1]||(o[1]=o=>e.noteEditing.date=o)},null,8,["modelValue"]),h(r,{id:"person-edit-note-note",ref:"noteRef",label:"Note Text",trim:"",modelValue:e.noteEditing.note,"onUpdate:modelValue":o[2]||(o[2]=o=>e.noteEditing.note=o)},null,8,["modelValue"]),h(i,{id:"person-edit-note-visibility",label:"Visibility",options:e.visibilityOptions,modelValue:e.noteEditing.visibility,"onUpdate:modelValue":o[3]||(o[3]=o=>e.noteEditing.visibility=o)},null,8,["options","modelValue"])],64)):w("",!0),(m(!0),c(f,null,N(e.notesAfter,(o=>(m(),c("div",{class:"person-edit-note form-item",onClick:n=>e.editNote(o)},[Ne,h("div",{textContent:b(o.date)},null,8,["textContent"]),Me,h("div",{textContent:b(o.note)},null,8,["textContent"]),$e,h("div",{textContent:b(e.visibilityLabels[o.visibility])},null,8,["textContent"])],8,["onClick"])))),256))],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var De=o({components:{PersonEditNotes:Ve,PersonViewSection:J},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=r(null);return{editNotesModal:n,onEditNotes:async function(){await n.value.show()&&o("reload")}}}});const Be={id:"person-view-notes"},Ue={class:"person-view-note"},He={key:0};De.render=function(e,o,n,t,a,s){const l=p("PersonEditNotes"),r=p("PersonViewSection");return e.person.notes.length||e.person.canEditNotes?(m(),c(r,{key:0,title:"Notes",editable:e.person.canEditNotes,onEdit:e.onEditNotes},{default:v((()=>[h("div",Be,[(m(!0),c(f,null,N(e.person.notes,(e=>(m(),c("div",Ue,[h("div",{class:"person-view-note-date",textContent:b(e.date)},null,8,["textContent"]),h("div",{class:"person-view-note-text",textContent:b(e.note)},null,8,["textContent"])])))),256)),e.person.notes.length?w("",!0):(m(),c("div",He,"No notes on file."))]),e.person.canEdit?(m(),c(l,{key:0,ref:"editNotesModal",pid:e.person.id},null,8,["pid"])):w("",!0)])),_:1},8,["editable","onEdit"])):w("",!0)};const _e={admin:"Admin","cert-d":"CERT Deployment","cert-t":"CERT Training",listos:"Listos",sares:"SARES",snap:"SNAP"};var Ie=o({components:{Modal:n,SFCheckGroup:M,SForm:t,SFSelect:P,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=r(null);const n=r([]),t=r("");const a=r([]),s=r(new Set);C(t,(()=>{if(!n.value.length)return;const e=n.value.find((e=>e.org===t.value)).roles;s.value=new Set(e.filter((e=>e.held)).map((e=>e.id)))})),C([s,t],((e,o)=>{if(!n.value.length)return;let l=e[1]!=o[1];if(e[0].forEach((e=>{o[0].has(e)||(l=!0)})),o[0].forEach((o=>{e[0].has(o)||(l=!0)})),!l)return;const r=new Set,i=new Set;n.value.forEach((e=>{e.org===t.value?e.roles.filter((e=>(!e.held||e.direct)&&s.value.has(e.id))).forEach((e=>{r.add(e.id),e.implies.forEach((e=>i.add(e)))})):e.roles.filter((e=>e.held&&e.direct)).forEach((e=>{r.add(e.id),e.implies.forEach((e=>i.add(e)))}))})),n.value.forEach((e=>{e.roles.forEach((e=>{r.has(e.id)?e.held=e.direct=!0:i.has(e.id)?(e.held=!0,e.direct=!1):e.held=e.direct=!1}))}));const d=n.value.find((e=>e.org===t.value)).roles;s.value=new Set(d.filter((e=>e.held)).map((e=>e.id))),a.value=d.map((e=>({value:e.id,label:e.name,disabled:e.implicitOnly||e.held&&!e.direct})))}));const l=r(!1);return{modal:o,onCancel:function(){o.value.close(!1)},onSubmit:async function(){var t=new FormData;n.value.forEach((e=>{e.roles.filter((e=>e.held&&e.direct)).forEach((e=>{t.append("role",e.id.toString())}))})),l.value=!0,await d.post(`/api/people/${e.pid}/roles`,t),l.value=!1,o.value.close(!0)},org:t,orgRoleOptions:a,orgRoles:s,orgs:n,show:function(){return async function(){n.value=[],t.value="",n.value=(await d.get(`/api/people/${e.pid}/roles`)).data,n.value.forEach((e=>{e.fmtOrg=_e[e.org]})),t.value=n.value[0].org}(),o.value.show()},submitting:l}}});function Oe(e){return"admin"===e.org&&e.title.startsWith("OES")?"dps":"admin"===e.org?"serv":e.org.replace(/-.*/,"")}Ie.render=function(e,o,n,t,a,s){const l=p("SSpinner"),r=p("SFSelect"),i=p("SFCheckGroup"),d=p("SForm"),u=p("Modal");return m(),c(u,{ref:"modal"},{default:v((()=>[h(d,{dialog:"",variant:"primary",title:"Edit Roles",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.orgs.length?(m(),c(f,{key:1},[e.orgs.length>1?(m(),c(r,{key:0,id:"person-roles-org",label:"Org",options:e.orgs,valueKey:"org",labelKey:"fmtOrg",modelValue:e.org,"onUpdate:modelValue":o[1]||(o[1]=o=>e.org=o)},null,8,["options","modelValue"])):w("",!0),h(i,{id:"person-roles-roles",label:e.orgs.length>1?"Roles":"",options:e.orgRoleOptions,disabledKey:"disabled",modelValue:e.orgRoles,"onUpdate:modelValue":o[2]||(o[2]=o=>e.orgRoles=o)},null,8,["label","options","modelValue"])],64)):(m(),c(l,{key:0}))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var qe=o({components:{OrgBadge:$,PersonEditRoles:Ie,PersonViewSection:J},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=r([]);T((()=>{n.value=[],e.person.roles.forEach((e=>{const o=n.value.findIndex((o=>o.org===Oe(e)));o<0?n.value.push({org:Oe(e),titles:[e.title]}):n.value[o].titles.push(e.title)}))}));const t=r(null);return{editRolesModal:t,onEditRoles:async function(){await t.value.show()&&o("reload")},badges:n}}});const ze={id:"person-view-roles-badges"},Le={class:"person-view-roles-titles"},Ye={key:0,class:"person-view-roles-title"};qe.render=function(e,o,n,t,a,s){const l=p("OrgBadge"),r=p("PersonEditRoles"),i=p("PersonViewSection");return e.badges.length||e.person.canEditRoles?(m(),c(i,{key:0,title:"SERV "+(1===e.person.roles.length?"Role":"Roles"),editable:e.person.canEditRoles,onEdit:e.onEditRoles},{default:v((()=>[h("div",ze,[(m(!0),c(f,null,N(e.badges,(e=>(m(),c(f,null,[h(l,{class:"person-view-roles-badge",org:e.org},null,8,["org"]),h("div",Le,[(m(!0),c(f,null,N(e.titles,(e=>(m(),c("div",{class:"person-view-roles-title",textContent:b(e)},null,8,["textContent"])))),256))])],64)))),256)),e.badges.length?w("",!0):(m(),c("div",Ye,"No current role in any SERV org."))]),e.person.canEditRoles?(m(),c(r,{key:0,ref:"editRolesModal",pid:e.person.id},null,8,["pid"])):w("",!0)])),_:1},8,["title","editable","onEdit"])):w("",!0)};const We=o({name:"PersonEditBGChecks",props:{checks:{type:Array,required:!0},types:{type:Array,required:!0}},setup(e,{expose:o}){const n=r([...e.checks]),t=r([]),a=r({date:"",types:new Set,assumed:!1}),s=r(0===e.checks.length);function l(){return!s.value||!(a.value.date&&!a.value.date.match(/^20\d\d-\d\d-\d\d$/))&&(a.value.types.size&&n.value.push({date:a.value.date,types:e.types.filter((e=>a.value.types.has(e))),assumed:a.value.assumed}),n.value.splice(n.value.length,0,...t.value.splice(0)),n.value.sort(((e,o)=>e.date.localeCompare(o.date))),s.value=!1,!0)}function i(e){if(!l())return;a.value.date=e.date,a.value.types=new Set(e.types),a.value.assumed=e.assumed;const o=n.value.findIndex((o=>o===e));t.value.splice(t.value.length,0,...n.value.splice(o+1)),n.value.splice(o),s.value=!0}return o({startAdd:function(){console.log("startAdd called"),l()&&(a.value.date=F().format("YYYY-MM-DD"),a.value.types=new Set,a.value.assumed=!1,s.value=!0)},prepareForSave:function(){l(),e.checks.splice(0,e.checks.length,...n.value)}}),function(){return[(o=e.checks,[D("div",{id:"person-edbg-header",class:"form-item"},"Background Checks"),o.length?D("div",{id:"person-edbg-help",class:"form-item"},"Click on a check to edit it, or click Add to add one."):null]),Ge(n.value,i),s.value?Ze(a.value,e.types):null,Ge(t.value,i)];var o}}});function Ge(e,o){return e.map((e=>D("div",{class:"form-item-input",onClick:()=>{o(e)}},`${e.date||"Unknown date"}: ${e.types.join(", ")}${e.assumed?" (assumed)":""}`)))}function Ze(e,o){return[D(a,{id:"person-edbg-date",label:"Date",help:"Date on which the background check was cleared (empty if not known)",type:"date",modelValue:e.date,"onUpdate:modelValue":o=>e.date=o,errorFn:o=>o&&""!==e.date?e.date.match(/^20\d\d-\d\d-\d\d$/)?"":"This is not a valid date.":""}),D(M,{id:"person-edbg-types",label:"Type(s)",options:o,inline:!0,modelValue:e.types,"onUpdate:modelValue":o=>e.types=o}),D(B,{id:"person-edbg-assumed",label:"Assumed (no paper record)",help:"Checks are assumed for long-standing volunteers whose historical records are missing.",modelValue:e.assumed,"onUpdate:modelValue":o=>e.assumed=o})]}function je(e){return e.replace(/[^0-9]/g,"")}var Je=o({components:{Modal:n,PersonEditBGChecks:We,SButton:V,SForm:t,SFCheckGroup:M,SFInput:a,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=r(null);const n=r({}),t=r(""),a=r(new Set),s=r([]),l=r(!0);const i=r(null);const u=r(!1);return{bgChecksRef:i,digitsOnly:je,dswCERTError:function(e){return e&&n.value.dswCERT?n.value.dswCERT.match(/^20\d\d-\d\d-\d\d$/)?"":"This is not a valid YYYY-MM-DD date.":""},dswCommError:function(e){return e&&n.value.dswComm?n.value.dswComm.match(/^20\d\d-\d\d-\d\d$/)?"":"This is not a valid YYYY-MM-DD date.":""},identification:a,identTypes:s,loading:l,modal:o,onAddBGCheck:function(){var e;console.log("onAddBGCheck called"),null==(e=i.value)||e.startAdd()},onCancel:function(){o.value.close(!1)},onSubmit:async function(){var s;null==(s=i.value)||s.prepareForSave();var l=new FormData;l.append("volgistics",t.value),l.append("dswCERT",n.value.dswCERT||""),l.append("dswComm",n.value.dswComm||""),a.value.forEach((e=>{l.append("identification",e)})),n.value.bgChecks.forEach((e=>{l.append("bgCheck",`${e.date}:${e.types.join(",")}:${e.assumed}`)})),u.value=!0,await d.post(`/api/people/${e.pid}/status`,l),u.value=!1,o.value.close(!0)},person:n,show:function(){return async function(){l.value=!0,n.value=(await d.get(`/api/people/${e.pid}/status`)).data,t.value=n.value.volgistics?n.value.volgistics.toString():"",s.value=n.value.identification.map((e=>({label:e.type,value:e.type}))),a.value=new Set(n.value.identification.filter((e=>e.held)).map((e=>e.type))),l.value=!1}(),o.value.show()},submitting:u,volgistics:t,volgisticsError:function(e){return e&&t.value&&parseInt(t.value)<1?"This is not a valid Volgistics ID number.":""}}}});const Ke=x("Add");Je.render=function(e,o,n,t,a,s){const l=p("SSpinner"),r=p("SFInput"),i=p("SFCheckGroup"),d=p("PersonEditBGChecks"),u=p("SButton"),w=p("SForm"),g=p("Modal");return m(),c(g,{ref:"modal"},{default:v((()=>[h(w,{dialog:"",variant:"primary",title:"Edit Volunteer Status",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{extraButtons:v((()=>[h(u,{variant:"primary",onClick:U(e.onAddBGCheck,["prevent"])},{default:v((()=>[Ke])),_:1},8,["onClick"])])),default:v((()=>[e.loading?(m(),c(l,{key:0})):(m(),c(f,{key:1},[h(r,{id:"person-volgistics",label:"Volgistics ID",modelValue:e.volgistics,"onUpdate:modelValue":o[1]||(o[1]=o=>e.volgistics=o),autofocus:"",errorFn:e.volgisticsError,restrictFn:e.digitsOnly},null,8,["modelValue","errorFn","restrictFn"]),h(r,{id:"person-dsw-cert",type:"date",label:"DSW CERT",modelValue:e.person.dswCERT,"onUpdate:modelValue":o[2]||(o[2]=o=>e.person.dswCERT=o),errorFn:e.dswCERTError,help:"Date when CERT DSW registration form was signed."},null,8,["modelValue","errorFn","help"]),h(r,{id:"person-dsw-comm",type:"date",label:"DSW Communications",modelValue:e.person.dswComm,"onUpdate:modelValue":o[3]||(o[3]=o=>e.person.dswComm=o),errorFn:e.dswCommError,help:"Date when Communications DSW registration form was signed."},null,8,["modelValue","errorFn","help"]),h(i,{id:"person-identification",label:"IDs Issued",modelValue:e.identification,"onUpdate:modelValue":o[4]||(o[4]=o=>e.identification=o),options:e.identTypes},null,8,["modelValue","options"]),h(d,{ref:"bgChecksRef",checks:e.person.bgChecks,types:e.person.bgCheckTypes},null,8,["checks","types"])],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var Qe=o({components:{PersonEditStatus:Je,PersonViewSection:J},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=i("me"),t=R((()=>!(!(e.person.status&&e.person.status.backgroundCheck.admin&&e.person.status.backgroundCheck.needed)||e.person.status.backgroundCheck.checks.find((o=>o.type.indexOf(e.person.status.backgroundCheck.needed)>=0)))&&e.person.status.backgroundCheck.needed)),a=r(null);return{editStatusModal:a,onEditStatus:async function(){await a.value.show()&&o("reload")},me:n,missingBGCheck:t}}});const Xe={id:"person-view-status-grid"},eo=h("div",null,"Volgistics",-1),oo=h("div",null,"City volunteer",-1),no={key:0},to=h("a",{href:"https://www.volgistics.com/ex/portal.dll/ap?AP=929478828",target:"_blank"},"Please register",-1),ao={key:1,style:{color:"red"}},so=h("div",null,"City volunteer",-1),lo={key:0},ro={key:1},io=h("div",null,"DSW CERT",-1),uo={key:1},po={key:2},co={key:3},mo={key:4},vo=h("div",null,"DSW CERT",-1),ho=h("div",{style:{color:"red"}},"Not registered",-1),fo=h("div",null,"DSW SARES",-1),wo={key:1},go={key:2},Co={key:3},yo={key:4},bo=h("div",null,"DSW SARES",-1),ko=h("div",{style:{color:"red"}},"Not registered",-1),So=h("div",null,"Background Checks",-1),Eo={id:"person-view-status-checks"},Po={key:0,style:{color:"red"}},Vo=h("div",null,"Background check",-1),Ao=h("div",null,"Cleared",-1),xo=h("div",null,"Background check",-1),Ro=h("div",null,"Background check",-1),Fo=h("div",{style:{color:"red"}},"Not cleared",-1),No=h("div",null,"IDs issued",-1),Mo={id:"person-view-status-identification"};Qe.render=function(e,o,n,t,a,s){const l=p("PersonEditStatus"),r=p("PersonViewSection");return e.person.status?(m(),c(r,{key:0,title:"Volunteer Status",editable:e.person.status.canEdit,onEdit:e.onEditStatus},{default:v((()=>[h("div",Xe,["admin"===e.person.status.level?(m(),c(f,{key:0},[eo,e.person.status.volgistics.id?(m(),c("div",{key:0,textContent:b(`#${e.person.status.volgistics.id}`)},null,8,["textContent"])):(m(),c("div",{key:1,style:{color:e.person.status.volgistics.needed?"red":null}},"Not registered",4))],64)):e.person.status.volgistics.needed&&!e.person.status.volgistics.id?(m(),c(f,{key:1},[oo,e.me.id===e.person.id?(m(),c("div",no,[to])):(m(),c("div",ao,"Not registered"))],64)):(m(),c(f,{key:2},[so,e.person.status.volgistics.id?(m(),c("div",lo,"Registered")):(m(),c("div",ro,"Not registered"))],64)),e.person.status.dswCERT.registered?(m(),c(f,{key:3},[io,e.person.status.dswCERT.expired?(m(),c("div",{key:0,style:{color:e.person.status.dswCERT.needed?"red":null}},"Expired on "+b(e.person.status.dswCERT.expires),5)):"admin"==e.person.status.level&&e.person.status.dswCERT.expires?(m(),c("div",uo,"Registered "+b(e.person.status.dswCERT.registered)+", expiresÂ "+b(e.person.status.dswCERT.expires.replace(/-/g,"â")),1)):"admin"==e.person.status.level?(m(),c("div",po,"Registered "+b(e.person.status.dswCERT.registered),1)):e.person.status.dswCERT.expires?(m(),c("div",co,"Expires on "+b(e.person.status.dswCERT.expires),1)):(m(),c("div",mo,"Registered"))],64)):e.person.status.dswCERT.needed?(m(),c(f,{key:4},[vo,ho],64)):w("",!0),e.person.status.dswComm.registered?(m(),c(f,{key:5},[fo,e.person.status.dswComm.expired?(m(),c("div",{key:0,style:{color:e.person.status.dswComm.needed?"red":null}},"Expired on "+b(e.person.status.dswComm.expires),5)):"admin"==e.person.status.level&&e.person.status.dswComm.expires?(m(),c("div",wo,"Registered "+b(e.person.status.dswComm.registered)+", expiresÂ "+b(e.person.status.dswComm.expires.replace(/-/g,"â")),1)):"admin"==e.person.status.level?(m(),c("div",go,"Registered "+b(e.person.status.dswComm.registered),1)):e.person.status.dswComm.expires?(m(),c("div",Co,"Expires on "+b(e.person.status.dswComm.expires),1)):(m(),c("div",yo,"Registered"))],64)):e.person.status.dswComm.needed?(m(),c(f,{key:6},[bo,ko],64)):w("",!0),e.person.status.backgroundCheck.admin?(m(),c(f,{key:7},[So,h("div",Eo,[(m(!0),c(f,null,N(e.person.status.backgroundCheck.checks,(e=>(m(),c("div",{class:{"person-view-status-assumed":e.assumed}},[e.date?(m(),c("span",{key:0,class:"person-view-status-date",textContent:b(`${e.date} `)},null,8,["textContent"])):w("",!0),h("span",{textContent:b(e.type.join("+"))},null,8,["textContent"]),e.assumed?(m(),c("span",{key:1,textContent:b(" (assumed)")},null,8,["textContent"])):e.date?w("",!0):(m(),c("span",{key:2,textContent:b(" (date unknown)")},null,8,["textContent"]))],2)))),256)),e.missingBGCheck?(m(),c("div",Po,"Missing required "+b(e.missingBGCheck)+" check",1)):w("",!0)])],64)):(m(),c(f,{key:8},["true"===e.person.status.backgroundCheck.cleared?(m(),c(f,{key:0},[Vo,Ao],64)):e.person.status.backgroundCheck.cleared?(m(),c(f,{key:1},[xo,h("div",null,"Cleared on "+b(e.person.status.backgroundCheck.cleared),1)],64)):e.person.status.backgroundCheck.needed?(m(),c(f,{key:2},[Ro,Fo],64)):w("",!0)],64)),e.person.status.identification.length?(m(),c(f,{key:9},[No,h("div",Mo,[(m(!0),c(f,null,N(e.person.status.identification,(e=>(m(),c("div",{textContent:b(e)},null,8,["textContent"])))),256))])],64)):w("",!0)]),e.person.canEdit?(m(),c(l,{key:0,ref:"editStatusModal",pid:e.person.id},null,8,["pid"])):w("",!0)])),_:1},8,["editable","onEdit"])):w("",!0)};var $o=o({components:{Modal:n,SubscriptionsForm:I},props:{pid:{type:Number,required:!0}},setup(e){const o=r(null);return{modal:o,onDone:function(e){o.value.close(e)},show:function(){return o.value.show()}}}});$o.render=function(e,o,n,t,a,s){const l=p("SubscriptionsForm"),r=p("Modal");return m(),c(r,{ref:"modal"},{default:v((()=>[h(l,{inModal:"",pid:e.pid,onDone:e.onDone},null,8,["pid","onDone"])])),_:1},512)};var To=o({components:{PersonEditSubscriptions:$o,PersonViewSection:J},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=r(null);return{editSubscriptionsModal:n,onEditSubscriptions:async function(){await n.value.show()&&o("reload")}}}});const Do={id:"person-view-lists-list"},Bo={key:0,style:{color:"red"}},Uo={key:1,style:{color:"red"}};To.render=function(e,o,n,t,a,s){const l=p("PersonEditSubscriptions"),r=p("PersonViewSection");return e.person.noEmail||e.person.noText||e.person.lists.length||e.person.canEditLists?(m(),c(r,{key:0,title:"Subscriptions",editable:e.person.canEditLists,onEdit:e.onEditSubscriptions},{default:v((()=>[h("div",Do,[e.person.noEmail?(m(),c("div",Bo,"Unsubcribed from all email.")):w("",!0),e.person.noText?(m(),c("div",Uo,"Unsubscribed from all text messaging.")):w("",!0),(m(!0),c(f,null,N(e.person.lists,(e=>(m(),c("div",{textContent:b(e)},null,8,["textContent"])))),256))]),e.person.canEditLists?(m(),c(l,{key:0,ref:"editSubscriptionsModal",pid:e.person.id},null,8,["pid"])):w("",!0)])),_:1},8,["editable","onEdit"])):w("",!0)};var Ho=o({components:{MessageBox:H,PersonEditPassword:O,PersonViewContact:ee,PersonViewNames:ge,PersonViewNotes:De,PersonViewRoles:qe,PersonViewSection:J,PersonViewStatus:Qe,PersonViewSubscriptions:To,SButton:V,SSpinner:l},props:{onLoadPerson:{type:Function,required:!0}},setup(e){const o=_(),n=r(null);d.get(`/api/people/${o.params.id}`).then((o=>{n.value=o.data,e.onLoadPerson(n.value)}));const t=r(null);const a=r(null);return{changePasswordModal:t,onChangePassword:function(){t.value.show()},onResetPassword:function(){a.value.show()&&d.post(`/api/people/${o.params.id}/pwreset`)},onReload:async function(){n.value=(await d.get(`/api/people/${o.params.id}`)).data},person:n,resetPasswordModal:a}}});const _o={key:0,id:"person-view-spinner"},Io={key:1,id:"person-view"},Oo={id:"person-view-grid"},qo=h("div",{class:"person-view-spacer"},null,-1),zo={id:"person-view-chpw"},Lo=x("Change Password"),Yo=x("Reset Password");Ho.render=function(e,o,n,t,a,s){const l=p("SSpinner"),r=p("PersonViewNames"),i=p("PersonViewRoles"),d=p("PersonViewContact"),u=p("PersonViewStatus"),f=p("PersonViewNotes"),g=p("PersonViewSubscriptions"),C=p("SButton"),y=p("PersonViewSection"),k=p("PersonEditPassword"),S=p("MessageBox");return e.person?(m(),c("div",Io,[h("div",Oo,[h(r,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),qo,h(i,{person:e.person,onReload:e.onReload,style:{"grid-row":"2/3"}},null,8,["person","onReload"]),h(d,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),h(u,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),h(f,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),h(g,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),e.person.canChangePassword||e.person.canResetPassword?(m(),c(y,{key:0,title:"Password",editable:!1},{default:v((()=>[h("div",zo,[e.person.canChangePassword?(m(),c(C,{key:0,variant:"primary",small:"",onClick:e.onChangePassword},{default:v((()=>[Lo])),_:1},8,["onClick"])):w("",!0),e.person.canResetPassword?(m(),c(C,{key:1,variant:"primary",small:"",onClick:e.onResetPassword},{default:v((()=>[Yo])),_:1},8,["onClick"])):w("",!0)])])),_:1})):w("",!0)]),e.person.canChangePassword?(m(),c(k,{key:0,ref:"changePasswordModal",pid:e.person.id},null,8,["pid"])):w("",!0),h(S,{ref:"resetPasswordModal",title:"Reset Password",variant:"warning",okLabel:"Reset Password"},{default:v((()=>[x("This will replace "+b(e.person.informalName)+"âs current password with a new, randomly generated one, and send it to them by email. You should do this only if they have explicitly asked you to. Are you sure you want to reset "+b(e.person.informalName)+"âs password?",1)])),_:1},512)])):(m(),c("div",_o,[h(l)]))};export default Ho;
