let e=document.createElement("style");e.innerHTML="#event-timesheet{margin:1.5rem .75rem}#event-timesheet-grid{display:grid;grid:auto-flow/-webkit-max-content -webkit-min-content -webkit-min-content -webkit-min-content 1fr;grid:auto-flow/max-content min-content min-content min-content 1fr;align-items:center;-moz-column-gap:.5rem;column-gap:.5rem}#event-timesheet-submit{display:flex;flex-wrap:wrap;margin:.75rem 0 0 -.5rem}#event-timesheet-submit .sbtn{margin-left:.5rem}@media print{#event-timesheet-submit{display:none}}#event-timesheet-cancel{margin-right:2rem}.event-timesheet-type{font-size:.75rem;padding:.25rem;border-radius:.25rem;color:#fff;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;min-width:4rem;min-height:1.25rem;line-height:1;text-align:center}.event-timesheet-type-:hover{border:1px solid #888}.event-timesheet-type-Volunteer{background-color:#4363d8}.event-timesheet-type-Student{background-color:#3cb44b}.event-timesheet-type-Audit{background-color:#a9a9a9}.event-timesheet-type-Absent{background-color:maroon}",document.head.appendChild(e);import{d as t,O as n,f as a,P as i,z as r,L as s,F as o,C as u,_ as l,S as d,n as m,u as p,e as v}from"./index.c11e3ffd.js";import{s as y}from"./page.d3e01b48.js";import{s as c}from"./EventAttendanceGuest.83b4726e.js";const f={"":"",Volunteer:"Volunteer",Student:"Student",Audit:"Auditor",Absent:"Absentee"},h=t({name:"EventTimesheetType",props:{value:{type:String,required:!0},allowEmpty:{type:Boolean,required:!0}},emits:["update"],setup(e,{emit:t}){function a(){switch(e.value){case"":t("update","Volunteer");break;case"Volunteer":t("update","Student");break;case"Student":t("update","Audit");break;case"Audit":t("update","Absent");break;case"Absent":e.allowEmpty?t("update",""):t("update","Volunteer")}}return()=>n("div",{class:["event-timesheet-type",`event-timesheet-type-${e.value}`],onClick:a},f[e.value])}});function g(e){if(!e)return"";const t=Math.floor(e/60).toString();return 30===e?"½ hour":60===e?"1 hour":e%60!=0?`${t}½ hours`:`${t} hours`}const b=t({name:"EventTimesheetEntry",props:{entry:{type:Object,required:!0},defaultType:{type:String,required:!0}},emits:["newType"],setup(e,{emit:t}){const l=a(),d=a(),m=a(!1);function p(){m.value=!0}function v(e){var t,n,a,i;(null==(t=l.value)?void 0:t.el)&&e.relatedTarget===(null==(n=l.value)?void 0:n.el)||(null==(a=d.value)?void 0:a.el)&&e.relatedTarget===(null==(i=d.value)?void 0:i.el)||(m.value=!1)}const y=a(e.entry.invalid);return i((()=>{if(e.entry.start||e.entry.end){const t=u(e.entry.start,"H:mm",!0),n=u(e.entry.end,"H:mm",!0);if(t.isValid()&&n.isValid()&&!n.isBefore(t)){let a=n.diff(t,"minutes");e.entry.minutes=30*Math.floor((a+20)/30),e.entry.invalid=!1}else e.entry.minutes=0,e.entry.invalid=!0}else e.entry.minutes=e.entry.origMinutes,e.entry.origType||(e.entry.type=""),e.entry.invalid=!1;e.entry.minutes&&!e.entry.type&&(e.entry.type=e.defaultType),y.value=e.entry.invalid&&!m.value})),r((()=>e.entry.type),(()=>{e.entry.type&&e.entry.type!==e.defaultType&&t("newType",e.entry.type)})),()=>n(o,[n("div",{class:"event-timesheet-name"},e.entry.sortName),n(h,{value:e.entry.type,allowEmpty:!e.entry.minutes,onUpdate:t=>e.entry.type=t}),n(s,{ref:e=>l.value=e,class:"event-timesheet-time",type:"time",modelValue:e.entry.start,onBlur:v,onFocus:p,"onUpdate:modelValue":t=>e.entry.start=t}),n(s,{ref:e=>d.value=e,class:"event-timesheet-time",type:"time",modelValue:e.entry.end,onBlur:v,onFocus:p,"onUpdate:modelValue":t=>e.entry.end=t}),y.value?n("div",{class:"event-timesheet-invalid"},"Invalid"):n("div",{class:"event-timesheet-minutes"},g(e.entry.minutes))])}}),w=t({props:{onLoadEvent:{type:Function,required:!0}},setup(e){const t=m(),i=p();y({title:"Events"});const r=a(),s=a();l.get(`/api/events/${t.params.id}?attendance=1`).then((n=>{r.value=n.data.event,s.value=n.data.people.map((e=>({id:e.id,sortName:e.sortName,type:e.attended?e.attended.type:"",origType:e.attended?e.attended.type:"",minutes:e.attended?e.attended.minutes:0,origMinutes:e.attended?e.attended.minutes:0,start:"",end:"",invalid:!1}))),"NEW"===t.params.id?y({title:"New Event"}):y({title:`${r.value.date} ${r.value.name}`,browserTitle:r.value.date}),e.onLoadEvent(r.value)}));const o=a("Volunteer"),u=a(null);async function f(){const e=await u.value.show();if(!e)return;s.value.find((t=>t.id===e.id))||(s.value.push({id:e.id,sortName:e.sortName,start:"",end:"",minutes:0,type:"",origType:"",origMinutes:0,invalid:!1}),s.value.sort(((e,t)=>e.sortName<t.sortName?-1:e.sortName>t.sortName?1:0)))}async function h(){if(!s.value)return;if(s.value.find((e=>e.invalid)))return;const e=new FormData;s.value.forEach((t=>{(t.minutes||t.type)&&(e.append("person",t.id.toString()),e.append("type",t.type),e.append("minutes",t.minutes.toString()))})),await l.post(`/api/events/${t.params.id}/attendance`,e)}async function g(e){e.preventDefault(),await h(),i.push(`/events/${t.params.id}`)}function w(e){e.preventDefault(),i.go(-1)}async function T(e){e.preventDefault(),await h(),i.replace(`/events/${t.params.id}/attendance`)}return()=>r.value?n("form",{id:"event-timesheet",onSubmit:g},[n("div",{id:"event-timesheet-grid"},s.value.map((e=>n(b,{entry:e,defaultType:o.value,onNewType:e=>o.value=e})))),n("div",{id:"event-timesheet-submit"},[n(d,{type:"submit",variant:"primary"},(()=>"Save Timesheet")),n(d,{id:"event-timesheet-cancel",onClick:w},(()=>"Cancel")),n(d,{onClick:f},(()=>"Add Guest")),n(d,{onClick:T},(()=>"Hours View"))]),n(c,{ref:e=>u.value=e})]):n(v)}});export default w;
