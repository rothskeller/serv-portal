import{d as e,f as t,T as n,z as a,I as i,U as r,P as s,F as u,C as l,_ as d,S as o,n as v,u as p,e as m}from"./index.60247fbf.js";import{s as y}from"./page.5682baa0.js";import{s as c}from"./EventAttendanceGuest.01bdc746.js";function f(e){if(!e)return"";const t=Math.floor(e/60).toString();return 30===e?"½ hour":60===e?"1 hour":e%60!=0?`${t}½ hours`:`${t} hours`}const h=e({name:"EventTimesheetEntry",props:{entry:{type:Object,required:!0},defaultType:{type:String,required:!0}},emits:["newType"],setup(e,{emit:d}){const o=t(),v=t(),p=t(!1);function m(){p.value=!0}function y(e){var t,n,a,i;(null==(t=o.value)?void 0:t.el)&&e.relatedTarget===(null==(n=o.value)?void 0:n.el)||(null==(a=v.value)?void 0:a.el)&&e.relatedTarget===(null==(i=v.value)?void 0:i.el)||(p.value=!1)}const c=t(e.entry.invalid);return n((()=>{if(e.entry.start||e.entry.end){const t=l(e.entry.start,"H:mm",!0),n=l(e.entry.end,"H:mm",!0);if(t.isValid()&&n.isValid()&&!n.isBefore(t)){let a=n.diff(t,"minutes");e.entry.minutes=30*Math.floor((a+20)/30),e.entry.invalid=!1}else e.entry.minutes=0,e.entry.invalid=!0}else e.entry.minutes=e.entry.origMinutes,e.entry.origType||(e.entry.type=""),e.entry.invalid=!1;e.entry.minutes&&!e.entry.type&&(e.entry.type=e.defaultType),c.value=e.entry.invalid&&!p.value})),a((()=>e.entry.type),(()=>{e.entry.type&&e.entry.type!==e.defaultType&&d("newType",e.entry.type)})),()=>i(u,[i("div",{class:"event-timesheet-name"},e.entry.sortName),i(r,{value:e.entry.type,allowEmpty:!e.entry.minutes,onUpdate:t=>e.entry.type=t}),i(s,{ref:e=>o.value=e,class:"event-timesheet-time",type:"time",modelValue:e.entry.start,onBlur:y,onFocus:m,"onUpdate:modelValue":t=>e.entry.start=t}),i(s,{ref:e=>v.value=e,class:"event-timesheet-time",type:"time",modelValue:e.entry.end,onBlur:y,onFocus:m,"onUpdate:modelValue":t=>e.entry.end=t}),c.value?i("div",{class:"event-timesheet-invalid"},"Invalid"):i("div",{class:"event-timesheet-minutes"},f(e.entry.minutes))])}}),g=e({props:{onLoadEvent:{type:Function,required:!0}},setup(e){const n=v(),a=p();y({title:"Events"});const r=t(),s=t();d.get(`/api/events/${n.params.id}?attendance=1`).then((t=>{r.value=t.data.event,s.value=t.data.people.map((e=>({id:e.id,sortName:e.sortName,type:e.attended?e.attended.type:"",origType:e.attended?e.attended.type:"",minutes:e.attended?e.attended.minutes:0,origMinutes:e.attended?e.attended.minutes:0,start:"",end:"",invalid:!1}))),"NEW"===n.params.id?y({title:"New Event"}):y({title:`${r.value.date} ${r.value.name}`,browserTitle:r.value.date}),e.onLoadEvent(r.value)}));const u=t("Volunteer"),l=t(null);async function f(){const e=await l.value.show();if(!e)return;s.value.find((t=>t.id===e.id))||(s.value.push({id:e.id,sortName:e.sortName,start:"",end:"",minutes:0,type:"",origType:"",origMinutes:0,invalid:!1}),s.value.sort(((e,t)=>e.sortName<t.sortName?-1:e.sortName>t.sortName?1:0)))}async function g(){if(!s.value)return;if(s.value.find((e=>e.invalid)))return;const e=new FormData;s.value.forEach((t=>{(t.minutes||t.type)&&(e.append("person",t.id.toString()),e.append("type",t.type),e.append("minutes",t.minutes.toString()))})),await d.post(`/api/events/${n.params.id}/attendance`,e)}async function T(e){e.preventDefault(),await g(),a.push(`/events/${n.params.id}`)}function w(e){e.preventDefault(),a.go(-1)}async function N(e){e.preventDefault(),await g(),a.replace(`/events/${n.params.id}/attendance`)}return()=>r.value?i("form",{id:"event-timesheet",onSubmit:T},[i("div",{id:"event-timesheet-grid"},s.value.map((e=>i(h,{entry:e,defaultType:u.value,onNewType:e=>u.value=e})))),i("div",{id:"event-timesheet-submit"},[i(o,{type:"submit",variant:"primary"},(()=>"Save Timesheet")),i(o,{id:"event-timesheet-cancel",onClick:w},(()=>"Cancel")),i(o,{onClick:f},(()=>"Add Guest")),i(o,{onClick:N},(()=>"Hours View"))]),i(c,{ref:e=>l.value=e})]):i(m)}});export default g;
