let e=document.createElement("style");e.innerHTML="#event-timesheet{margin:1.5rem .75rem}#event-timesheet-grid{display:grid;grid:auto-flow/-webkit-max-content -webkit-min-content -webkit-min-content -webkit-min-content 1fr;grid:auto-flow/max-content min-content min-content min-content 1fr;align-items:center;-moz-column-gap:.5rem;column-gap:.5rem}#event-timesheet-submit{display:flex;flex-wrap:wrap;margin:.75rem 0 0 -.5rem}#event-timesheet-submit .sbtn{margin-left:.5rem}@media print{#event-timesheet-submit{display:none}}#event-timesheet-cancel{margin-right:2rem}.event-timesheet-type{font-size:.75rem;padding:.25rem;border-radius:.25rem;color:#fff;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;min-width:4rem;min-height:1.25rem;line-height:1;text-align:center}.event-timesheet-type-:hover{border:1px solid #888}.event-timesheet-type-Volunteer{background-color:#4363d8}.event-timesheet-type-Student{background-color:#3cb44b}.event-timesheet-type-Audit{background-color:#a9a9a9}.event-timesheet-type-Absent{background-color:maroon}",document.head.appendChild(e);import{d as t,f as n,O as a,z as i,P as r,Q as s,L as o,F as l,C as d,_ as u,S as m,n as p,u as v,e as y}from"./index.a28903e7.js";import{s as c}from"./page.87e88d9c.js";import{s as f}from"./EventAttendanceGuest.98d898f5.js";function h(e){if(!e)return"";const t=Math.floor(e/60).toString();return 30===e?"½ hour":60===e?"1 hour":e%60!=0?`${t}½ hours`:`${t} hours`}const g=t({name:"EventTimesheetEntry",props:{entry:{type:Object,required:!0},defaultType:{type:String,required:!0}},emits:["newType"],setup(e,{emit:t}){const u=n(),m=n(),p=n(!1);function v(){p.value=!0}function y(e){var t,n,a,i;(null==(t=u.value)?void 0:t.el)&&e.relatedTarget===(null==(n=u.value)?void 0:n.el)||(null==(a=m.value)?void 0:a.el)&&e.relatedTarget===(null==(i=m.value)?void 0:i.el)||(p.value=!1)}const c=n(e.entry.invalid);return a((()=>{if(e.entry.start||e.entry.end){const t=d(e.entry.start,"H:mm",!0),n=d(e.entry.end,"H:mm",!0);if(t.isValid()&&n.isValid()&&!n.isBefore(t)){let a=n.diff(t,"minutes");e.entry.minutes=30*Math.floor((a+20)/30),e.entry.invalid=!1}else e.entry.minutes=0,e.entry.invalid=!0}else e.entry.minutes=e.entry.origMinutes,e.entry.origType||(e.entry.type=""),e.entry.invalid=!1;e.entry.minutes&&!e.entry.type&&(e.entry.type=e.defaultType),c.value=e.entry.invalid&&!p.value})),i((()=>e.entry.type),(()=>{e.entry.type&&e.entry.type!==e.defaultType&&t("newType",e.entry.type)})),()=>r(l,[r("div",{class:"event-timesheet-name"},e.entry.sortName),r(s,{value:e.entry.type,allowEmpty:!e.entry.minutes,onUpdate:t=>e.entry.type=t}),r(o,{ref:e=>u.value=e,class:"event-timesheet-time",type:"time",modelValue:e.entry.start,onBlur:y,onFocus:v,"onUpdate:modelValue":t=>e.entry.start=t}),r(o,{ref:e=>m.value=e,class:"event-timesheet-time",type:"time",modelValue:e.entry.end,onBlur:y,onFocus:v,"onUpdate:modelValue":t=>e.entry.end=t}),c.value?r("div",{class:"event-timesheet-invalid"},"Invalid"):r("div",{class:"event-timesheet-minutes"},h(e.entry.minutes))])}}),b=t({props:{onLoadEvent:{type:Function,required:!0}},setup(e){const t=p(),a=v();c({title:"Events"});const i=n(),s=n();u.get(`/api/events/${t.params.id}?attendance=1`).then((n=>{i.value=n.data.event,s.value=n.data.people.map((e=>({id:e.id,sortName:e.sortName,type:e.attended?e.attended.type:"",origType:e.attended?e.attended.type:"",minutes:e.attended?e.attended.minutes:0,origMinutes:e.attended?e.attended.minutes:0,start:"",end:"",invalid:!1}))),"NEW"===t.params.id?c({title:"New Event"}):c({title:`${i.value.date} ${i.value.name}`,browserTitle:i.value.date}),e.onLoadEvent(i.value)}));const o=n("Volunteer"),l=n(null);async function d(){const e=await l.value.show();if(!e)return;s.value.find((t=>t.id===e.id))||(s.value.push({id:e.id,sortName:e.sortName,start:"",end:"",minutes:0,type:"",origType:"",origMinutes:0,invalid:!1}),s.value.sort(((e,t)=>e.sortName<t.sortName?-1:e.sortName>t.sortName?1:0)))}async function h(){if(!s.value)return;if(s.value.find((e=>e.invalid)))return;const e=new FormData;s.value.forEach((t=>{(t.minutes||t.type)&&(e.append("person",t.id.toString()),e.append("type",t.type),e.append("minutes",t.minutes.toString()))})),await u.post(`/api/events/${t.params.id}/attendance`,e)}async function b(e){e.preventDefault(),await h(),a.push(`/events/${t.params.id}`)}function w(e){e.preventDefault(),a.go(-1)}async function T(e){e.preventDefault(),await h(),a.replace(`/events/${t.params.id}/attendance`)}return()=>i.value?r("form",{id:"event-timesheet",onSubmit:b},[r("div",{id:"event-timesheet-grid"},s.value.map((e=>r(g,{entry:e,defaultType:o.value,onNewType:e=>o.value=e})))),r("div",{id:"event-timesheet-submit"},[r(m,{type:"submit",variant:"primary"},(()=>"Save Timesheet")),r(m,{id:"event-timesheet-cancel",onClick:w},(()=>"Cancel")),r(m,{onClick:d},(()=>"Add Guest")),r(m,{onClick:T},(()=>"Hours View"))]),r(f,{ref:e=>l.value=e})]):r(y)}});export default b;
