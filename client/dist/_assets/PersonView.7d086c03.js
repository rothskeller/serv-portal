let e=document.createElement("style");e.innerHTML="#person-view{margin:1.5rem .75rem}#person-view-name{display:flex;flex-direction:column}#person-view-informalName{font-weight:700;font-size:1.25rem;line-height:1.2}#person-view-callSign{margin-left:.5rem;font-weight:400}#person-view-formalName,.person-view-email-label{color:#888}@media (min-width:576px){#person-view-name{flex-direction:row}#person-view-formalName{margin-left:1rem}}#person-view-cbadge{margin-left:.5rem}#person-view-roles{line-height:1.2}#person-view-emails{margin-top:.75rem}.person-view-phone{font-variant:tabular-nums}.person-view-phone-label{margin-left:.25rem;color:#888}.person-view-address,.person-view-clearances{margin-top:.75rem;line-height:1.2}.person-view-map{margin-left:1rem}.person-view-map::before{content:'['}.person-view-map::after{content:']'}.person-view-address-flag{color:#888;font-size:.875rem}#person-view-attended{margin-top:.75rem;line-height:1.2}.person-view-attended{margin-left:2rem;text-indent:-2rem}.person-view-attended-date{margin-right:.75rem;color:#888;font-variant:tabular-nums}#person-view-notes,#person-view-unsub{margin-top:.75rem;line-height:1.2}.person-view-note{margin-left:2rem;text-indent:-2rem}.person-view-note-date{margin-right:.75rem;color:#888;font-variant:tabular-nums}",document.head.appendChild(e);import{d as n,j as o,m as t,l as s,p as r,e as l,f as a,_ as i,C as d,r as p,c as m,o as v,w as c,a as u,F as h,z as g,s as w,i as f,v as k,t as y,g as C,b as x}from"./index.67d5d48d.js";const S={admin:"Admin","cert-d":"CERT Deployment","cert-t":"CERT Training",listos:"Listos",sares:"SARES",snap:"SNAP"};var b=n({components:{Modal:o,SFCheckGroup:t,SForm:s,SFSelect:r,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const n=a(null);const o=a([]),t=a("");i.get(`/api/people/${e.pid}/roles`).then((e=>{o.value=e.data,o.value.forEach((e=>{e.fmtOrg=S[e.org]})),t.value=o.value[0].org}));const s=a([]),r=a(new Set);d(t,(()=>{const e=o.value.find((e=>e.org===t.value)).roles;r.value=new Set(e.filter((e=>e.held)).map((e=>e.id)))})),d([r,t],((e,n)=>{let l=e[1]!=n[1];if(e[0].forEach((e=>{n[0].has(e)||(l=!0)})),n[0].forEach((n=>{e[0].has(n)||(l=!0)})),!l)return;const a=new Set,i=new Set;o.value.forEach((e=>{e.org===t.value?e.roles.filter((e=>(!e.held||e.direct)&&r.value.has(e.id))).forEach((e=>{a.add(e.id),e.implies.forEach((e=>i.add(e)))})):e.roles.filter((e=>e.held&&e.direct)).forEach((e=>{a.add(e.id),e.implies.forEach((e=>i.add(e)))}))})),console.log("toSetDirectly",a),console.log("toSetIndirectly",i),o.value.forEach((e=>{e.roles.forEach((e=>{a.has(e.id)?e.held=e.direct=!0:i.has(e.id)?(e.held=!0,e.direct=!1):e.held=e.direct=!1}))}));const d=o.value.find((e=>e.org===t.value)).roles;r.value=new Set(d.filter((e=>e.held)).map((e=>e.id))),s.value=d.map((e=>({value:e.id,label:e.name,disabled:e.implicitOnly||e.held&&!e.direct})))}));const l=a(!1);return{modal:n,onCancel:function(){n.value.close(!1)},onSubmit:async function(){var t=new FormData;o.value.forEach((e=>{e.roles.filter((e=>e.held&&e.direct)).forEach((e=>{t.append("role",e.id.toString())}))})),l.value=!0,await i.post(`/api/people/${e.pid}/roles`,t),l.value=!1,n.value.close(!0)},org:t,orgRoleOptions:s,orgRoles:r,orgs:o,show:function(){return n.value.show()},submitting:l}}});b.render=function(e,n,o,t,s,r){const l=p("SSpinner"),a=p("SFSelect"),i=p("SFCheckGroup"),d=p("SForm"),w=p("Modal");return v(),m(w,{ref:"modal"},{default:c((()=>[u(d,{dialog:"",variant:"primary",title:"Edit Roles",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:c((()=>[e.orgs.length?(v(),m(h,{key:1},[e.orgs.length>1?(v(),m(a,{key:0,id:"person-roles-org",label:"Org",options:e.orgs,valueKey:"org",labelKey:"fmtOrg",modelValue:e.org,"onUpdate:modelValue":n[1]||(n[1]=n=>e.org=n)},null,8,["options","modelValue"])):g("",!0),u(i,{id:"person-roles-roles",label:e.orgs.length>1?"Roles":"",options:e.orgRoleOptions,disabledKey:"disabled",modelValue:e.orgRoles,"onUpdate:modelValue":n[2]||(n[2]=n=>e.orgRoles=n)},null,8,["label","options","modelValue"])],64)):(v(),m(l,{key:0}))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var A=n({components:{PersonEditRoles:b,SButton:w,SSpinner:l},props:{onLoadPerson:{type:Function,required:!0}},setup(e){const n=f("me"),o=k(),t=a(null);i.get("/api/people/"+o.params.id).then((n=>{t.value=n.data.person,e.onLoadPerson(t.value)}));const s=a(null);return{editRolesModal:s,me:n,onEditRoles:async function(){await s.value.show()&&(t.value=(await i.get("/api/people/"+o.params.id)).data.person)},person:t}}});const E={key:0,id:"person-view-spinner"},R={key:1,id:"person-view"},P={id:"person-view-name"},N={id:"person-view-informalName"},D={id:"person-view-roles"},F={key:0,id:"person-view-emails"},M={key:0},V={key:1,class:"person-view-phone"},O=u("span",{class:"person-view-phone-label"},"(Cell)",-1),T={key:2,class:"person-view-phone"},_=u("span",{class:"person-view-phone-label"},"(Home)",-1),B={key:3,class:"person-view-phone"},H=u("span",{class:"person-view-phone-label"},"(Work)",-1),L={key:4,class:"person-view-address"},U={key:0},q={key:1},I={key:5,class:"person-view-address"},j=u("span",null,"Work Address:",-1),z={key:6,class:"person-view-address"},K=u("div",null,"Mailing Address:",-1),W={key:7,class:"person-view-clearances"},$=u("div",null,"Volunteer status:",-1),G={key:0},J=x("Sunnyvale volunteer: "),Q=u("span",{style:{color:"red"}},"not registered.",-1),X={key:0,style:{color:"red"}},Y={key:0,style:{color:"red"}},Z={key:1},ee={key:3},ne={key:4},oe=x("Background check: "),te=u("span",{style:{color:"red"}},"not completed.",-1),se={key:5},re={key:6},le={key:8,id:"person-view-attended"},ae=u("div",null,"Events attended:",-1),ie={class:"person-view-attended"},de={key:9,id:"person-view-notes"},pe=u("div",null,"Notes:",-1),me={class:"person-view-note"},ve={key:10,id:"person-view-unsub"},ce=u("div",null,"Unsubscribe:",-1),ue={key:0},he={key:1},ge={key:2},we={key:11,id:"person-view-roles2"},fe=u("div",null,"Roles:",-1),ke={key:0},ye={key:1},Ce=x("Edit");A.render=function(e,n,o,t,s,r){const l=p("SSpinner"),a=p("SButton"),i=p("PersonEditRoles");return e.person?(v(),m("div",R,[u("div",P,[u("div",N,[u("span",{textContent:y(e.person.informalName)},null,8,["textContent"]),e.person.callSign?(v(),m("span",{key:0,id:"person-view-callSign",textContent:y(e.person.callSign)},null,8,["textContent"])):g("",!0)]),e.person.formalName!==e.person.informalName?(v(),m("div",{key:0,id:"person-view-formalName",textContent:y(`(formally ${e.person.formalName})`)},null,8,["textContent"])):g("",!0)]),u("div",D,[(v(!0),m(h,null,C(e.person.roles,(e=>(v(),m("div",{textContent:y(e.name)},null,8,["textContent"])))),256))]),e.person.email?(v(),m("div",F,[u("div",null,[u("a",{href:"mailto:"+e.person.email,textContent:y(e.person.email)},null,8,["href","textContent"])]),e.person.email2?(v(),m("div",M,[u("a",{href:"mailto:"+e.person.email2,textContent:y(e.person.email2)},null,8,["href","textContent"])])):g("",!0)])):g("",!0),e.person.cellPhone?(v(),m("div",V,[u("a",{href:"tel:"+e.person.cellPhone,textContent:y(e.person.cellPhone)},null,8,["href","textContent"]),O])):g("",!0),e.person.homePhone?(v(),m("div",T,[u("a",{href:"tel:"+e.person.homePhone,textContent:y(e.person.homePhone)},null,8,["href","textContent"]),_])):g("",!0),e.person.workPhone?(v(),m("div",B,[u("a",{href:"tel:"+e.person.workPhone,textContent:y(e.person.workPhone)},null,8,["href","textContent"]),H])):g("",!0),e.person.homeAddress&&e.person.homeAddress.address?(v(),m("div",L,[u("div",null,[e.person.workAddress&&e.person.workAddress.sameAsHome?(v(),m("span",U,"Home Address (all day):")):(v(),m("span",q,"Home Address:")),u("a",{class:"person-view-map",target:"_blank",href:"https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(e.person.homeAddress.address)},"Map",8,["href"])]),u("div",{textContent:y(e.person.homeAddress.address.split(",")[0])},null,8,["textContent"]),u("div",{textContent:y(e.person.homeAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"]),e.person.homeAddress.fireDistrict?(v(),m("div",{key:0,textContent:y("Sunnyvale Fire District "+e.person.homeAddress.fireDistrict)},null,8,["textContent"])):g("",!0)])):g("",!0),e.person.workAddress&&e.person.workAddress.address?(v(),m("div",I,[u("div",null,[j,u("a",{class:"person-view-map",target:"_blank",href:"https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(e.person.workAddress.address)},"Map",8,["href"])]),u("div",{textContent:y(e.person.workAddress.address.split(",")[0])},null,8,["textContent"]),u("div",{textContent:y(e.person.workAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"]),e.person.workAddress.fireDistrict?(v(),m("div",{key:0,textContent:y("Sunnyvale Fire District "+e.person.workAddress.fireDistrict)},null,8,["textContent"])):g("",!0)])):g("",!0),e.person.mailAddress&&e.person.mailAddress.address?(v(),m("div",z,[K,u("div",{textContent:y(e.person.mailAddress.address.split(",")[0])},null,8,["textContent"]),u("div",{textContent:y(e.person.mailAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"])])):g("",!0),e.person.dsw||void 0!==e.person.volgistics||void 0!==e.person.backgroundCheck?(v(),m("div",W,[$,!1===e.person.volgistics?(v(),m("div",G,[J,Q])):e.person.volgistics&&!0!==e.person.volgistics?(v(),m("div",{key:1,textContent:y("Sunnyvale volunteer #"+e.person.volgistics)},null,8,["textContent"])):g("",!0),e.person.dsw?(v(!0),m(h,{key:2},C(e.person.dsw,((e,n)=>(v(),m("div",null,[x("DSW for "+y(n)+": ",1),e.needed&&!e.registered?(v(),m("span",X,"not registered.")):(v(),m(h,{key:1},[x("registered "+y(e.registered)+", ",1),e.expired?(v(),m("span",Y,"expired")):(v(),m("span",Z,"expires")),x(" "+y(e.expires)+".",1)],64))])))),256)):g("",!0),!0===e.person.backgroundCheck?(v(),m("div",ee,"Background check cleared.")):!1===e.person.backgroundCheck?(v(),m("div",ne,[oe,te])):e.person.backgroundCheck?(v(),m("div",se,"Background check cleared on "+y(e.person.backgroundCheck)+".",1)):g("",!0),e.person.identification.length?(v(),m("div",re,"IDs issued: "+y(e.person.identification.join(", ")),1)):g("",!0)])):g("",!0),e.person.attended?(v(),m("div",le,[ae,(v(!0),m(h,null,C(e.person.attended,(e=>(v(),m("div",ie,[u("span",{class:"person-view-attended-date",textContent:y(e.date)},null,8,["textContent"]),u("span",{textContent:y(e.name)},null,8,["textContent"])])))),256))])):g("",!0),e.person.notes&&e.person.notes.length?(v(),m("div",de,[pe,(v(!0),m(h,null,C(e.person.notes,(e=>(v(),m("div",me,[u("span",{class:"person-view-note-date",textContent:y(e.date)},null,8,["textContent"]),u("span",{textContent:y(e.note)},null,8,["textContent"])])))),256))])):g("",!0),e.person.noEmail||e.person.noText?(v(),m("div",ve,[ce,e.person.noEmail&&e.person.noText?(v(),m("div",ue,"from all emails and text messages")):e.person.noEmail?(v(),m("div",he,"from all emails")):(v(),m("div",ge,"from all text messages"))])):g("",!0),e.me.webmaster?(v(),m("div",we,[fe,(v(!0),m(h,null,C(e.person.roles2,(e=>(v(),m("div",{textContent:y(e)},null,8,["textContent"])))),256)),e.person.roles2.length?g("",!0):(v(),m("div",ke,"None")),e.person.canEditRoles2?(v(),m("div",ye,[u(a,{variant:"secondary",small:"",onClick:e.onEditRoles},{default:c((()=>[Ce])),_:1},8,["onClick"])])):g("",!0),u(i,{ref:"editRolesModal",pid:e.person.id},null,8,["pid"])])):g("",!0)])):(v(),m("div",E,[u(l)]))};export default A;
