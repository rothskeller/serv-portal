let e=document.createElement("style");e.innerHTML="#group-edit{padding:1.5rem .75rem}#group-edit-privs{display:grid;grid:auto/1fr}.group-edit-heading{display:none}.group-edit-group{overflow:hidden;margin-top:.75rem;min-width:0;text-overflow:ellipsis;white-space:nowrap}@media (min-width:450px){#group-edit-privs{justify-content:start;grid:auto/auto -webkit-min-content;grid:auto/auto min-content}.group-edit-heading{display:block;font-weight:700}.group-edit-group{align-self:center;margin-top:0;margin-right:.75rem}}#group-edit-priv-key-body{line-height:1.2;margin:1.5rem .75rem}#group-edit-priv-key-ok{margin:0 .75rem .75rem}.group-edit-unsubscribed{margin-top:1.5rem}",document.head.appendChild(e);import{d as a,h as o,j as l,k as n,s as t,l as i,m as r,n as u,p as s,e as d,f as p,q as g,u as m,_ as c,v,x as h,r as f,c as b,a as k,y,w,o as C,z as S,F as x,g as F,t as E,b as V}from"./index.9d459617.js";import{s as R}from"./page.22c7bc2a.js";var z=a({components:{MessageBox:o,Modal:l,PrivilegeMask:n,SButton:t,SForm:i,SFCheckGroup:r,SFInput:u,SFSelect:s,SSpinner:d},setup(){const e=v(),a=h(),o=p(null),l=p([]),n=p(!1),t=p([]);g((()=>{R({title:"NEW"===e.params.gid?"Create Group":"Edit Group"});const a=e.params.clone||e.params.gid;c.get("/api/groups/"+a).then((e=>{o.value=e.data.group,l.value=e.data.privs,n.value=e.data.canDelete,t.value=e.data.organizations,t.value.unshift("(none)"),u.value.clear(),s.forEach((a=>{e.data.group[a.value]&&u.value.add(a.value)}))}))}));let i=p("");let r=p("");const u=p(new Set),s=[{value:"getHours",label:"Request volunteer hours from this group"},{value:"dswRequired",label:"DSW registration required for this group"},{value:"backgroundCheckRequired",label:"Background check required for this group"}],d=m((()=>"NEW"!==e.params.gid));const f=p(null);const b=m((()=>"NEW"===e.params.gid?"Create Group":"Save Group"));const k=p(null);return{allFlags:s,canClone:d,canDelete:n,deleteModal:f,emailError:function(e){return e&&o.value&&o.value.email?o.value.email.match(/^[a-zA-Z][-a-zA-Z0-9]*$/)?r.value===o.value.email?"Another group has this email list name.":"":"This is not a valid email list name.  Letters, digits, and hyphens only.":""},flags:u,group:o,keyModal:k,nameError:function(e){return e&&o.value?o.value.name?i.value===o.value.name?"Another group has this name.":"":"The group name is required.":""},onClone:function(){a.push({name:"groups-gid",params:{gid:"NEW",clone:e.params.gid}})},onDelete:async function(){if(!await f.value.show())return;const o=new FormData;o.append("delete","true"),await c.post("/api/groups/"+e.params.gid,o),a.push("/admin/groups")},onShowKey:function(){k.value.show()},onSubmit:async function(){if(!o.value)return;const n=new FormData;n.append("name",o.value.name),n.append("email",o.value.email),s.forEach((e=>{n.append(e.value,u.value.has(e.value).toString())})),n.append("organization",o.value.organization),l.value.forEach((e=>{e.member&&n.append("member:"+e.id,"true"),e.roster&&n.append("roster:"+e.id,"true"),e.contact&&n.append("contact:"+e.id,"true"),e.admin&&n.append("admin:"+e.id,"true"),e.events&&n.append("events:"+e.id,"true"),e.texts&&n.append("texts:"+e.id,"true"),e.emails&&n.append("emails:"+e.id,"true"),e.bcc&&n.append("bcc:"+e.id,"true"),e.folders&&n.append("folders:"+e.id,"true")}));const t=(await c.post("/api/groups/"+e.params.gid,n)).data;t?(t.duplicateName&&(i.value=o.value.name),t.duplicateEmail&&(r.value=o.value.email)):a.push("/admin/groups")},organizations:t,privs:l,submitLabel:b}}});const D={key:0,id:"group-edit"},M={class:"form-item",id:"group-edit-privs"},G=k("div",{class:"group-edit-role group-edit-heading"},"Role",-1),L={class:"group-edit-privs group-edit-heading"},U=V("Privileges ("),_=V(")"),q={key:0,class:"group-edit-unsubscribed"},A=k("div",null,"Unsubscribed from emails to this group:",-1),B={key:1,class:"group-edit-unsubscribed"},T=k("div",null,"Unsubscribed from text messages to this group:",-1),K=V("Clone Group"),N=V("Delete Group"),W=k("div",{class:"form-item",id:"group-edit-priv-key-body"},[k("div",null,"M = Role conveys membership in group"),k("div",null,"R = Role allows viewing group roster"),k("div",null,"C = Role allows viewing contact info of group members"),k("div",null,"A = Role allows admin of group (adding/removing members)"),k("div",null,"E = Role allows management of events for group"),k("div",null,"F = Role allows management of files for group"),k("div",null,"T = Role allows sending text messages to group"),k("div",null,"@ = Role allows sending email messages to group"),k("div",null,"B = Role gets bcc'd on email messages to group")],-1),j=V("OK"),P=V("Are you sure you want to delete this group? All associated data, including privileges and memberships, will be permanently lost.");z.render=function(e,a,o,l,n,t){const i=f("SSpinner"),r=f("SFInput"),u=f("SFCheckGroup"),s=f("SFSelect"),d=f("PrivilegeMask"),p=f("SButton"),g=f("SForm"),m=f("Modal"),c=f("MessageBox");return e.group?(C(),b(g,{key:1,id:"group-edit",onSubmit:e.onSubmit,submitLabel:e.submitLabel},y({default:w((()=>[k(r,{id:"group-edit-name",label:"Group name",trim:"",autofocus:"",modelValue:e.group.name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.group.name=a),errorFn:e.nameError},null,8,["modelValue","errorFn"]),k(r,{id:"group-edit-email",label:"Group email",trim:"",modelValue:e.group.email,"onUpdate:modelValue":a[2]||(a[2]=a=>e.group.email=a),errorFn:e.emailError,help:"@sunnyvaleserv.org"},null,8,["modelValue","errorFn"]),k(u,{id:"group-edit-flags",label:"Flags",options:e.allFlags,modelValue:e.flags,"onUpdate:modelValue":a[3]||(a[3]=a=>e.flags=a)},null,8,["options","modelValue"]),k(s,{id:"group-edit-organization",label:"Organization",options:e.organizations,modelValue:e.group.organization,"onUpdate:modelValue":a[4]||(a[4]=a=>e.group.organization=a),help:"For volunteer hours tracking"},null,8,["options","modelValue"]),k("div",M,[G,k("div",L,[U,k("a",{href:"#",onClick:a[5]||(a[5]=(...a)=>e.onShowKey(...a))},"Key"),_]),(C(!0),b(x,null,F(e.privs,((a,o)=>(C(),b(x,null,[k("div",{class:"group-edit-role",textContent:E(a.name)},null,8,["textContent"]),k(d,{class:"group-edit-privs",modelValue:e.privs[o],"onUpdate:modelValue":a=>e.privs[o]=a},null,8,["modelValue","onUpdate:modelValue"])],64)))),256))]),e.group.noEmail&&e.group.noEmail.length?(C(),b("div",q,[A,(C(!0),b(x,null,F(e.group.noEmail,(e=>(C(),b("div",{textContent:E(e)},null,8,["textContent"])))),256))])):S("",!0),e.group.noText&&e.group.noText.length?(C(),b("div",B,[T,(C(!0),b(x,null,F(e.group.noText,(e=>(C(),b("div",{textContent:E(e)},null,8,["textContent"])))),256))])):S("",!0),k(m,{ref:"keyModal"},{default:w((({close:e})=>[k(g,{dialog:"",title:"Privileges Key"},{buttons:w((()=>[k(p,{id:"group-edit-priv-key-ok",variant:"primary",onClick:a=>e(null)},{default:w((()=>[j])),_:1},8,["onClick"])])),default:w((()=>[W])),_:1})])),_:1},512),k(c,{ref:"deleteModal",title:"Delete Group",cancelLabel:"Keep",okLabel:"Delete",variant:"danger"},{default:w((()=>[P])),_:1},512)])),_:2},[e.canDelete||e.canClone?{name:"extraButtons",fn:w((()=>[e.canClone?(C(),b(p,{key:0,onClick:e.onClone},{default:w((()=>[K])),_:1},8,["onClick"])):S("",!0),e.canDelete?(C(),b(p,{key:1,variant:"danger",onClick:e.onDelete},{default:w((()=>[N])),_:1},8,["onClick"])):S("",!0)]))}:void 0]),1032,["onSubmit","submitLabel"])):(C(),b("div",D,[k(i)]))};export default z;
