import{d as e,S as a,x as n,j as s,e as t,f as i,D as o,_ as l,m as r,z as u,r as d,c,o as b,w as m,a as p,F as S,t as g,h as v,b as f}from"./index.899383f3.js";var y=e({components:{SButton:a,SFCheckGroup:n,SForm:s,SSpinner:t},props:{inModal:{type:Boolean,default:!1},pid:{type:[Number,String],required:!0},email:{type:String}},emits:["done"],setup(e,{emit:a}){const n=i({lists:[]}),s=i(new Set),t=i(!0);o((async()=>{t.value=!0,n.value=(await l.get(`/api/people/${e.pid}/lists`)).data,s.value.clear(),n.value.lists.filter((a=>a.subscribed&&(!e.email||a.name!==`${e.email}@SunnyvaleSERV.org`))).forEach((e=>{s.value.add(e.id)})),t.value=!1}));const d=r((()=>n.value.lists.filter((e=>!s.value.has(e.id)&&e.subWarn.length)).map((e=>{switch(e.subWarn.length){case 1:return`Messages sent to ${e.name} are considered required for the ${e.subWarn[0]} role.  Unsubscribing from it may cause you to lose that role.`;case 2:return`Messages sent to ${e.name} are considered required for the ${e.subWarn[0]} and ${e.subWarn[1]} roles.  Unsubscribing from it may cause you to lose those roles.`;default:return`Messages sent to ${e.name} are considered required for the ${e.subWarn.slice(0,-1).join(", ")}, and ${e.subWarn[e.subWarn.length-1]} roles.  Unsubscribing from it may cause you to lose those roles.`}})).join("\n\n")));u(s,(()=>{n.value.lists.filter((e=>s.value.has(e.id))).forEach((e=>{"email"===e.type&&(n.value.noEmail=!1),"SMS"===e.type&&(n.value.noText=!1)}))}));const c=i(!1);return{listdata:n,loading:t,onCancel:function(){a("done",!1)},onSubmit:async function(){var t=new FormData;t.append("noEmail",n.value.noEmail.toString()),t.append("noText",n.value.noText.toString()),s.value.forEach((e=>{t.append("list",e.toString())})),c.value=!0,await l.post(`/api/people/${e.pid}/lists`,t),c.value=!1,a("done",!0)},onUnsubscribeAll:function(){s.value=new Set,n.value.noEmail=!0,n.value.noText=!0},submitting:c,subscribed:s,unsubscribeWarnings:d}}});const h=f("Unsubscribe All");y.render=function(e,a,n,s,t,i){const o=d("SSpinner"),l=d("SFCheckGroup"),r=d("SButton"),u=d("SForm");return b(),c(u,{dialog:e.inModal,title:e.inModal?"Edit List Subscriptions":null,submitLabel:"Save",cancelLabel:e.inModal?"Cancel":"",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{extraButtons:m((()=>[p(r,{onClick:e.onUnsubscribeAll},{default:m((()=>[h])),_:1},8,["onClick"])])),default:m((()=>[e.loading?(b(),c(o,{key:0})):(b(),c(S,{key:1},[p(l,{id:"person-lists",label:"Subscriptions",options:e.listdata.lists,valueKey:"id",labelKey:"name",modelValue:e.subscribed,"onUpdate:modelValue":a[1]||(a[1]=a=>e.subscribed=a)},null,8,["options","modelValue"]),e.unsubscribeWarnings?(b(),c("div",{key:0,class:"form-item",id:"subscriptions-warning",textContent:g(e.unsubscribeWarnings)},null,8,["textContent"])):v("",!0)],64))])),_:1},8,["dialog","title","cancelLabel","disabled","onSubmit","onCancel"])};export{y as s};
