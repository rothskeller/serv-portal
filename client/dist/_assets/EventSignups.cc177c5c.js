import{d as e,f as s,_ as n,n as i,I as a,e as t,J as d,S as u,K as p}from"./index.5096213b.js";const l=e({name:"EventSignups",setup(){const e=i(),p=s();async function l(s){s.preventDefault();const i=new FormData;p.value.events.forEach((e=>{e.shifts.forEach((s=>{i.append(`${e.id}.${s.start}.${s.task}`,e.declined?"declined":s.signedUp.toString())}))})),await n.post("/api/events/signups"+(e.params.id?`/${e.params.id}`:""),i),p.value.saved=!0}return async function(){p.value=(await n.get("/api/events/signups"+(e.params.id?`/${e.params.id}`:""))).data,p.value.events.forEach((e=>{e.shifts.find((e=>e.signedUp))||(e.declined=!0),e.shifts.forEach((e=>{e.baseCount=e.signedUp?e.count-1:e.count}))}))}(),function(){return p.value?p.value.events.length?a("form",{id:"events-signup",onSubmit:l},[p.value.events.map((e=>function(e,s){function n(n){n&&(e.saved=!1,s.declined=!0,s.shifts.forEach((e=>{e.signedUp=!1})))}return[a("div",{class:"events-signup-event"},`${s.date} ${s.name}`),s.signupText?a("div",{class:"events-signup-text",innerHTML:s.signupText}):null,a("div",{class:"events-signup-shifts"},[s.shifts.map((n=>function(e,s,n){function i(i){e.saved=!1,n.signedUp=i,i?(s.declined=!1,s.shifts.forEach((e=>{n!==e&&n.start<e.end&&n.end>e.start&&(e.signedUp=!1)}))):s.shifts.find((e=>e.signedUp))||(s.declined=!0)}return[a(d,{id:`${s.id}.${n.start}.${n.task}`,class:"events-signup-check",label:`${n.start}â€“${n.end} ${n.task}`,modelValue:n.signedUp,disabled:!n.signedUp&&n.max>0&&n.count>=n.max,"onUpdate:modelValue":i}),o(s,n)]}(e,s,n))),a(d,{id:`${s.id}.declined`,label:"Decline",modelValue:s.declined,disabled:s.declined,"onUpdate:modelValue":n})])]}(p.value,e))),a("div",{id:"events-signup-buttons"},[a(u,{variant:"primary",type:"submit"},(()=>"Save")),p.value.saved?a("div",{id:"events-signup-saved"},"Saved."):null])]):a("div",{id:"events-signup"},"There are no upcoming events for which you can sign up."):a(t,{id:"events-signup"})}}});function o(e,s){const n=s.signedUp?s.baseCount+1:s.baseCount;if(n<=10&&s.min<=10){const e=[];for(let s=0;s<n;s++)e.push(a(p,{class:"events-signup-signedup",icon:"user"}));for(let i=n;i<s.min;i++)e.push(a(p,{class:"events-signup-needed",icon:"user-outline"}));if(0!==s.max&&s.max<=10)for(let i=Math.max(n,s.min);i<s.max;i++)e.push(a(p,{class:"events-signup-allowed",icon:"user-outline"}));else 0!==s.max?e.push(a("span",{class:"events-signup-max"},`(${s.max} allowed)`)):e.push(a("span",{class:"events-signup-max"},"(no maximum)"));return a("div",{class:"events-signup-status"},e)}return n>=s.min?s.max>0?a("div",`${n} signed up, ${s.max} allowed`):a("div",`${n} signed up (no maximum)`):a("div",`${n} signed up, need ${s.min}`)}export default l;
