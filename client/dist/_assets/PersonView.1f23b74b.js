let e=document.createElement("style");e.innerHTML=".person-address-label-Mail,.person-address-label-Work{padding-top:0}.person-address-same-box{white-space:nowrap}.person-address-same-label{margin:0 0 0 .5rem}.person-address-input{display:block;width:100%;margin-top:.5rem}.person-address-input:first-child{margin-top:0}.person-emContact{margin:0 .75rem;border-top:1px solid #ccc;padding-top:.25rem}.person-view-section{margin-bottom:1.5rem}.person-view-section-header{display:flex;align-items:center;justify-content:space-between;background-color:#eee}.person-view-section-header-text{color:#000;font-size:1.25rem;padding-left:.75rem}.person-view-section-edit{flex:none;padding-left:.25rem;background-color:#fff}#person-view-emContacts,#person-view-emails{margin-top:.75rem}.person-view-email-label{color:#888}.person-view-phone{font-variant:tabular-nums}.person-view-phone-label{margin-left:.25rem;color:#888}.person-view-address,.person-view-clearances{margin-top:.75rem;line-height:1.2}.person-view-map{margin-left:1rem}.person-view-map::before{content:'['}.person-view-map::after{content:']'}.person-view-address-flag{color:#888;font-size:.875rem}#person-view-names{display:flex;justify-content:space-between;align-items:flex-start}#person-view-names-ifc{margin-bottom:1.5rem}#person-view-names-ic{font-size:1.25rem;line-height:1.2;color:#000}#person-view-names-i{display:inline;font-weight:700}#person-view-names-c{display:inline;margin-left:.5rem}#person-view-names-f{color:#888;line-height:1}#person-view-names-edit{margin-left:.5rem}#person-edit-note-help{margin:0 .75rem 1rem}.person-edit-note{display:grid;grid:auto-flow/-webkit-min-content 1fr;grid:auto-flow/min-content 1fr;margin:0 .75rem 1rem;-moz-column-gap:1rem;column-gap:1rem}#person-view-notes{margin-top:.75rem}.person-view-note{line-height:1.2;margin-left:2rem;text-indent:-2rem}.person-view-note-date{display:inline;margin-right:.75rem;color:#666;font-variant:tabular-nums}.person-view-note-text{display:inline;margin-left:.5rem}#person-view-roles-badges{display:grid;grid:auto-flow/-webkit-min-content 1fr;grid:auto-flow/min-content 1fr;min-width:0}.person-view-roles-badge{margin-top:1rem}.person-view-roles-titles{margin-top:1rem;line-height:1.2;min-width:0}.person-view-roles-title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#person-edbg-header,.person-heading{margin:0 .75rem;border-top:1px solid #ccc;padding-top:.25rem}#person-edbg-help{margin:0 .75rem;color:#6c757d;font-size:80%}#person-view-status-grid{margin-top:.75rem;display:grid;grid:auto-flow/1fr}#person-view-status-grid>div:nth-child(2n+1),#person-view-status-identification div{white-space:nowrap}#person-view-status-grid>div:nth-child(2n){margin-left:2rem}@media (min-width:400px){#person-view-status-grid{grid:auto-flow/-webkit-min-content 1fr;grid:auto-flow/min-content 1fr}#person-view-status-grid>div:nth-child(2n){margin-left:1rem}}#person-view-status-identification{display:flex;flex-wrap:wrap}#person-view-status-identification div::after{content:',Â '}#person-view-status-identification div:last-child::after{content:''}.person-view-status-date{font-variant-numeric:tabular-nums}.person-view-status-assumed{color:#f60}#person-view-lists-list{margin-top:.75rem;line-height:1.2;margin-left:2em;text-indent:-2em}#person-view{margin:1.5rem .75rem}#person-view-grid{display:grid;grid:auto-flow/1fr}.person-view-spacer{display:none}@media (min-width:740px){#person-view-status-grid{grid:auto-flow/1fr}#person-view-status-grid>div:nth-child(2n){margin-left:2rem}#person-view-grid{grid:auto-flow/1fr 1fr;-moz-column-gap:.75rem;column-gap:.75rem}.person-view-spacer{display:block}}@media (min-width:1048px){#person-view-grid{grid:auto-flow/1fr 1fr 1fr}.person-view-spacer{grid-column:span 2}}#person-view-chpw{display:grid;grid:auto/auto auto;-moz-column-gap:.5rem;column-gap:.5rem;margin-top:.75rem}",document.head.appendChild(e);import{d as o,q as n,j as t,k as a,$ as r,e as l,f as s,i,_ as d,O as u,r as m,c as p,o as c,w as v,a as h,F as g,h as f,a2 as C,z as w,a3 as y,t as b,G as k,a4 as S,a5 as P,y as E,S as V,a6 as A,b as F,m as x,C as R,g as N,x as T,a7 as U,T as $,I as M,v as H,A as B,s as D,n as I}from"./index.4da7e096.js";import{s as q}from"./SubscriptionsForm.8b67f873.js";var z=o({components:{Modal:n,SForm:t,SFInput:a,SFPassword:r,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=i("me"),n=s(null);const t=s([]),a=s(!0);const r=s(""),l=s(null),m=s(""),p=s(null),c=s("");const v=s(!1);return{hints:t,loading:a,me:o,modal:n,oldPassword:r,oldPasswordError:function(e,n){return n?!m.value||r.value||o.value.webmaster?r.value&&r.value===c.value?"This is not the correct old password.":"":"You must supply your old password in order to change your password.":""},oldPasswordRef:l,onCancel:function(){n.value.close(!1)},onSubmit:async function(){var o=new FormData;o.append("oldPassword",r.value),o.append("password",m.value),v.value=!0;try{await d.post(`/api/people/${e.pid}/password`,o),n.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;c.value=r.value}finally{v.value=!1}},password:m,passwordRef:p,show:function(){return r.value=m.value="",async function(){a.value=!0,t.value=(await d.get(`/api/people/${e.pid}/password`)).data,a.value=!1,u((()=>{o.value.webmaster?p.value.focus():l.value.focus()}))}(),n.value.show()},submitting:v}}});z.render=function(e,o,n,t,a,r){const l=m("SSpinner"),s=m("SFInput"),i=m("SFPassword"),d=m("SForm"),u=m("Modal");return c(),p(u,{ref:"modal"},{default:v((()=>[h(d,{dialog:"",variant:"primary",title:"Change Password",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.loading?(c(),p(l,{key:0})):(c(),p(g,{key:1},[e.me.webmaster?f("",!0):(c(),p(s,{key:0,id:"person-oldPassword",ref:"oldPasswordRef",type:"password",label:"Old Password",modelValue:e.oldPassword,"onUpdate:modelValue":o[1]||(o[1]=o=>e.oldPassword=o),errorFn:e.oldPasswordError},null,8,["modelValue","errorFn"])),h(i,{id:"person-password",ref:"passwordRef",label:"New Password",modelValue:e.password,"onUpdate:modelValue":o[2]||(o[2]=o=>e.password=o),allowBadPassword:e.me.webmaster,passwordHints:e.hints},null,8,["modelValue","allowBadPassword","passwordHints"])],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var O=o({props:{type:String,required:{type:Boolean,default:!1},modelValue:{type:Object,required:!0},hasHome:{type:Boolean,default:!1},help:String},emits:["update:modelValue"],setup(e,{emit:o}){var n;const{modelValue:t}=C(e),a=s(""),r=s(""),l=s(!1);let d="",m=0,p=0;(null==(n=e.modelValue)?void 0:n.address)&&(d=e.modelValue.address,a.value=e.modelValue.address.split(",")[0],r.value=e.modelValue.address.replace(/^[^,]*, */,""),m=e.modelValue.latitude||0,p=e.modelValue.longitude||0),e.modelValue?l.value=e.modelValue.sameAsHome||!1:l.value="Mail"===e.type,w(a,(()=>{""===a.value?r.value="":""===r.value&&(r.value="Sunnyvale, CA")}));const c=s(null);w(l,(()=>{a.value=r.value="",o("update:modelValue",{address:"",latitude:0,longitude:0,sameAsHome:l.value}),l.value||u((()=>{var e;null==(e=c.value)||e.focus()}))}));const v=s(null);const h=s(""),g=i("setValidity");w(h,(()=>{null==g||g(`person-address-${e.type}`,!h.value)}));const{submitted:f}=y();async function b(){if(!a.value&&!r.value)return e.required?void(h.value="The address is required."):void o("update:modelValue",{address:"",latitude:0,longitude:0,sameAsHome:l.value});let n=`${a.value}, ${r.value}`;if(n.match(/\W[A-Za-z][A-Za-z]\W/)||(n+=", CA"),n===d)return;const t={address:{regionCode:"US",addressLines:[n]}},s=await fetch("https://addressvalidation.googleapis.com/v1:validateAddress?key=AIzaSyCgi3GzjWG35S89-tnkxHgi5TJVD2eUe2o",{method:"POST",body:JSON.stringify(t)});if(!s||!s.ok)return void(h.value="The address could not be verified because the address verification service is not available.");const i=(await s.json()).result;if("SUB_PREMISE"!==i.verdict.validationGranularity&&"PREMISE"!==i.verdict.validationGranularity)d=n,h.value="We couldn't locate this address.  Please provide a valid address.";else{let e=i.address.formattedAddress;a.value=e.split(",")[0],r.value=e.replace(/^[^,]*, */,""),r.value=r.value.replace(/-[0-8]{4}/,""),r.value=r.value.replace(", USA",""),d=a.value+", "+r.value,m=p=0,i.geocode&&i.geocode.location&&(m=i.geocode.location.latitude,p=i.geocode.location.longitude),o("update:modelValue",{address:d,latitude:m,longitude:p})}}w(f,b);const k="Home"===e.type?"Home Address":"Work"===e.type?"Business Hours Address":"Mailing Address";return{error:h,label:k,line1:a,line1input:c,line2:r,line2input:v,onFocusLine2:function(){var e;null==(e=v.value)||e.select()},onBlur:function(e){e.relatedTarget!==c.value&&e.relatedTarget!==v.value&&b()},sameAsHome:l}}});const _={class:"form-item-input"},Z={key:0,class:"person-address-same-box"},L={class:"form-item-help person-address-helpbox"};O.render=function(e,o,n,t,a,r){return c(),p(g,null,[h("label",{class:["form-item-label",`person-address-label-${e.type}`],textContent:b(e.label)},null,10,["textContent"]),h("div",_,["Home"!==e.type?(c(),p("div",Z,[k(h("input",{class:"person-address-same",id:`person-address-${e.type}-same`,type:"checkbox",autocomplete:"off","onUpdate:modelValue":o[1]||(o[1]=o=>e.sameAsHome=o),disabled:!e.hasHome},null,8,["id","disabled"]),[[S,e.sameAsHome]]),h("label",{class:"person-address-same-label",for:`person-address-${e.type}-same`},"Same as home address",8,["for"])])):f("",!0),e.sameAsHome?f("",!0):k((c(),p("input",{key:1,class:["form-control person-address-input",{"form-control-invalid":e.error}],ref:"line1input",id:`person-address-${e.type}`,"onUpdate:modelValue":o[2]||(o[2]=o=>e.line1=o),onBlur:o[3]||(o[3]=(...o)=>e.onBlur&&e.onBlur(...o))},null,42,["id"])),[[P,e.line1]]),e.sameAsHome?f("",!0):k((c(),p("input",{key:2,class:["form-control person-address-input",{"form-control-invalid":e.error}],ref:"line2input","onUpdate:modelValue":o[4]||(o[4]=o=>e.line2=o),onFocus:o[5]||(o[5]=(...o)=>e.onFocusLine2&&e.onFocusLine2(...o)),onBlur:o[6]||(o[6]=(...o)=>e.onBlur&&e.onBlur(...o))},null,34)),[[P,e.line2]])]),h("div",L,[e.help?(c(),p("div",{key:0,class:"form-item-help-text",textContent:b(e.help)},null,8,["textContent"])):f("",!0),e.error?(c(),p("div",{key:1,class:"form-item-error-text",textContent:b(e.error)},null,8,["textContent"])):f("",!0)])],64)};const Y=["Co-worker","Daughter","Father","Friend","Mother","Neighbor","Other","Relative","Son","Spouse","Supervisor"];var W=o({components:{Modal:n,PersonEditAddress:O,SForm:t,SFInput:a,SFSelect:E,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=s(null);const n=s({}),t=s(!0);const a=s("");const r=s("");const l=s(!1);return{loading:t,modal:o,onCancel:function(){o.value.close(!1)},onSubmit:async function(){var t=new FormData;t.append("email",n.value.email),t.append("email2",n.value.email2),t.append("cellPhone",n.value.cellPhone),t.append("homePhone",n.value.homePhone),t.append("workPhone",n.value.workPhone),n.value.homeAddress.address&&(t.append("homeAddress",n.value.homeAddress.address),t.append("homeAddressLatitude",(n.value.homeAddress.latitude||0).toString()),t.append("homeAddressLongitude",(n.value.homeAddress.longitude||0).toString())),n.value.workAddress.address?(t.append("workAddress",n.value.workAddress.address),t.append("workAddressLatitude",(n.value.workAddress.latitude||0).toString()),t.append("workAddressLongitude",(n.value.workAddress.longitude||0).toString())):t.append("workAddressSameAsHome",n.value.workAddress.sameAsHome.toString()),n.value.mailAddress.address?t.append("mailAddress",n.value.mailAddress.address):t.append("mailAddressSameAsHome",n.value.mailAddress.sameAsHome.toString()),n.value.canEditEmContacts&&(t.append("emContact1Name",n.value.emContacts[0].name),t.append("emContact1HomePhone",n.value.emContacts[0].homePhone),t.append("emContact1CellPhone",n.value.emContacts[0].cellPhone),t.append("emContact1Relationship",n.value.emContacts[0].relationship),t.append("emContact2Name",n.value.emContacts[1].name),t.append("emContact2HomePhone",n.value.emContacts[1].homePhone),t.append("emContact2CellPhone",n.value.emContacts[1].cellPhone),t.append("emContact2Relationship",n.value.emContacts[1].relationship)),l.value=!0;try{await d.post(`/api/people/${e.pid}/contact`,t),o.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;switch(e.response.data){case"email":a.value=n.value.email;break;case"cellPhone":r.value=n.value.cellPhone}}finally{l.value=!1}},person:n,show:function(){return async function(){if(t.value=!0,n.value=(await d.get(`/api/people/${e.pid}/contact`)).data,n.value.canEditEmContacts)for(;n.value.emContacts.length<2;)n.value.emContacts.push({name:"",homePhone:"",cellPhone:"",relationship:""});t.value=!1}(),o.value.show()},submitting:l,emailError:function(e){var o;return e&&(null==(o=n.value)?void 0:o.email)?n.value.email.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)?a.value===n.value.email?"Another user has this email address.":"":"This is not a valid email address.":""},email2Error:function(e){var o;return e&&(null==(o=n.value)?void 0:o.email2)?n.value.email2.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)?n.value.email===n.value.email2?"The two email addresses should not be the same.  (Leave this field empty if you only have one.)":"":"This is not a valid email address.":""},cellPhoneError:function(e){var o;return(null==(o=n.value)?void 0:o.cellPhone)?e&&10!==n.value.cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":r.value===n.value.cellPhone?"A different person has this cell phone number.":"":""},homePhoneError:function(e){var o;return e&&(null==(o=n.value)?void 0:o.homePhone)&&10!==n.value.homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},workPhoneError:function(e){var o;return e&&(null==(o=n.value)?void 0:o.workPhone)&&10!==n.value.workPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},emContact1HomePhoneError:function(e,o){var t,a;return e?o&&n.value.emContacts[0].name&&!n.value.emContacts[0].homePhone&&!n.value.emContacts[0].cellPhone?"The emergency contact must have at least one phone number.":(null==(t=n.value)?void 0:t.emContacts)&&(null==(a=n.value)?void 0:a.emContacts[0].homePhone)&&10!==n.value.emContacts[0].homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":"":""},emContact1CellPhoneError:function(e,o){var t;return e&&(null==(t=n.value)?void 0:t.emContacts[0].cellPhone)&&10!==n.value.emContacts[0].cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},emContact1RelationshipError:function(e,o){return e&&o&&n.value.emContacts[0].name&&!n.value.emContacts[0].relationship?"The relationship is required.":""},emContact2HomePhoneError:function(e,o){var t,a;return e?o&&n.value.emContacts[1].name&&!n.value.emContacts[1].homePhone&&!n.value.emContacts[1].cellPhone?"The emergency contact must have at least one phone number.":(null==(t=n.value)?void 0:t.emContacts)&&(null==(a=n.value)?void 0:a.emContacts[1].homePhone)&&10!==n.value.emContacts[1].homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":"":""},emContact2CellPhoneError:function(e,o){var t;return e&&(null==(t=n.value)?void 0:t.emContacts[1].cellPhone)&&10!==n.value.emContacts[1].cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},emContact2RelationshipError:function(e,o){return e&&o&&n.value.emContacts[1].name&&!n.value.emContacts[1].relationship?"The relationship is required.":""},relationshipOptions:Y}}});const G=h("div",{class:"form-item person-emContact"},"Emergency Contact 1",-1),j=h("div",{class:"form-item person-emContact"},"Emergency Contact 2",-1);W.render=function(e,o,n,t,a,r){const l=m("SSpinner"),s=m("SFInput"),i=m("PersonEditAddress"),d=m("SFSelect"),u=m("SForm"),C=m("Modal");return c(),p(C,{ref:"modal"},{default:v((()=>[h(u,{dialog:"",variant:"primary",title:"Edit Contact Information",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.loading?(c(),p(l,{key:0})):(c(),p(g,{key:1},[h(s,{id:"person-email",label:"Email",help:"This is the email address you log in with.",trim:"",autofocus:"",modelValue:e.person.email,"onUpdate:modelValue":o[1]||(o[1]=o=>e.person.email=o),errorFn:e.emailError,style:{"text-transform":"lowercase"}},null,8,["modelValue","errorFn"]),h(s,{id:"person-email2",label:"Alt. Email",trim:"",modelValue:e.person.email2,"onUpdate:modelValue":o[2]||(o[2]=o=>e.person.email2=o),errorFn:e.email2Error,style:{"text-transform":"lowercase"}},null,8,["modelValue","errorFn"]),h(s,{id:"person-cellPhone",label:"Cell Phone",trim:"",modelValue:e.person.cellPhone,"onUpdate:modelValue":o[3]||(o[3]=o=>e.person.cellPhone=o),errorFn:e.cellPhoneError},null,8,["modelValue","errorFn"]),h(s,{id:"person-homePhone",label:"Home Phone",trim:"",modelValue:e.person.homePhone,"onUpdate:modelValue":o[4]||(o[4]=o=>e.person.homePhone=o),errorFn:e.homePhoneError},null,8,["modelValue","errorFn"]),h(s,{id:"person-workPhone",label:"Work Phone",trim:"",modelValue:e.person.workPhone,"onUpdate:modelValue":o[5]||(o[5]=o=>e.person.workPhone=o),errorFn:e.workPhoneError},null,8,["modelValue","errorFn"]),h(i,{type:"Home",modelValue:e.person.homeAddress,"onUpdate:modelValue":o[6]||(o[6]=o=>e.person.homeAddress=o)},null,8,["modelValue"]),h(i,{type:"Work",modelValue:e.person.workAddress,"onUpdate:modelValue":o[7]||(o[7]=o=>e.person.workAddress=o),hasHome:!!e.person.homeAddress.address},null,8,["modelValue","hasHome"]),h(i,{type:"Mail",modelValue:e.person.mailAddress,"onUpdate:modelValue":o[8]||(o[8]=o=>e.person.mailAddress=o),hasHome:!!e.person.homeAddress.address},null,8,["modelValue","hasHome"]),e.person.canEditEmContacts?(c(),p(g,{key:0},[G,h(s,{id:"person-emContact1Name",label:"Name",trim:"",modelValue:e.person.emContacts[0].name,"onUpdate:modelValue":o[9]||(o[9]=o=>e.person.emContacts[0].name=o)},null,8,["modelValue"]),h(s,{id:"person-emContact1HomePhone",label:"Home Phone",trim:"",modelValue:e.person.emContacts[0].homePhone,"onUpdate:modelValue":o[10]||(o[10]=o=>e.person.emContacts[0].homePhone=o),errorFn:e.emContact1HomePhoneError},null,8,["modelValue","errorFn"]),h(s,{id:"person-emContact1CellPhone",label:"Cell Phone",trim:"",modelValue:e.person.emContacts[0].cellPhone,"onUpdate:modelValue":o[11]||(o[11]=o=>e.person.emContacts[0].cellPhone=o),errorFn:e.emContact1CellPhoneError},null,8,["modelValue","errorFn"]),h(d,{id:"person-emContact1Relationship",label:"Relationship",options:e.relationshipOptions,modelValue:e.person.emContacts[0].relationship,"onUpdate:modelValue":o[12]||(o[12]=o=>e.person.emContacts[0].relationship=o),errorFn:e.emContact1RelationshipError},null,8,["options","modelValue","errorFn"]),j,h(s,{id:"person-emContact2Name",label:"Name",trim:"",modelValue:e.person.emContacts[1].name,"onUpdate:modelValue":o[13]||(o[13]=o=>e.person.emContacts[1].name=o)},null,8,["modelValue"]),h(s,{id:"person-emContact2HomePhone",label:"Home Phone",trim:"",modelValue:e.person.emContacts[1].homePhone,"onUpdate:modelValue":o[14]||(o[14]=o=>e.person.emContacts[1].homePhone=o),errorFn:e.emContact2HomePhoneError},null,8,["modelValue","errorFn"]),h(s,{id:"person-emContact2CellPhone",label:"Cell Phone",trim:"",modelValue:e.person.emContacts[1].cellPhone,"onUpdate:modelValue":o[15]||(o[15]=o=>e.person.emContacts[1].cellPhone=o),errorFn:e.emContact2CellPhoneError},null,8,["modelValue","errorFn"]),h(d,{id:"person-emContact2Relationship",label:"Relationship",options:e.relationshipOptions,modelValue:e.person.emContacts[1].relationship,"onUpdate:modelValue":o[16]||(o[16]=o=>e.person.emContacts[1].relationship=o),errorFn:e.emContact2RelationshipError},null,8,["options","modelValue","errorFn"])],64)):f("",!0)],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var J=o({components:{SButton:V},props:{title:{type:String,required:!0},editable:{type:Boolean,required:!0}},emits:["edit"]});const K={class:"person-view-section-header"},Q={key:0,class:"person-view-section-edit"},X=F("Edit");J.render=function(e,o,n,t,a,r){const l=m("SButton");return c(),p("div",{class:["person-view-section",{"person-view-section-editable":e.editable}]},[h("div",K,[h("div",{class:"person-view-section-header-text",textContent:b(e.title)},null,8,["textContent"]),e.editable?(c(),p("div",Q,[h(l,{class:"person-view-section-ebtn",variant:"primary",small:"",onClick:o[1]||(o[1]=o=>e.$emit("edit"))},{default:v((()=>[X])),_:1})])):f("",!0)]),A(e.$slots,"default")],2)};var ee=o({components:{PersonEditContact:W,PersonViewSection:J},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=x((()=>!!e.person.contact&&(e.person.contact.email||e.person.contact.email2||e.person.contact.cellPhone||e.person.contact.homePhone||e.person.contact.workPhone||e.person.contact.homeAddress||e.person.contact.workAddress||e.person.contact.mailAddress))),t=s(null);return{editContactModal:t,hasContactInfo:n,onEditContact:async function(){await t.value.show()&&o("reload")}}}});const oe={key:0,id:"person-view-emails"},ne={key:0},te={key:1},ae={key:1,class:"person-view-phone"},re=h("span",{class:"person-view-phone-label"},"(Cell)",-1),le={key:2,class:"person-view-phone"},se=h("span",{class:"person-view-phone-label"},"(Home)",-1),ie={key:3,class:"person-view-phone"},de=h("span",{class:"person-view-phone-label"},"(Work)",-1),ue={key:4,class:"person-view-address"},me={key:0},pe={key:1},ce={key:5,class:"person-view-address"},ve=h("span",null,"Work Address:",-1),he={key:6,class:"person-view-address"},ge=h("div",null,"Mailing Address:",-1);ee.render=function(e,o,n,t,a,r){const l=m("PersonEditContact"),s=m("PersonViewSection");return e.hasContactInfo||e.person.canEdit?(c(),p(s,{key:0,title:"Contact Information",editable:e.person.canEdit,onEdit:e.onEditContact},{default:v((()=>[e.person.contact.email||e.person.contact.email2?(c(),p("div",oe,[e.person.contact.email?(c(),p("div",ne,[h("a",{href:`mailto:${e.person.contact.email}`,textContent:b(e.person.contact.email)},null,8,["href","textContent"])])):f("",!0),e.person.contact.email2?(c(),p("div",te,[h("a",{href:`mailto:${e.person.contact.email2}`,textContent:b(e.person.contact.email2)},null,8,["href","textContent"])])):f("",!0)])):f("",!0),e.person.contact.cellPhone?(c(),p("div",ae,[h("a",{href:`tel:${e.person.contact.cellPhone}`,textContent:b(e.person.contact.cellPhone)},null,8,["href","textContent"]),re])):f("",!0),e.person.contact.homePhone?(c(),p("div",le,[h("a",{href:`tel:${e.person.contact.homePhone}`,textContent:b(e.person.contact.homePhone)},null,8,["href","textContent"]),se])):f("",!0),e.person.contact.workPhone?(c(),p("div",ie,[h("a",{href:`tel:${e.person.contact.workPhone}`,textContent:b(e.person.contact.workPhone)},null,8,["href","textContent"]),de])):f("",!0),e.person.contact.homeAddress&&e.person.contact.homeAddress.address?(c(),p("div",ue,[h("div",null,[e.person.contact.workAddress&&e.person.contact.workAddress.sameAsHome?(c(),p("span",me,"Home Address (all day):")):(c(),p("span",pe,"Home Address:")),h("a",{class:"person-view-map",target:"_blank",href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.person.contact.homeAddress.address)}`},"Map",8,["href"])]),h("div",{textContent:b(e.person.contact.homeAddress.address.split(",")[0])},null,8,["textContent"]),h("div",{textContent:b(e.person.contact.homeAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"]),e.person.contact.homeAddress.fireDistrict?(c(),p("div",{key:0,textContent:b(`Sunnyvale Fire District ${e.person.contact.homeAddress.fireDistrict}`)},null,8,["textContent"])):f("",!0)])):f("",!0),e.person.contact.workAddress&&e.person.contact.workAddress.address?(c(),p("div",ce,[h("div",null,[ve,h("a",{class:"person-view-map",target:"_blank",href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.person.contact.workAddress.address)}`},"Map",8,["href"])]),h("div",{textContent:b(e.person.contact.workAddress.address.split(",")[0])},null,8,["textContent"]),h("div",{textContent:b(e.person.contact.workAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"]),e.person.contact.workAddress.fireDistrict?(c(),p("div",{key:0,textContent:b(`Sunnyvale Fire District ${e.person.contact.workAddress.fireDistrict}`)},null,8,["textContent"])):f("",!0)])):f("",!0),e.person.contact.mailAddress&&e.person.contact.mailAddress.address?(c(),p("div",he,[ge,h("div",{textContent:b(e.person.contact.mailAddress.address.split(",")[0])},null,8,["textContent"]),h("div",{textContent:b(e.person.contact.mailAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"])])):f("",!0),e.person.emContacts?(c(),p("div",{key:7,id:"person-view-emContacts",textContent:b(`${e.person.emContacts} emergency contact${e.person.emContacts>1?"s":""} on file`)},null,8,["textContent"])):f("",!0),e.person.canEdit?(c(),p(l,{key:8,ref:"editContactModal",pid:e.person.id},null,8,["pid"])):f("",!0)])),_:1},8,["editable","onEdit"])):f("",!0)};var fe=o({components:{Modal:n,SForm:t,SFInput:a,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=s(null);const n=s({}),t=s(!0);const a=s(""),r=s("");function l(e){if(!e)return e;const o=e.split(/\s+/,2);return o.length>1?`${o[1]}, ${o[0]}`:e}w((()=>n.value.informalName),((e,o)=>{n.value.formalName===o&&(n.value.formalName=e),n.value.sortName===l(o)&&(n.value.sortName=l(e))}));const i=s(!1);return{birthdateError:function(e){return n.value.birthdate&&e&&!n.value.birthdate.match(/^(?:19|20)\d\d-\d\d-\d\d$/)?"This is not a valid YYYY-MM-DD date.":""},callSignError:function(e){var o;return n.value.callSign?e&&!n.value.callSign.match(/^[AKNW][A-Z]?[0-9][A-Z]{1,3}$/i)?"This is not a valid call sign.":a.value===(null==(o=n.value)?void 0:o.callSign)?"A different person has this call sign.":"":""},formalNameError:function(e){return e?n.value.formalName?"":"A name is required.":""},informalNameError:function(e){return e?n.value.informalName?"":"A name is required.":""},loading:t,modal:o,onCancel:function(){o.value.close(!1)},onSubmit:async function(){var t=new FormData;t.append("informalName",n.value.informalName),t.append("formalName",n.value.formalName),t.append("sortName",n.value.sortName),t.append("callSign",n.value.callSign),t.append("birthdate",n.value.birthdate),i.value=!0;try{await d.post(`/api/people/${e.pid}/names`,t),o.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;switch(e.response.data){case"sortName":r.value=n.value.sortName;break;case"callSign":a.value=n.value.callSign}}finally{i.value=!1}},person:n,show:function(){return async function(){t.value=!0,n.value=(await d.get(`/api/people/${e.pid}/names`)).data,t.value=!1}(),o.value.show()},sortNameError:function(e){var o;return n.value.sortName?r.value===(null==(o=n.value)?void 0:o.sortName)?"A different person has this name.":"":e?"A name is required.":""},submitting:i}}});fe.render=function(e,o,n,t,a,r){const l=m("SSpinner"),s=m("SFInput"),i=m("SForm"),d=m("Modal");return c(),p(d,{ref:"modal"},{default:v((()=>[h(i,{dialog:"",variant:"primary",title:"Edit Names",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.loading?(c(),p(l,{key:0})):(c(),p(g,{key:1},[h(s,{id:"person-informalName",label:"Name",trim:"",autofocus:"",modelValue:e.person.informalName,"onUpdate:modelValue":o[1]||(o[1]=o=>e.person.informalName=o),errorFn:e.informalNameError,help:"What you like to be called, e.g. âJoe Banksâ"},null,8,["modelValue","errorFn"]),h(s,{id:"person-formalName",label:"Formal name",trim:"",modelValue:e.person.formalName,"onUpdate:modelValue":o[2]||(o[2]=o=>e.person.formalName=o),errorFn:e.formalNameError,help:"For formal documents, e.g. âJoseph A. Banks, Jr.â"},null,8,["modelValue","errorFn"]),h(s,{id:"person-sortName",label:"Sort name",trim:"",modelValue:e.person.sortName,"onUpdate:modelValue":o[3]||(o[3]=o=>e.person.sortName=o),errorFn:e.sortNameError,help:"For appearance in sorted lists, e.g. âBanks, Joeâ"},null,8,["modelValue","errorFn"]),h(s,{id:"person-callSign",label:"Call sign",trim:"",modelValue:e.person.callSign,"onUpdate:modelValue":o[4]||(o[4]=o=>e.person.callSign=o),errorFn:e.callSignError,help:"FCC amateur radio license",style:{"text-transform":"uppercase"}},null,8,["modelValue","errorFn"]),e.person.birthdate||""===e.person.birthdate?(c(),p(s,{key:0,id:"person-birthdate",label:"Birthdate",type:"date",modelValue:e.person.birthdate,"onUpdate:modelValue":o[5]||(o[5]=o=>e.person.birthdate=o),errorFn:e.birthdateError},null,8,["modelValue","errorFn"])):f("",!0)],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var Ce=o({components:{PersonEditNames:fe,SButton:V},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=s(null);return{editNamesModal:n,onEditNames:async function(){await n.value.show()&&o("reload")}}}});const we={id:"person-view-names"},ye={id:"person-view-names-ifc"},be={id:"person-view-names-ic"},ke={key:0,id:"person-view-names-edit"},Se=F("Edit");Ce.render=function(e,o,n,t,a,r){const l=m("SButton"),s=m("PersonEditNames");return c(),p("div",we,[h("div",ye,[h("div",be,[h("div",{id:"person-view-names-i",textContent:b(e.person.informalName)},null,8,["textContent"]),e.person.callSign?(c(),p("div",{key:0,id:"person-view-names-c",textContent:b(e.person.callSign)},null,8,["textContent"])):f("",!0)]),e.person.formalName!==e.person.informalName?(c(),p("div",{key:0,id:"person-view-names-f",textContent:b(`(${e.person.formalName})`)},null,8,["textContent"])):f("",!0)]),e.person.canEdit?(c(),p("div",ke,[h(l,{variant:"primary",small:"",onClick:e.onEditNames},{default:v((()=>[Se])),_:1},8,["onClick"])])):f("",!0),e.person.canEdit?(c(),p(s,{key:1,ref:"editNamesModal",pid:e.person.id},null,8,["pid"])):f("",!0)])};const Pe={webmaster:"Webmasters only",admin:"DPS staff only",leader:"SERV leads only",contact:"Anyone who can see contact info",person:"Anyone"};let Ee=[{value:"webmaster",label:"Webmasters only"},{value:"admin",label:"DPS staff only"},{value:"leader",label:"SERV leads only"},{value:"contact",label:"Anyone who can see contact info"},{value:"person",label:"Anyone"}];var Ve=o({components:{Modal:n,SButton:V,SForm:t,SFInput:a,SFSelect:E,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=s(null);const n=s([]),t=s([]),a=s({}),r=s(!0);const l=s(null);const i=s(!1);return{editNote:function(e){a.value.date&&a.value.note&&n.value.push(a.value),t.value.forEach((e=>n.value.push(e)));const o=n.value.findIndex((o=>o===e));t.value=n.value.splice(o+1),a.value=n.value.splice(o,1)[0],u((()=>{l.value.focus()}))},loading:r,modal:o,noteEditing:a,noteRef:l,notesAfter:t,notesBefore:n,onAdd:function(){a.value.date&&a.value.note&&n.value.push(a.value),t.value.forEach((e=>n.value.push(e))),t.value=[],a.value={date:R().format("YYYY-MM-DD"),note:"",visibility:Ee[0].value},u((()=>{l.value.focus()}))},onCancel:function(){o.value.close(!1)},onSubmit:async function(){var r=new FormData;n.value.forEach((e=>{r.append("note",e.note),r.append("date",e.date),r.append("visibility",e.visibility)})),a.value.date&&a.value.note&&(r.append("note",a.value.note),r.append("date",a.value.date),r.append("visibility",a.value.visibility)),t.value.forEach((e=>{r.append("note",e.note),r.append("date",e.date),r.append("visibility",e.visibility)})),i.value=!0,await d.post(`/api/people/${e.pid}/notes`,r),i.value=!1,o.value.close(!0)},show:function(){return async function(){r.value=!0;const o=(await d.get(`/api/people/${e.pid}/notes`)).data;n.value=o.notes,n.value.sort(((e,o)=>e.date!==o.date?e.date<o.date?-1:1:e.note.localeCompare(o.note))),t.value=[],Ee=Ee.filter((e=>o.visibilities.includes(e.value))),n.value.length?a.value={date:"",note:"",visibility:""}:a.value={date:R().format("YYYY-MM-DD"),note:"",visibility:Ee[0].value};r.value=!1}(),o.value.show()},submitting:i,visibilityLabels:Pe,visibilityOptions:Ee}}});const Ae={key:0,class:"form-item",id:"person-edit-note-help"},Fe=h("div",null,"Date",-1),xe=h("div",null,"Note",-1),Re=h("div",null,"Vis.",-1),Ne=h("div",null,"Date",-1),Te=h("div",null,"Note",-1),Ue=h("div",null,"Vis.",-1),$e=F("Add");Ve.render=function(e,o,n,t,a,r){const l=m("SSpinner"),s=m("SFInput"),i=m("SFSelect"),d=m("SButton"),u=m("SForm"),C=m("Modal");return c(),p(C,{ref:"modal"},{default:v((()=>[h(u,{dialog:"",variant:"primary",title:"Edit Notes",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{extraButtons:v((()=>[h(d,{variant:"primary",onClick:e.onAdd},{default:v((()=>[$e])),_:1},8,["onClick"])])),default:v((()=>[e.loading?(c(),p(l,{key:0})):(c(),p(g,{key:1},[e.notesBefore.length||e.notesAfter.length?(c(),p("div",Ae,"Click on a note to edit it, or click the Add button to add one.")):f("",!0),(c(!0),p(g,null,N(e.notesBefore,(o=>(c(),p("div",{class:"person-edit-note form-item",onClick:n=>e.editNote(o)},[Fe,h("div",{textContent:b(o.date)},null,8,["textContent"]),xe,h("div",{textContent:b(o.note)},null,8,["textContent"]),Re,h("div",{textContent:b(e.visibilityLabels[o.visibility])},null,8,["textContent"])],8,["onClick"])))),256)),e.noteEditing.date?(c(),p(g,{key:1},[h(s,{id:"person-edit-note-date",label:"Date",type:"date",modelValue:e.noteEditing.date,"onUpdate:modelValue":o[1]||(o[1]=o=>e.noteEditing.date=o)},null,8,["modelValue"]),h(s,{id:"person-edit-note-note",ref:"noteRef",label:"Note Text",trim:"",modelValue:e.noteEditing.note,"onUpdate:modelValue":o[2]||(o[2]=o=>e.noteEditing.note=o)},null,8,["modelValue"]),h(i,{id:"person-edit-note-visibility",label:"Visibility",options:e.visibilityOptions,modelValue:e.noteEditing.visibility,"onUpdate:modelValue":o[3]||(o[3]=o=>e.noteEditing.visibility=o)},null,8,["options","modelValue"])],64)):f("",!0),(c(!0),p(g,null,N(e.notesAfter,(o=>(c(),p("div",{class:"person-edit-note form-item",onClick:n=>e.editNote(o)},[Ne,h("div",{textContent:b(o.date)},null,8,["textContent"]),Te,h("div",{textContent:b(o.note)},null,8,["textContent"]),Ue,h("div",{textContent:b(e.visibilityLabels[o.visibility])},null,8,["textContent"])],8,["onClick"])))),256))],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var Me=o({components:{PersonEditNotes:Ve,PersonViewSection:J},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=s(null);return{editNotesModal:n,onEditNotes:async function(){await n.value.show()&&o("reload")}}}});const He={id:"person-view-notes"},Be={class:"person-view-note"},De={key:0};Me.render=function(e,o,n,t,a,r){const l=m("PersonEditNotes"),s=m("PersonViewSection");return e.person.notes.length||e.person.canEditNotes?(c(),p(s,{key:0,title:"Notes",editable:e.person.canEditNotes,onEdit:e.onEditNotes},{default:v((()=>[h("div",He,[(c(!0),p(g,null,N(e.person.notes,(e=>(c(),p("div",Be,[h("div",{class:"person-view-note-date",textContent:b(e.date)},null,8,["textContent"]),h("div",{class:"person-view-note-text",textContent:b(e.note)},null,8,["textContent"])])))),256)),e.person.notes.length?f("",!0):(c(),p("div",De,"No notes on file."))]),e.person.canEdit?(c(),p(l,{key:0,ref:"editNotesModal",pid:e.person.id},null,8,["pid"])):f("",!0)])),_:1},8,["editable","onEdit"])):f("",!0)};const Ie={admin:"Admin","cert-d":"CERT Deployment","cert-t":"CERT Training",listos:"Listos",sares:"SARES",snap:"SNAP"};var qe=o({components:{Modal:n,SFCheckGroup:T,SForm:t,SFSelect:E,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=s(null);const n=s([]),t=s("");const a=s([]),r=s(new Set);w(t,(()=>{if(!n.value.length)return;const e=n.value.find((e=>e.org===t.value)).roles;r.value=new Set(e.filter((e=>e.held)).map((e=>e.id)))})),w([r,t],((e,o)=>{if(!n.value.length)return;let l=e[1]!=o[1];if(e[0].forEach((e=>{o[0].has(e)||(l=!0)})),o[0].forEach((o=>{e[0].has(o)||(l=!0)})),!l)return;const s=new Set,i=new Set;n.value.forEach((e=>{e.org===t.value?e.roles.filter((e=>(!e.held||e.direct)&&r.value.has(e.id))).forEach((e=>{s.add(e.id),e.implies.forEach((e=>i.add(e)))})):e.roles.filter((e=>e.held&&e.direct)).forEach((e=>{s.add(e.id),e.implies.forEach((e=>i.add(e)))}))})),n.value.forEach((e=>{e.roles.forEach((e=>{s.has(e.id)?e.held=e.direct=!0:i.has(e.id)?(e.held=!0,e.direct=!1):e.held=e.direct=!1}))}));const d=n.value.find((e=>e.org===t.value)).roles;r.value=new Set(d.filter((e=>e.held)).map((e=>e.id))),a.value=d.map((e=>({value:e.id,label:e.name,disabled:e.implicitOnly||e.held&&!e.direct})))}));const l=s(!1);return{modal:o,onCancel:function(){o.value.close(!1)},onSubmit:async function(){var t=new FormData;n.value.forEach((e=>{e.roles.filter((e=>e.held&&e.direct)).forEach((e=>{t.append("role",e.id.toString())}))})),l.value=!0,await d.post(`/api/people/${e.pid}/roles`,t),l.value=!1,o.value.close(!0)},org:t,orgRoleOptions:a,orgRoles:r,orgs:n,show:function(){return async function(){n.value=[],t.value="",n.value=(await d.get(`/api/people/${e.pid}/roles`)).data,n.value.forEach((e=>{e.fmtOrg=Ie[e.org]})),t.value=n.value[0].org}(),o.value.show()},submitting:l}}});function ze(e){return"admin"===e.org&&e.title.startsWith("OES")?"dps":"admin"===e.org?"serv":e.org.replace(/-.*/,"")}qe.render=function(e,o,n,t,a,r){const l=m("SSpinner"),s=m("SFSelect"),i=m("SFCheckGroup"),d=m("SForm"),u=m("Modal");return c(),p(u,{ref:"modal"},{default:v((()=>[h(d,{dialog:"",variant:"primary",title:"Edit Roles",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.orgs.length?(c(),p(g,{key:1},[e.orgs.length>1?(c(),p(s,{key:0,id:"person-roles-org",label:"Org",options:e.orgs,valueKey:"org",labelKey:"fmtOrg",modelValue:e.org,"onUpdate:modelValue":o[1]||(o[1]=o=>e.org=o)},null,8,["options","modelValue"])):f("",!0),h(i,{id:"person-roles-roles",label:e.orgs.length>1?"Roles":"",options:e.orgRoleOptions,disabledKey:"disabled",modelValue:e.orgRoles,"onUpdate:modelValue":o[2]||(o[2]=o=>e.orgRoles=o)},null,8,["label","options","modelValue"])],64)):(c(),p(l,{key:0}))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var Oe=o({components:{OrgBadge:U,PersonEditRoles:qe,PersonViewSection:J},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=s([]);$((()=>{n.value=[],e.person.roles.forEach((e=>{const o=n.value.findIndex((o=>o.org===ze(e)));o<0?n.value.push({org:ze(e),titles:[e.title]}):n.value[o].titles.push(e.title)}))}));const t=s(null);return{editRolesModal:t,onEditRoles:async function(){await t.value.show()&&o("reload")},badges:n}}});const _e={id:"person-view-roles-badges"},Ze={class:"person-view-roles-titles"},Le={key:0,class:"person-view-roles-title"};Oe.render=function(e,o,n,t,a,r){const l=m("OrgBadge"),s=m("PersonEditRoles"),i=m("PersonViewSection");return e.badges.length||e.person.canEditRoles?(c(),p(i,{key:0,title:"SERV "+(1===e.person.roles.length?"Role":"Roles"),editable:e.person.canEditRoles,onEdit:e.onEditRoles},{default:v((()=>[h("div",_e,[(c(!0),p(g,null,N(e.badges,(e=>(c(),p(g,null,[h(l,{class:"person-view-roles-badge",org:e.org},null,8,["org"]),h("div",Ze,[(c(!0),p(g,null,N(e.titles,(e=>(c(),p("div",{class:"person-view-roles-title",textContent:b(e)},null,8,["textContent"])))),256))])],64)))),256)),e.badges.length?f("",!0):(c(),p("div",Le,"No current role in any SERV org."))]),e.person.canEditRoles?(c(),p(s,{key:0,ref:"editRolesModal",pid:e.person.id},null,8,["pid"])):f("",!0)])),_:1},8,["title","editable","onEdit"])):f("",!0)};const Ye=o({name:"PersonEditBGChecks",props:{checks:{type:Array,required:!0},types:{type:Array,required:!0}},setup(e,{expose:o}){const n=s([...e.checks]),t=s([]),a=s({date:"",types:new Set,assumed:!1}),r=s(0===e.checks.length);function l(){return!r.value||!(a.value.date&&!a.value.date.match(/^20\d\d-\d\d-\d\d$/))&&(a.value.types.size&&n.value.push({date:a.value.date,types:e.types.filter((e=>a.value.types.has(e))),assumed:a.value.assumed}),n.value.splice(n.value.length,0,...t.value.splice(0)),n.value.sort(((e,o)=>e.date.localeCompare(o.date))),r.value=!1,!0)}function i(e){if(!l())return;a.value.date=e.date,a.value.types=new Set(e.types),a.value.assumed=e.assumed;const o=n.value.findIndex((o=>o===e));t.value.splice(t.value.length,0,...n.value.splice(o+1)),n.value.splice(o),r.value=!0}return o({startAdd:function(){console.log("startAdd called"),l()&&(a.value.date=R().format("YYYY-MM-DD"),a.value.types=new Set,a.value.assumed=!1,r.value=!0)},prepareForSave:function(){l(),e.checks.splice(0,e.checks.length,...n.value)}}),function(){return[(o=e.checks,[M("div",{id:"person-edbg-header",class:"form-item"},"Background Checks"),o.length?M("div",{id:"person-edbg-help",class:"form-item"},"Click on a check to edit it, or click Add to add one."):null]),We(n.value,i),r.value?Ge(a.value,e.types):null,We(t.value,i)];var o}}});function We(e,o){return e.map((e=>M("div",{class:"form-item-input",onClick:()=>{o(e)}},`${e.date||"Unknown date"}: ${e.types.join(", ")}${e.assumed?" (assumed)":""}`)))}function Ge(e,o){return[M(a,{id:"person-edbg-date",label:"Date",help:"Date on which the background check was cleared (empty if not known)",type:"date",modelValue:e.date,"onUpdate:modelValue":o=>e.date=o,errorFn:o=>o&&""!==e.date?e.date.match(/^20\d\d-\d\d-\d\d$/)?"":"This is not a valid date.":""}),M(T,{id:"person-edbg-types",label:"Type(s)",options:o,inline:!0,modelValue:e.types,"onUpdate:modelValue":o=>e.types=o}),M(H,{id:"person-edbg-assumed",label:"Assumed (no paper record)",help:"Checks are assumed for long-standing volunteers whose historical records are missing.",modelValue:e.assumed,"onUpdate:modelValue":o=>e.assumed=o})]}function je(e){return e.replace(/[^0-9]/g,"")}var Je=o({components:{Modal:n,PersonEditBGChecks:Ye,SButton:V,SForm:t,SFCheckGroup:T,SFInput:a,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=s(null);const n=s({}),t=s(""),a=s(new Set),r=s([]),l=s(!0);const i=s(null);const u=s(!1);return{bgChecksRef:i,digitsOnly:je,dswCERTError:function(e){return e&&n.value.dswCERT?n.value.dswCERT.match(/^20\d\d-\d\d-\d\d$/)?"":"This is not a valid YYYY-MM-DD date.":""},dswCommError:function(e){return e&&n.value.dswComm?n.value.dswComm.match(/^20\d\d-\d\d-\d\d$/)?"":"This is not a valid YYYY-MM-DD date.":""},identification:a,identTypes:r,loading:l,modal:o,onAddBGCheck:function(){var e;console.log("onAddBGCheck called"),null==(e=i.value)||e.startAdd()},onCancel:function(){o.value.close(!1)},onSubmit:async function(){var r;null==(r=i.value)||r.prepareForSave();var l=new FormData;l.append("volgistics",t.value),l.append("dswCERT",n.value.dswCERT||""),l.append("dswComm",n.value.dswComm||""),a.value.forEach((e=>{l.append("identification",e)})),n.value.bgChecks.forEach((e=>{l.append("bgCheck",`${e.date}:${e.types.join(",")}:${e.assumed}`)})),u.value=!0,await d.post(`/api/people/${e.pid}/status`,l),u.value=!1,o.value.close(!0)},person:n,show:function(){return async function(){l.value=!0,n.value=(await d.get(`/api/people/${e.pid}/status`)).data,t.value=n.value.volgistics?n.value.volgistics.toString():"",r.value=n.value.identification.map((e=>({label:e.type,value:e.type}))),a.value=new Set(n.value.identification.filter((e=>e.held)).map((e=>e.type))),l.value=!1}(),o.value.show()},submitting:u,volgistics:t,volgisticsError:function(e){return e&&t.value&&parseInt(t.value)<1?"This is not a valid Volgistics ID number.":""}}}});const Ke=F("Add");Je.render=function(e,o,n,t,a,r){const l=m("SSpinner"),s=m("SFInput"),i=m("SFCheckGroup"),d=m("PersonEditBGChecks"),u=m("SButton"),f=m("SForm"),C=m("Modal");return c(),p(C,{ref:"modal"},{default:v((()=>[h(f,{dialog:"",variant:"primary",title:"Edit Volunteer Status",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{extraButtons:v((()=>[h(u,{variant:"primary",onClick:B(e.onAddBGCheck,["prevent"])},{default:v((()=>[Ke])),_:1},8,["onClick"])])),default:v((()=>[e.loading?(c(),p(l,{key:0})):(c(),p(g,{key:1},[h(s,{id:"person-volgistics",label:"Volgistics ID",modelValue:e.volgistics,"onUpdate:modelValue":o[1]||(o[1]=o=>e.volgistics=o),autofocus:"",errorFn:e.volgisticsError,restrictFn:e.digitsOnly},null,8,["modelValue","errorFn","restrictFn"]),h(s,{id:"person-dsw-cert",type:"date",label:"DSW CERT",modelValue:e.person.dswCERT,"onUpdate:modelValue":o[2]||(o[2]=o=>e.person.dswCERT=o),errorFn:e.dswCERTError,help:"Date when CERT DSW registration form was signed."},null,8,["modelValue","errorFn","help"]),h(s,{id:"person-dsw-comm",type:"date",label:"DSW Communications",modelValue:e.person.dswComm,"onUpdate:modelValue":o[3]||(o[3]=o=>e.person.dswComm=o),errorFn:e.dswCommError,help:"Date when Communications DSW registration form was signed."},null,8,["modelValue","errorFn","help"]),h(i,{id:"person-identification",label:"IDs Issued",modelValue:e.identification,"onUpdate:modelValue":o[4]||(o[4]=o=>e.identification=o),options:e.identTypes},null,8,["modelValue","options"]),h(d,{ref:"bgChecksRef",checks:e.person.bgChecks,types:e.person.bgCheckTypes},null,8,["checks","types"])],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};const Qe=[{value:"CERT-D",label:"CERT Deployment Team"},{value:"Outreach",label:"Community Outreach"},{value:"SARES",label:"Amateur Radio (SARES)"},{value:"SNAP",label:"Neighborhood Preparedness Facilitator"},{value:"Listos",label:"Preparedness Instructor"},{value:"CERT-T",label:"CERT Instructor"}];var Xe=o({components:{Modal:n,PersonEditAddress:O,SForm:t,SFCheck:H,SFCheckGroup:T,SFInput:a,SFSelect:E,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const o=s(null),n=s(new Set),t=s(!1);const a=s({}),r=s(!0);const l=s(""),i=s("");const u=s("");const m=s("");const p=s(!1);return{agreement:t,agreementError:function(e,o){return o&&!t.value?"You must agree to this statement in order to register.":""},birthdateError:function(e){return a.value.birthdate?e&&!a.value.birthdate.match(/^(?:19|20)\d\d-\d\d-\d\d$/)?"This is not a valid YYYY-MM-DD date.":"":e?"Your birthdate is required.":""},callSignError:function(e){var o;return a.value.callSign?e&&!a.value.callSign.match(/^[AKNW][A-Z]?[0-9][A-Z]{1,3}$/i)?"This is not a valid call sign.":l.value===(null==(o=a.value)?void 0:o.callSign)?"A different person has this call sign.":"":""},cellPhoneError:function(e,o){var n;return!o||a.value.cellPhone||a.value.homePhone?(null==(n=a.value)?void 0:n.cellPhone)?e&&10!==a.value.cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":m.value===a.value.cellPhone?"A different person has this cell phone number.":"":"":"A cell phone or home phone number is required."},emailError:function(e){var o;return e&&(null==(o=a.value)?void 0:o.email)?a.value.email.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)?u.value===a.value.email?"Another user has this email address.":"":"This is not a valid email address.":""},email2Error:function(e){var o;return e&&(null==(o=a.value)?void 0:o.email2)?a.value.email2.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)?a.value.email===a.value.email2?"The two email addresses should not be the same.  (Leave this field empty if you only have one.)":"":"This is not a valid email address.":""},emContact1NameError:function(e){return e?a.value.emContacts[0].name?"":"The emergency contact name is required.":""},emContact1CellPhoneError:function(e,o){var n;return e&&(null==(n=a.value)?void 0:n.emContacts[0].cellPhone)&&10!==a.value.emContacts[0].cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},emContact1HomePhoneError:function(e,o){var n,t;return e?!o||a.value.emContacts[0].homePhone||a.value.emContacts[0].cellPhone?(null==(n=a.value)?void 0:n.emContacts)&&(null==(t=a.value)?void 0:t.emContacts[0].homePhone)&&10!==a.value.emContacts[0].homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":"":"The emergency contact must have at least one phone number.":""},emContact1RelationshipError:function(e,o){return e&&o&&!a.value.emContacts[0].relationship?"The relationship is required.":""},emContact2NameError:function(e){return e?a.value.emContacts[1].name?"":"The emergency contact name is required.":""},emContact2CellPhoneError:function(e,o){var n;return e&&(null==(n=a.value)?void 0:n.emContacts[1].cellPhone)&&10!==a.value.emContacts[1].cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},emContact2HomePhoneError:function(e,o){var n,t;return e?!o||a.value.emContacts[1].homePhone||a.value.emContacts[1].cellPhone?(null==(n=a.value)?void 0:n.emContacts)&&(null==(t=a.value)?void 0:t.emContacts[1].homePhone)&&10!==a.value.emContacts[1].homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":"":"The emergency contact must have at least one phone number.":""},emContact2RelationshipError:function(e,o){return e&&o&&!a.value.emContacts[1].relationship?"The relationship is required.":""},homePhoneError:function(e){var o;return e&&(null==(o=a.value)?void 0:o.homePhone)&&10!==a.value.homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},informalNameError:function(e){return e?a.value.informalName?"":"A name is required.":""},formalNameError:function(e){return e?a.value.formalName?"":"A name is required.":""},sortNameError:function(e){var o;return a.value.sortName?i.value===(null==(o=a.value)?void 0:o.sortName)?"A different person has this name.":"":e?"A name is required.":""},interestOptions:Qe,interests:n,loading:r,modal:o,onCancel:function(){o.value.close(!1)},onSubmit:async function(){var r=new FormData;r.append("informalName",a.value.informalName),r.append("formalName",a.value.formalName),r.append("sortName",a.value.sortName),r.append("callSign",a.value.callSign),r.append("birthdate",a.value.birthdate),r.append("email",a.value.email),r.append("email2",a.value.email2),r.append("cellPhone",a.value.cellPhone),r.append("homePhone",a.value.homePhone),r.append("workPhone",a.value.workPhone),a.value.homeAddress.address&&(r.append("homeAddress",a.value.homeAddress.address),r.append("homeAddressLatitude",(a.value.homeAddress.latitude||0).toString()),r.append("homeAddressLongitude",(a.value.homeAddress.longitude||0).toString())),a.value.workAddress.address?(r.append("workAddress",a.value.workAddress.address),r.append("workAddressLatitude",(a.value.workAddress.latitude||0).toString()),r.append("workAddressLongitude",(a.value.workAddress.longitude||0).toString())):r.append("workAddressSameAsHome",a.value.workAddress.sameAsHome.toString()),a.value.mailAddress.address?r.append("mailAddress",a.value.mailAddress.address):r.append("mailAddressSameAsHome",a.value.mailAddress.sameAsHome.toString()),r.append("emContact1Name",a.value.emContacts[0].name),r.append("emContact1HomePhone",a.value.emContacts[0].homePhone),r.append("emContact1CellPhone",a.value.emContacts[0].cellPhone),r.append("emContact1Relationship",a.value.emContacts[0].relationship),r.append("emContact2Name",a.value.emContacts[1].name),r.append("emContact2HomePhone",a.value.emContacts[1].homePhone),r.append("emContact2CellPhone",a.value.emContacts[1].cellPhone),r.append("emContact2Relationship",a.value.emContacts[1].relationship),r.append("interests",Array.from(n.value.keys()).join(",")),r.append("agreement",t.value.toString()),p.value=!0;try{await d.post(`/api/people/${e.pid}/volreg`,r),o.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;switch(e.response.data){case"sortName":i.value=a.value.sortName;break;case"callSign":l.value=a.value.callSign;break;case"email":u.value=a.value.email;break;case"cellPhone":m.value=a.value.cellPhone}}finally{p.value=!1}},person:a,show:function(){return async function(){r.value=!0,a.value=(await d.get(`/api/people/${e.pid}/volreg`)).data;for(;a.value.emContacts.length<2;)a.value.emContacts.push({name:"",homePhone:"",cellPhone:"",relationship:""});r.value=!1}(),o.value.show()},submitting:p,workPhoneError:function(e){var o;return e&&(null==(o=a.value)?void 0:o.workPhone)&&10!==a.value.workPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""}}}});const eo=h("div",{class:"form-item"},"Thank you for your interest in volunteering with the City of Sunnyvale, Office of Emergency Services. Please complete this form to register as a City of Sunnyvale Volunteer. Once we receive your registration â which usually takes a few days â we will contact you to schedule an appointment for your fingerprinting.",-1),oo=h("div",{class:"form-item person-heading"},"Emergency Contact 1",-1),no=h("div",{class:"form-item person-heading"},"Emergency Contact 2",-1),to=h("div",{class:"form-item person-heading"},"Agreement",-1),ao=h("div",{class:"form-item"},"By submitting this application, I certify that all statements I have made on this application are true and correct and I hereby authorize the City of Sunnyvale to investigate the accuracy of this information. I am aware that fingerprinting and a criminal records search is required for volunteers 18 years of age or older. I understand that I am working at all times on a voluntary basis, without monetary compensation or benefits, and not as a paid employee. I give the City of Sunnyvale permission to use any photographs or videos taken of me during my service without obligation or compensation to me. I understand that the City of Sunnyvale reserves the right to terminate a volunteer's service at any time. I understand that volunteers are covered under the City of Sunnyvale's Worker's Compensation Program for an injury or accident occurring while on duty.",-1);Xe.render=function(e,o,n,t,a,r){const l=m("SSpinner"),s=m("SFInput"),i=m("PersonEditAddress"),d=m("SFCheckGroup"),u=m("SFSelect"),f=m("SFCheck"),C=m("SForm"),w=m("Modal");return c(),p(w,{ref:"modal"},{default:v((()=>[h(C,{dialog:"",variant:"primary",title:"Register as a City Volunteer",submitLabel:"Register",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.loading?(c(),p(l,{key:0})):(c(),p(g,{key:1},[eo,h(s,{id:"person-informalName",label:"Name",trim:"",autofocus:"",modelValue:e.person.informalName,"onUpdate:modelValue":o[1]||(o[1]=o=>e.person.informalName=o),errorFn:e.informalNameError,help:"What you like to be called, e.g. âJoe Banksâ"},null,8,["modelValue","errorFn"]),h(s,{id:"person-formalName",label:"Formal name",trim:"",modelValue:e.person.formalName,"onUpdate:modelValue":o[2]||(o[2]=o=>e.person.formalName=o),errorFn:e.formalNameError,help:"For formal documents, e.g. âJoseph A. Banks, Jr.â"},null,8,["modelValue","errorFn"]),h(s,{id:"person-sortName",label:"Sort name",trim:"",modelValue:e.person.sortName,"onUpdate:modelValue":o[3]||(o[3]=o=>e.person.sortName=o),errorFn:e.sortNameError,help:"For appearance in sorted lists, e.g. âBanks, Joeâ"},null,8,["modelValue","errorFn"]),h(s,{id:"person-callSign",label:"Call sign",trim:"",modelValue:e.person.callSign,"onUpdate:modelValue":o[4]||(o[4]=o=>e.person.callSign=o),errorFn:e.callSignError,help:"FCC amateur radio license",style:{"text-transform":"uppercase"}},null,8,["modelValue","errorFn"]),h(s,{id:"person-birthdate",label:"Birthdate",type:"date",modelValue:e.person.birthdate,"onUpdate:modelValue":o[5]||(o[5]=o=>e.person.birthdate=o),errorFn:e.birthdateError},null,8,["modelValue","errorFn"]),h(s,{id:"person-email",label:"Email",help:"This is the email address you log in with.",trim:"",autofocus:"",modelValue:e.person.email,"onUpdate:modelValue":o[6]||(o[6]=o=>e.person.email=o),errorFn:e.emailError,style:{"text-transform":"lowercase"}},null,8,["modelValue","errorFn"]),h(s,{id:"person-email2",label:"Alt. Email",trim:"",modelValue:e.person.email2,"onUpdate:modelValue":o[7]||(o[7]=o=>e.person.email2=o),errorFn:e.email2Error,style:{"text-transform":"lowercase"}},null,8,["modelValue","errorFn"]),h(s,{id:"person-cellPhone",label:"Cell Phone",trim:"",modelValue:e.person.cellPhone,"onUpdate:modelValue":o[8]||(o[8]=o=>e.person.cellPhone=o),errorFn:e.cellPhoneError},null,8,["modelValue","errorFn"]),h(s,{id:"person-homePhone",label:"Home Phone",trim:"",modelValue:e.person.homePhone,"onUpdate:modelValue":o[9]||(o[9]=o=>e.person.homePhone=o),errorFn:e.homePhoneError},null,8,["modelValue","errorFn"]),h(s,{id:"person-workPhone",label:"Work Phone",trim:"",modelValue:e.person.workPhone,"onUpdate:modelValue":o[10]||(o[10]=o=>e.person.workPhone=o),errorFn:e.workPhoneError},null,8,["modelValue","errorFn"]),h(i,{type:"Home",required:"",modelValue:e.person.homeAddress,"onUpdate:modelValue":o[11]||(o[11]=o=>e.person.homeAddress=o)},null,8,["modelValue"]),h(i,{type:"Work",modelValue:e.person.workAddress,"onUpdate:modelValue":o[12]||(o[12]=o=>e.person.workAddress=o),hasHome:!!e.person.homeAddress.address},null,8,["modelValue","hasHome"]),h(i,{type:"Mail",modelValue:e.person.mailAddress,"onUpdate:modelValue":o[13]||(o[13]=o=>e.person.mailAddress=o),hasHome:!!e.person.homeAddress.address},null,8,["modelValue","hasHome"]),h(d,{id:"person-interests",label:"Interests",options:e.interestOptions,modelValue:e.interests,"onUpdate:modelValue":o[14]||(o[14]=o=>e.interests=o)},null,8,["options","modelValue"]),oo,h(s,{id:"person-emContact1Name",label:"Name",trim:"",modelValue:e.person.emContacts[0].name,"onUpdate:modelValue":o[15]||(o[15]=o=>e.person.emContacts[0].name=o),errorFn:e.emContact1NameError},null,8,["modelValue","errorFn"]),h(s,{id:"person-emContact1HomePhone",label:"Home Phone",trim:"",modelValue:e.person.emContacts[0].homePhone,"onUpdate:modelValue":o[16]||(o[16]=o=>e.person.emContacts[0].homePhone=o),errorFn:e.emContact1HomePhoneError},null,8,["modelValue","errorFn"]),h(s,{id:"person-emContact1CellPhone",label:"Cell Phone",trim:"",modelValue:e.person.emContacts[0].cellPhone,"onUpdate:modelValue":o[17]||(o[17]=o=>e.person.emContacts[0].cellPhone=o),errorFn:e.emContact1CellPhoneError},null,8,["modelValue","errorFn"]),h(u,{id:"person-emContact1Relationship",label:"Relationship",options:e.relationshipOptions,modelValue:e.person.emContacts[0].relationship,"onUpdate:modelValue":o[18]||(o[18]=o=>e.person.emContacts[0].relationship=o),errorFn:e.emContact1RelationshipError},null,8,["options","modelValue","errorFn"]),no,h(s,{id:"person-emContact2Name",label:"Name",trim:"",modelValue:e.person.emContacts[1].name,"onUpdate:modelValue":o[19]||(o[19]=o=>e.person.emContacts[1].name=o),errorFn:e.emContact2NameError},null,8,["modelValue","errorFn"]),h(s,{id:"person-emContact2HomePhone",label:"Home Phone",trim:"",modelValue:e.person.emContacts[1].homePhone,"onUpdate:modelValue":o[20]||(o[20]=o=>e.person.emContacts[1].homePhone=o),errorFn:e.emContact2HomePhoneError},null,8,["modelValue","errorFn"]),h(s,{id:"person-emContact2CellPhone",label:"Cell Phone",trim:"",modelValue:e.person.emContacts[1].cellPhone,"onUpdate:modelValue":o[21]||(o[21]=o=>e.person.emContacts[1].cellPhone=o),errorFn:e.emContact2CellPhoneError},null,8,["modelValue","errorFn"]),h(u,{id:"person-emContact2Relationship",label:"Relationship",options:e.relationshipOptions,modelValue:e.person.emContacts[1].relationship,"onUpdate:modelValue":o[22]||(o[22]=o=>e.person.emContacts[1].relationship=o),errorFn:e.emContact2RelationshipError},null,8,["options","modelValue","errorFn"]),to,ao,h(f,{id:"person-agreement",label:"I agree",modelValue:e.agreement,"onUpdate:modelValue":o[23]||(o[23]=o=>e.agreement=o),errorFn:e.agreementError},null,8,["modelValue","errorFn"])],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var ro=o({components:{PersonEditStatus:Je,PersonRegisterVolgistics:Xe,PersonViewSection:J,SButton:V},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=i("me"),t=x((()=>!(!(e.person.status&&e.person.status.backgroundCheck.admin&&e.person.status.backgroundCheck.needed)||e.person.status.backgroundCheck.checks.find((o=>o.type.indexOf(e.person.status.backgroundCheck.needed)>=0)))&&e.person.status.backgroundCheck.needed)),a=s(null);const r=s(null);return{editStatusModal:a,onEditStatus:async function(){await a.value.show()&&o("reload")},volgisticsRegisterModal:r,onVolgisticsRegister:async function(){await r.value.show()&&o("reload")},me:n,missingBGCheck:t}}});const lo={id:"person-view-status-grid"},so=h("div",null,"Volgistics",-1),io=h("div",null,"City volunteer",-1),uo={key:0},mo=F("Register"),po={key:1},co=h("div",null,"DSW CERT",-1),vo={key:1},ho={key:2},go={key:3},fo={key:4},Co=h("div",null,"DSW CERT",-1),wo=h("div",{style:{color:"red"}},"Not registered",-1),yo=h("div",null,"DSW SARES",-1),bo={key:1},ko={key:2},So={key:3},Po={key:4},Eo=h("div",null,"DSW SARES",-1),Vo=h("div",{style:{color:"red"}},"Not registered",-1),Ao=h("div",null,"Background Checks",-1),Fo={id:"person-view-status-checks"},xo={key:0,style:{color:"red"}},Ro=h("div",null,"Background check",-1),No=h("div",null,"Cleared",-1),To=h("div",null,"Background check",-1),Uo=h("div",null,"Background check",-1),$o=h("div",{style:{color:"red"}},"Not cleared",-1),Mo=h("div",null,"IDs issued",-1),Ho={id:"person-view-status-identification"};ro.render=function(e,o,n,t,a,r){const l=m("SButton"),s=m("PersonEditStatus"),i=m("PersonRegisterVolgistics"),d=m("PersonViewSection");return e.person.status?(c(),p(d,{key:0,title:"Volunteer Status",editable:e.person.status.canEdit,onEdit:e.onEditStatus},{default:v((()=>[h("div",lo,["admin"===e.person.status.level?(c(),p(g,{key:0},[so,e.person.status.volgistics.id?(c(),p("div",{key:0,textContent:b(`#${e.person.status.volgistics.id}`)},null,8,["textContent"])):e.person.status.volgistics.pending?(c(),p("div",{key:1,style:{color:e.person.status.volgistics.needed?"red":null}},"Registration pending",4)):(c(),p("div",{key:2,style:{color:e.person.status.volgistics.needed?"red":null}},"Not registered",4))],64)):e.person.status.volgistics.id?f("",!0):(c(),p(g,{key:1},[io,e.me.id===e.person.id?(c(),p("div",uo,[h(l,{variant:"primary",small:"",onClick:e.onVolgisticsRegister},{default:v((()=>[mo])),_:1},8,["onClick"])])):e.person.status.volgistics.pending?(c(),p("div",po,"Registration pending")):(c(),p("div",{key:2,style:{color:e.person.status.volgistics.needed?"red":null}},"Not registered",4))],64)),e.person.status.dswCERT.registered?(c(),p(g,{key:2},[co,e.person.status.dswCERT.expired?(c(),p("div",{key:0,style:{color:e.person.status.dswCERT.needed?"red":null}},"Expired on "+b(e.person.status.dswCERT.expires),5)):"admin"==e.person.status.level&&e.person.status.dswCERT.expires?(c(),p("div",vo,"Registered "+b(e.person.status.dswCERT.registered)+", expiresÂ "+b(e.person.status.dswCERT.expires.replace(/-/g,"â")),1)):"admin"==e.person.status.level?(c(),p("div",ho,"Registered "+b(e.person.status.dswCERT.registered),1)):e.person.status.dswCERT.expires?(c(),p("div",go,"Expires on "+b(e.person.status.dswCERT.expires),1)):(c(),p("div",fo,"Registered"))],64)):e.person.status.dswCERT.needed?(c(),p(g,{key:3},[Co,wo],64)):f("",!0),e.person.status.dswComm.registered?(c(),p(g,{key:4},[yo,e.person.status.dswComm.expired?(c(),p("div",{key:0,style:{color:e.person.status.dswComm.needed?"red":null}},"Expired on "+b(e.person.status.dswComm.expires),5)):"admin"==e.person.status.level&&e.person.status.dswComm.expires?(c(),p("div",bo,"Registered "+b(e.person.status.dswComm.registered)+", expiresÂ "+b(e.person.status.dswComm.expires.replace(/-/g,"â")),1)):"admin"==e.person.status.level?(c(),p("div",ko,"Registered "+b(e.person.status.dswComm.registered),1)):e.person.status.dswComm.expires?(c(),p("div",So,"Expires on "+b(e.person.status.dswComm.expires),1)):(c(),p("div",Po,"Registered"))],64)):e.person.status.dswComm.needed?(c(),p(g,{key:5},[Eo,Vo],64)):f("",!0),e.person.status.backgroundCheck.admin?(c(),p(g,{key:6},[Ao,h("div",Fo,[(c(!0),p(g,null,N(e.person.status.backgroundCheck.checks,(e=>(c(),p("div",{class:{"person-view-status-assumed":e.assumed}},[e.date?(c(),p("span",{key:0,class:"person-view-status-date",textContent:b(`${e.date} `)},null,8,["textContent"])):f("",!0),h("span",{textContent:b(e.type.join("+"))},null,8,["textContent"]),e.assumed?(c(),p("span",{key:1,textContent:b(" (assumed)")},null,8,["textContent"])):e.date?f("",!0):(c(),p("span",{key:2,textContent:b(" (date unknown)")},null,8,["textContent"]))],2)))),256)),e.missingBGCheck?(c(),p("div",xo,"Missing required "+b(e.missingBGCheck)+" check",1)):f("",!0)])],64)):(c(),p(g,{key:7},["true"===e.person.status.backgroundCheck.cleared?(c(),p(g,{key:0},[Ro,No],64)):e.person.status.backgroundCheck.cleared?(c(),p(g,{key:1},[To,h("div",null,"Cleared on "+b(e.person.status.backgroundCheck.cleared),1)],64)):e.person.status.backgroundCheck.needed?(c(),p(g,{key:2},[Uo,$o],64)):f("",!0)],64)),e.person.status.identification.length?(c(),p(g,{key:8},[Mo,h("div",Ho,[(c(!0),p(g,null,N(e.person.status.identification,(e=>(c(),p("div",{textContent:b(e)},null,8,["textContent"])))),256))])],64)):f("",!0)]),e.person.canEdit?(c(),p(s,{key:0,ref:"editStatusModal",pid:e.person.id},null,8,["pid"])):f("",!0),e.person.id!==e.me.id||e.person.status.volgistics.id?f("",!0):(c(),p(i,{key:1,ref:"volgisticsRegisterModal",pid:e.person.id},null,8,["pid"]))])),_:1},8,["editable","onEdit"])):f("",!0)};var Bo=o({components:{Modal:n,SubscriptionsForm:q},props:{pid:{type:Number,required:!0}},setup(e){const o=s(null);return{modal:o,onDone:function(e){o.value.close(e)},show:function(){return o.value.show()}}}});Bo.render=function(e,o,n,t,a,r){const l=m("SubscriptionsForm"),s=m("Modal");return c(),p(s,{ref:"modal"},{default:v((()=>[h(l,{inModal:"",pid:e.pid,onDone:e.onDone},null,8,["pid","onDone"])])),_:1},512)};var Do=o({components:{PersonEditSubscriptions:Bo,PersonViewSection:J},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:o}){const n=s(null);return{editSubscriptionsModal:n,onEditSubscriptions:async function(){await n.value.show()&&o("reload")}}}});const Io={id:"person-view-lists-list"},qo={key:0,style:{color:"red"}},zo={key:1,style:{color:"red"}};Do.render=function(e,o,n,t,a,r){const l=m("PersonEditSubscriptions"),s=m("PersonViewSection");return e.person.noEmail||e.person.noText||e.person.lists.length||e.person.canEditLists?(c(),p(s,{key:0,title:"Subscriptions",editable:e.person.canEditLists,onEdit:e.onEditSubscriptions},{default:v((()=>[h("div",Io,[e.person.noEmail?(c(),p("div",qo,"Unsubcribed from all email.")):f("",!0),e.person.noText?(c(),p("div",zo,"Unsubscribed from all text messaging.")):f("",!0),(c(!0),p(g,null,N(e.person.lists,(e=>(c(),p("div",{textContent:b(e)},null,8,["textContent"])))),256))]),e.person.canEditLists?(c(),p(l,{key:0,ref:"editSubscriptionsModal",pid:e.person.id},null,8,["pid"])):f("",!0)])),_:1},8,["editable","onEdit"])):f("",!0)};var Oo=o({components:{MessageBox:D,PersonEditPassword:z,PersonViewContact:ee,PersonViewNames:Ce,PersonViewNotes:Me,PersonViewRoles:Oe,PersonViewSection:J,PersonViewStatus:ro,PersonViewSubscriptions:Do,SButton:V,SSpinner:l},props:{onLoadPerson:{type:Function,required:!0}},setup(e){const o=I(),n=s(null);d.get(`/api/people/${o.params.id}`).then((o=>{n.value=o.data,e.onLoadPerson(n.value)}));const t=s(null);const a=s(null);return{changePasswordModal:t,onChangePassword:function(){t.value.show()},onResetPassword:function(){a.value.show()&&d.post(`/api/people/${o.params.id}/pwreset`)},onReload:async function(){n.value=(await d.get(`/api/people/${o.params.id}`)).data},person:n,resetPasswordModal:a}}});const _o={key:0,id:"person-view-spinner"},Zo={key:1,id:"person-view"},Lo={id:"person-view-grid"},Yo=h("div",{class:"person-view-spacer"},null,-1),Wo={id:"person-view-chpw"},Go=F("Change Password"),jo=F("Reset Password");Oo.render=function(e,o,n,t,a,r){const l=m("SSpinner"),s=m("PersonViewNames"),i=m("PersonViewRoles"),d=m("PersonViewContact"),u=m("PersonViewStatus"),g=m("PersonViewNotes"),C=m("PersonViewSubscriptions"),w=m("SButton"),y=m("PersonViewSection"),k=m("PersonEditPassword"),S=m("MessageBox");return e.person?(c(),p("div",Zo,[h("div",Lo,[h(s,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),Yo,h(i,{person:e.person,onReload:e.onReload,style:{"grid-row":"2/3"}},null,8,["person","onReload"]),h(d,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),h(u,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),h(g,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),h(C,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),e.person.canChangePassword||e.person.canResetPassword?(c(),p(y,{key:0,title:"Password",editable:!1},{default:v((()=>[h("div",Wo,[e.person.canChangePassword?(c(),p(w,{key:0,variant:"primary",small:"",onClick:e.onChangePassword},{default:v((()=>[Go])),_:1},8,["onClick"])):f("",!0),e.person.canResetPassword?(c(),p(w,{key:1,variant:"primary",small:"",onClick:e.onResetPassword},{default:v((()=>[jo])),_:1},8,["onClick"])):f("",!0)])])),_:1})):f("",!0)]),e.person.canChangePassword?(c(),p(k,{key:0,ref:"changePasswordModal",pid:e.person.id},null,8,["pid"])):f("",!0),h(S,{ref:"resetPasswordModal",title:"Reset Password",variant:"warning",okLabel:"Reset Password"},{default:v((()=>[F("This will replace "+b(e.person.informalName)+"âs current password with a new, randomly generated one, and send it to them by email. You should do this only if they have explicitly asked you to. Are you sure you want to reset "+b(e.person.informalName)+"âs password?",1)])),_:1},512)])):(c(),p("div",_o,[h(l)]))};export default Oo;
