let e=document.createElement("style");e.innerHTML="#event-edit-spinner{margin:1.5rem .75rem}",document.head.appendChild(e);import{d as a,h as n,s as t,l,m as r,n as u,p as o,M as s,N as v,e as d,f as i,_ as p,C as m,u as c,v as h,J as y,x as g,O as f,r as S,c as b,a as V,y as w,w as E,o as F,F as D,z as T,b as U}from"./index.9d4b30ca.js";import{s as W}from"./page.010f3c62.js";const A={admin:"Admin","cert-d":"CERT Deployment","cert-t":"CERT Training",listos:"Listos",sares:"SARES",snap:"SNAP"};var L=a({components:{MessageBox:n,SButton:t,SForm:l,SFCheckGroup:r,SFInput:u,SFSelect:o,SFTextArea:s,SFTimeRange:v,SSpinner:d},props:{onLoadEvent:{type:Function,required:!0}},setup(e){const a=h(),n=g();W({title:"Events"});const t=i(null),l=i([]),r=i([]),u=i([]),o=i([]);p.get(`/api/events/${a.params.id}?edit=1`).then((n=>{t.value=n.data.event,l.value=n.data.roles,r.value=n.data.venues,r.value.unshift({id:0,name:"TBD"}),r.value.push({id:-1,name:"(create a new venue)"}),u.value=n.data.types,t.value.type||u.value.unshift("(select type)"),o.value=n.data.orgs.map((e=>({value:e,label:A[e]}))),t.value.org||o.value.unshift({value:"",label:"(select organization)"}),"NEW"===a.params.id?W({title:"New Event"}):W({title:`${t.value.date} ${t.value.name}`,browserTitle:t.value.date}),e.onLoadEvent(t.value)}));const s=i(null);const v=i(null);m((()=>t.value?.venue.id),(()=>{t.value&&-1===t.value.venue.id&&(t.value.venue.name=t.value.venue.address="",t.value.venue.city=t.value.venue.url="",f((()=>{v.value.focus()})))}));const d=c({get:()=>{const e=new Set;return t.value.renewsDSW&&e.add("renewsDSW"),t.value.coveredByDSW&&e.add("coveredByDSW"),e},set:e=>{t.value.renewsDSW=e.has("renewsDSW"),t.value.coveredByDSW=e.has("coveredByDSW")}}),S=c((()=>l.value.filter((e=>e.org===t.value.org)))),b=c({get:()=>new Set(t.value.roles),set:e=>{t.value.roles=Array.from(e.values())}});i(!1);const V=i(null);return{event:t,nameError:function(e){return e&&t.value?t.value.name?s.value&&s.value.date===t.value.date&&s.value.name===t.value.name?"Another event on this date has this name.":"":"The event name is required.":""},types:u,typeError:function(e){return e&&t.value?t.value.type&&"(select type)"!==t.value.type?"":"The event type is required.":""},orgs:o,orgError:function(e){return e&&t.value?t.value.org&&"(select organization)"!==t.value.org?"":"The organization is required.":""},dateError:function(e){return e&&t.value?t.value.date?t.value.date.match(/^20\d\d-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/)?"":"This is not a valid date.":"The event date is required.":""},allVenues:r,venueName:v,venueNameError:function(e){return e&&t.value&&-1===t.value.venue.id?t.value.venue.name?"":"The venue name is required.":""},venueAddressError:function(e){return e&&t.value&&-1===t.value.venue.id?t.value.venue.address?"":"The venue address is required.":""},venueCityError:function(e){return e&&t.value&&-1===t.value.venue.id?t.value.venue.city?"":"The venue city is required.":""},venueURLError:function(e){return e&&t.value&&-1===t.value.venue.id&&t.value.venue.url&&!t.value.venue.url.startsWith("https://www.google.com/maps/")?"The venue map URL must start with https://www.google.com/maps/.":""},flags:d,flagOptions:[{value:"renewsDSW",label:"Attendance renews DSW registration"},{value:"coveredByDSW",label:"Event is covered by DSW insurance"}],filteredRoles:S,roles:b,onSubmit:async function(){if(!t.value)return;const e=new FormData;e.append("name",t.value.name),e.append("type",t.value.type),e.append("org",t.value.org),e.append("date",t.value.date),e.append("start",t.value.start),e.append("end",t.value.end),-1===t.value.venue.id?(e.append("venue","NEW"),e.append("venueName",t.value.venue.name),e.append("venueAddress",t.value.venue.address),e.append("venueCity",t.value.venue.city),e.append("venueURL",t.value.venue.url)):e.append("venue",t.value.venue.id.toString()),e.append("renewsDSW",t.value.renewsDSW.toString()),e.append("coveredByDSW",t.value.coveredByDSW.toString()),e.append("details",t.value.details),t.value.roles.forEach((a=>{e.append("role",a.toString())}));const l=(await p.post("/api/events/"+a.params.id,e)).data;l.nameError?s.value={name:t.value.name,date:t.value.date}:(y.set("serv-events-month",t.value.date.substr(0,7)),n.push("/events/"+l.id))},onDelete:async function(){if(V.value){if(await V.value.show()){const e=new FormData;e.append("delete","true"),await p.post("/api/events/"+a.params.id,e),n.push({path:"/events",params:{year:t.value.date.substr(0,4)}})}}},deleteModal:V}}});const B={key:0,id:"event-edit-spinner"},C=U("Delete Event"),R=U("Are you sure you want to delete this event? All associated data, including attendance records, will be permanently lost.");L.render=function(e,a,n,t,l,r){const u=S("SSpinner"),o=S("SFInput"),s=S("SFSelect"),v=S("SFTimeRange"),d=S("SFTextArea"),i=S("SFCheckGroup"),p=S("SButton"),m=S("MessageBox"),c=S("SForm");return e.event?(F(),b(c,{key:1,onSubmit:e.onSubmit,submitLabel:"Save Event",onCancel:a[15]||(a[15]=()=>{})},w({default:E((()=>[V(o,{id:"event-name",label:"Event name",autofocus:"",trim:"",modelValue:e.event.name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.event.name=a),errorFn:e.nameError},null,8,["modelValue","errorFn"]),V(s,{id:"event-type",label:"Event type",options:e.types,modelValue:e.event.type,"onUpdate:modelValue":a[2]||(a[2]=a=>e.event.type=a),errorFn:e.typeError},null,8,["options","modelValue","errorFn"]),V(s,{id:"event-type",label:"Organization",options:e.orgs,modelValue:e.event.org,"onUpdate:modelValue":a[3]||(a[3]=a=>e.event.org=a),errorFn:e.orgError},null,8,["options","modelValue","errorFn"]),V(o,{id:"event-date",label:"Event date",type:"date",modelValue:e.event.date,"onUpdate:modelValue":a[4]||(a[4]=a=>e.event.date=a),errorFn:e.dateError},null,8,["modelValue","errorFn"]),V(v,{id:"event-times",label:"Event time",start:e.event.start,"onUpdate:start":a[5]||(a[5]=a=>e.event.start=a),end:e.event.end,"onUpdate:end":a[6]||(a[6]=a=>e.event.end=a)},null,8,["start","end"]),V(s,{id:"event-venue",label:"Location",options:e.allVenues,valueKey:"id",labelKey:"name",modelValue:e.event.venue.id,"onUpdate:modelValue":a[7]||(a[7]=a=>e.event.venue.id=a)},null,8,["options","modelValue"]),-1===e.event.venue.id?(F(),b(D,{key:0},[V(o,{id:"venue-name",label:"Venue name",ref:"venueName",trim:"",modelValue:e.event.venue.name,"onUpdate:modelValue":a[8]||(a[8]=a=>e.event.venue.name=a),errorFn:e.venueNameError},null,8,["modelValue","errorFn"]),V(o,{id:"venue-address",label:"Address",trim:"",modelValue:e.event.venue.address,"onUpdate:modelValue":a[9]||(a[9]=a=>e.event.venue.address=a),errorFn:e.venueAddressError},null,8,["modelValue","errorFn"]),V(o,{id:"venue-city",label:"City",trim:"",modelValue:e.event.venue.city,"onUpdate:modelValue":a[10]||(a[10]=a=>e.event.venue.city=a),errorFn:e.venueCityError},null,8,["modelValue","errorFn"]),V(o,{id:"venue-url",label:"Map URL",trim:"",modelValue:e.event.venue.url,"onUpdate:modelValue":a[11]||(a[11]=a=>e.event.venue.url=a),errorFn:e.venueURLError,help:"Generate this by opening Google Maps and searching for the venue. (Search by the venue’s name rather than its address, if it has a name, so that Google’s sidebar of information about the venue appears.)  Once the venue is found, zoom out a few steps until the nearest freeways are shown — enough to give the viewer an idea of where in the Bay Area the venue is.  Copy the URL from the browser address bar and paste it here."},null,8,["modelValue","errorFn"])],64)):T("",!0),V(d,{id:"event-details",label:"Details",trim:"",rows:"3",wrap:"soft",modelValue:e.event.details,"onUpdate:modelValue":a[12]||(a[12]=a=>e.event.details=a),help:"This may contain HTML <a> tags for links, but no other tags."},null,8,["modelValue"]),V(i,{id:"event-flags",label:"Flags",options:e.flagOptions,modelValue:e.flags,"onUpdate:modelValue":a[13]||(a[13]=a=>e.flags=a)},null,8,["options","modelValue"]),V(i,{id:"event-roles",label:"Invited roles",options:e.filteredRoles,valueKey:"id",labelKey:"name",modelValue:e.roles,"onUpdate:modelValue":a[14]||(a[14]=a=>e.roles=a)},null,8,["options","modelValue"]),V(m,{ref:"deleteModal",title:"Delete Event",cancelLabel:"Keep",okLabel:"Delete",variant:"danger"},{default:E((()=>[R])),_:1},512)])),_:2},[e.event.id?{name:"extraButtons",fn:E((()=>[V(p,{onClick:e.onDelete,variant:"danger"},{default:E((()=>[C])),_:1},8,["onClick"])]))}:void 0]),1032,["onSubmit"])):(F(),b("div",B,[V(u)]))};export default L;
