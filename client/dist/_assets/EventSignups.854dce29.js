import{d as e,f as s,_ as n,n as a,i,I as t,e as d,C as u,J as l,R as p,S as o,K as v}from"./index.e22fb534.js";import{s as c}from"./page.91a2df42.js";const r=e({name:"EventSignups",setup(){const e=a(),p=s(),v=i("me");async function r(s){s.preventDefault();const a=new FormData;p.value.events.forEach((e=>{e.shifts.forEach((s=>{a.append(`${e.id}.${s.start}.${s.task}`,e.declined?"declined":s.signedUp.toString())}))})),await n.post("/api/events/signups"+(e.params.id?`/${e.params.id}`:""),a),p.value.saved=!0}return c({title:"Event Signups"}),async function(){p.value=(await n.get("/api/events/signups"+(e.params.id?`/${e.params.id}`:""))).data,p.value.loggedIn=!!v.value,p.value.events.forEach((e=>{e.shifts.find((e=>e.signedUp))||(e.declined=!0),e.shifts.forEach((e=>{e.baseCount=e.signedUp?e.count-1:e.count,e.expanded=!1}))}))}(),function(){return p.value?p.value.events.length?t("form",{id:"events-signup",onSubmit:r},[p.value.events.map((e=>function(e,s){function n(n){n&&(e.saved=!1,s.declined=!0,s.shifts.forEach((e=>{e.signedUp=!1})))}return[t("div",{class:"events-signup-date"},u(s.date,"YYYY-MM-DD").format("dddd, MMMM D, YYYY")),t("div",{class:"events-signup-event"},s.name),s.signupText?t("div",{class:"events-signup-text",innerHTML:s.signupText}):null,t("div",{class:"events-signup-shifts"},[s.shifts.map((n=>function(e,s,n){function a(a){e.saved=!1,n.signedUp=a,a?(s.declined=!1,s.shifts.forEach((e=>{n!==e&&n.start<e.end&&n.end>e.start&&(e.signedUp=!1)}))):s.shifts.find((e=>e.signedUp))||(s.declined=!0)}return[t(l,{id:`${s.id}.${n.start}.${n.task}`,class:"events-signup-check",label:`${n.start}â€“${n.end} ${n.task}`,modelValue:n.signedUp,disabled:!n.signedUp&&n.max>0&&n.count>=n.max,"onUpdate:modelValue":a}),g(s,n),n.expanded?m(e,s,n):null]}(e,s,n))),t(l,{id:`${s.id}.declined`,label:"Decline",modelValue:s.declined,disabled:s.declined,"onUpdate:modelValue":n})])]}(p.value,e))),t("div",{id:"events-signup-buttons"},[t(o,{variant:"primary",type:"submit"},(()=>"Save")),p.value.saved?t("div",{id:"events-signup-saved"},"Saved."):null])]):t("div",{id:"events-signup"},"There are no upcoming events for which you can sign up."):t(d,{id:"events-signup"})}}});function g(e,s){function n(){s.expanded=!s.expanded}const a=s.signedUp?s.baseCount+1:s.baseCount;if(a<=10&&s.min<=10){const e=[];for(let s=0;s<a;s++)e.push(t(v,{class:"events-signup-signedup",icon:"user"}));for(let n=a;n<s.min;n++)e.push(t(v,{class:"events-signup-needed",icon:"user-outline"}));if(0!==s.max&&s.max<=10)for(let n=Math.max(a,s.min);n<s.max;n++)e.push(t(v,{class:"events-signup-allowed",icon:"user-outline"}));else 0!==s.max?e.push(t("span",{class:"events-signup-max"},`(${s.max} allowed)`)):e.push(t("span",{class:"events-signup-max"},"(no maximum)"));return t("div",{class:"events-signup-status",onClick:n},e)}return a>=s.min?s.max>0?t("div",{class:"events-signup-status",onClick:n},`${a} signed up, ${s.max} allowed`):t("div",{class:"events-signup-status",onClick:n},`${a} signed up (no maximum)`):t("div",{class:"events-signup-status",onClick:n},`${a} signed up, need ${s.min}`)}function m(e,s,n){return t("div",{class:"events-signup-list"},[n.list.map((s=>t("div",e.loggedIn?t(p,{to:`/api/person/${s.id}`},s.sortName):t("span",s.sortName)))),n.signedUp?t("div",e.loggedIn?t(p,{to:`/api/person/${e.id}`},e.sortName):t("span",e.sortName)):null])}export default r;
