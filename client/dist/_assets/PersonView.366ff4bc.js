let e=document.createElement("style");e.innerHTML=".person-address-label-Mail,.person-address-label-Work{padding-top:0}.person-address-same-box{white-space:nowrap}.person-address-same-label{margin:0 0 0 .5rem}.person-address-input{display:block;width:100%;margin-top:.5rem}.person-address-input:first-child{margin-top:0}#person-emContact{margin:0 .75rem;border-top:1px solid #ccc;padding-top:.25rem}.person-view-section{margin-bottom:1.5rem}.person-view-section-header{display:flex;align-items:center;justify-content:space-between;background-color:#eee}.person-view-section-header-text{color:#000;font-size:1.25rem;padding-left:.75rem}.person-view-section-edit{flex:none;padding-left:.25rem;background-color:#fff}#person-view-emContacts,#person-view-emails{margin-top:.75rem}.person-view-email-label{color:#888}.person-view-phone{font-variant:tabular-nums}.person-view-phone-label{margin-left:.25rem;color:#888}.person-view-address,.person-view-clearances{margin-top:.75rem;line-height:1.2}.person-view-map{margin-left:1rem}.person-view-map::before{content:'['}.person-view-map::after{content:']'}.person-view-address-flag{color:#888;font-size:.875rem}#person-view-names{display:flex;justify-content:space-between;align-items:flex-start}#person-view-names-ifc{margin-bottom:1.5rem}#person-view-names-ic{font-size:1.25rem;line-height:1.2;color:#000}#person-view-names-i{display:inline;font-weight:700}#person-view-names-c{display:inline;margin-left:.5rem}#person-view-names-f{color:#888;line-height:1}#person-view-names-edit{margin-left:.5rem}#person-edit-note-help{margin:0 .75rem 1rem}.person-edit-note{display:grid;grid:auto-flow/-webkit-min-content 1fr;grid:auto-flow/min-content 1fr;margin:0 .75rem 1rem;-moz-column-gap:1rem;column-gap:1rem}#person-view-notes{margin-top:.75rem}.person-view-note{line-height:1.2;margin-left:2rem;text-indent:-2rem}.person-view-note-date{display:inline;margin-right:.75rem;color:#666;font-variant:tabular-nums}.person-view-note-text{display:inline;margin-left:.5rem}#person-view-roles-badges{display:grid;grid:auto-flow/-webkit-min-content 1fr;grid:auto-flow/min-content 1fr;min-width:0}.person-view-roles-badge{margin-top:1rem}.person-view-roles-titles{margin-top:1rem;line-height:1.2;min-width:0}.person-view-roles-title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#person-edbg-header{margin:0 .75rem;border-top:1px solid #ccc;padding-top:.25rem}#person-edbg-help{margin:0 .75rem;color:#6c757d;font-size:80%}#person-view-status-grid{margin-top:.75rem;display:grid;grid:auto-flow/1fr}#person-view-status-grid>div:nth-child(2n+1),#person-view-status-identification div{white-space:nowrap}#person-view-status-grid>div:nth-child(2n){margin-left:2rem}@media (min-width:400px){#person-view-status-grid{grid:auto-flow/-webkit-min-content 1fr;grid:auto-flow/min-content 1fr}#person-view-status-grid>div:nth-child(2n){margin-left:1rem}}#person-view-status-identification{display:flex;flex-wrap:wrap}#person-view-status-identification div::after{content:', '}#person-view-status-identification div:last-child::after{content:''}.person-view-status-date{font-variant-numeric:tabular-nums}.person-view-status-assumed{color:#f60}#person-view-lists-list{margin-top:.75rem;line-height:1.2;margin-left:2em;text-indent:-2em}#person-view{margin:1.5rem .75rem}#person-view-grid{display:grid;grid:auto-flow/1fr}.person-view-spacer{display:none}@media (min-width:740px){#person-view-status-grid{grid:auto-flow/1fr}#person-view-status-grid>div:nth-child(2n){margin-left:2rem}#person-view-grid{grid:auto-flow/1fr 1fr;-moz-column-gap:.75rem;column-gap:.75rem}.person-view-spacer{display:block}}@media (min-width:1048px){#person-view-grid{grid:auto-flow/1fr 1fr 1fr}.person-view-spacer{grid-column:span 2}}#person-view-chpw{display:grid;grid:auto/auto auto;-moz-column-gap:.5rem;column-gap:.5rem;margin-top:.75rem}",document.head.appendChild(e);import{d as n,q as o,j as t,k as a,$ as s,e as l,f as r,i,_ as d,O as u,r as p,c,o as m,w as v,a as h,F as f,h as g,a2 as w,z as C,a3 as y,t as b,G as k,a4 as S,a5 as E,y as P,S as V,a6 as A,b as x,m as R,C as F,g as N,x as T,a7 as $,T as M,I as B,v as D,A as U,s as H,n as _}from"./index.52a65a54.js";import{s as I}from"./SubscriptionsForm.3d489fa2.js";var q=n({components:{Modal:o,SForm:t,SFInput:a,SFPassword:s,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const n=i("me"),o=r(null);const t=r([]),a=r(!0);const s=r(""),l=r(null),p=r(""),c=r(null),m=r("");const v=r(!1);return{hints:t,loading:a,me:n,modal:o,oldPassword:s,oldPasswordError:function(e,o){return o?!p.value||s.value||n.value.webmaster?s.value&&s.value===m.value?"This is not the correct old password.":"":"You must supply your old password in order to change your password.":""},oldPasswordRef:l,onCancel:function(){o.value.close(!1)},onSubmit:async function(){var n=new FormData;n.append("oldPassword",s.value),n.append("password",p.value),v.value=!0;try{await d.post(`/api/people/${e.pid}/password`,n),o.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;m.value=s.value}finally{v.value=!1}},password:p,passwordRef:c,show:function(){return s.value=p.value="",async function(){a.value=!0,t.value=(await d.get(`/api/people/${e.pid}/password`)).data,a.value=!1,u((()=>{n.value.webmaster?c.value.focus():l.value.focus()}))}(),o.value.show()},submitting:v}}});q.render=function(e,n,o,t,a,s){const l=p("SSpinner"),r=p("SFInput"),i=p("SFPassword"),d=p("SForm"),u=p("Modal");return m(),c(u,{ref:"modal"},{default:v((()=>[h(d,{dialog:"",variant:"primary",title:"Change Password",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.loading?(m(),c(l,{key:0})):(m(),c(f,{key:1},[e.me.webmaster?g("",!0):(m(),c(r,{key:0,id:"person-oldPassword",ref:"oldPasswordRef",type:"password",label:"Old Password",modelValue:e.oldPassword,"onUpdate:modelValue":n[1]||(n[1]=n=>e.oldPassword=n),errorFn:e.oldPasswordError},null,8,["modelValue","errorFn"])),h(i,{id:"person-password",ref:"passwordRef",label:"New Password",modelValue:e.password,"onUpdate:modelValue":n[2]||(n[2]=n=>e.password=n),allowBadPassword:e.me.webmaster,passwordHints:e.hints},null,8,["modelValue","allowBadPassword","passwordHints"])],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var z=n({props:{type:String,modelValue:{type:Object,required:!0},hasHome:{type:Boolean,default:!1},help:String},emits:["update:modelValue"],setup(e,{emit:n}){var o;const{modelValue:t}=w(e),a=r(""),s=r(""),l=r(!1);let d="",p=0,c=0;(null==(o=e.modelValue)?void 0:o.address)&&(d=e.modelValue.address,a.value=e.modelValue.address.split(",")[0],s.value=e.modelValue.address.replace(/^[^,]*, */,""),p=e.modelValue.latitude||0,c=e.modelValue.longitude||0),e.modelValue?l.value=e.modelValue.sameAsHome||!1:l.value="Mail"===e.type,C(a,(()=>{""===a.value?s.value="":""===s.value&&(s.value="Sunnyvale, CA")}));const m=r(null);C(l,(()=>{a.value=s.value="",n("update:modelValue",{address:"",latitude:0,longitude:0,sameAsHome:l.value}),l.value||u((()=>{var e;null==(e=m.value)||e.focus()}))}));const v=r(null);const h=r(""),f=i("setValidity");C(h,(()=>{null==f||f(`person-address-${e.type}`,!h.value)}));const{submitted:g}=y();async function b(){if(!a.value&&!s.value)return void n("update:modelValue",{address:"",latitude:0,longitude:0,sameAsHome:l.value});let e=`${a.value}, ${s.value}`;if(e.match(/\W[A-Za-z][A-Za-z]\W/)||(e+=", CA"),e===d)return;const o={address:{regionCode:"US",addressLines:[e]}},t=await fetch("https://addressvalidation.googleapis.com/v1:validateAddress?key=AIzaSyCgi3GzjWG35S89-tnkxHgi5TJVD2eUe2o",{method:"POST",body:JSON.stringify(o)});if(!t||!t.ok)return void(h.value="The address could not be verified because the address verification service is not available.");const r=(await t.json()).result;if("SUB_PREMISE"!==r.verdict.validationGranularity&&"PREMISE"!==r.verdict.validationGranularity)d=e,h.value="We couldn't locate this address.  Please provide a valid address.";else{let e=r.address.formattedAddress;a.value=e.split(",")[0],s.value=e.replace(/^[^,]*, */,""),s.value=s.value.replace(/-[0-8]{4}/,""),s.value=s.value.replace(", USA",""),d=a.value+", "+s.value,p=c=0,r.geocode&&r.geocode.location&&(p=r.geocode.location.latitude,c=r.geocode.location.longitude),n("update:modelValue",{address:d,latitude:p,longitude:c})}}C(g,b);const k="Home"===e.type?"Home Address":"Work"===e.type?"Business Hours Address":"Mailing Address";return{error:h,label:k,line1:a,line1input:m,line2:s,line2input:v,onFocusLine2:function(){var e;null==(e=v.value)||e.select()},onBlur:function(e){e.relatedTarget!==m.value&&e.relatedTarget!==v.value&&b()},sameAsHome:l}}});const O={class:"form-item-input"},L={key:0,class:"person-address-same-box"},W={class:"form-item-help person-address-helpbox"};z.render=function(e,n,o,t,a,s){return m(),c(f,null,[h("label",{class:["form-item-label",`person-address-label-${e.type}`],textContent:b(e.label)},null,10,["textContent"]),h("div",O,["Home"!==e.type?(m(),c("div",L,[k(h("input",{class:"person-address-same",id:`person-address-${e.type}-same`,type:"checkbox",autocomplete:"off","onUpdate:modelValue":n[1]||(n[1]=n=>e.sameAsHome=n),disabled:!e.hasHome},null,8,["id","disabled"]),[[S,e.sameAsHome]]),h("label",{class:"person-address-same-label",for:`person-address-${e.type}-same`},"Same as home address",8,["for"])])):g("",!0),e.sameAsHome?g("",!0):k((m(),c("input",{key:1,class:["form-control person-address-input",{"form-control-invalid":e.error}],ref:"line1input",id:`person-address-${e.type}`,"onUpdate:modelValue":n[2]||(n[2]=n=>e.line1=n),onBlur:n[3]||(n[3]=(...n)=>e.onBlur&&e.onBlur(...n))},null,42,["id"])),[[E,e.line1]]),e.sameAsHome?g("",!0):k((m(),c("input",{key:2,class:["form-control person-address-input",{"form-control-invalid":e.error}],ref:"line2input","onUpdate:modelValue":n[4]||(n[4]=n=>e.line2=n),onFocus:n[5]||(n[5]=(...n)=>e.onFocusLine2&&e.onFocusLine2(...n)),onBlur:n[6]||(n[6]=(...n)=>e.onBlur&&e.onBlur(...n))},null,34)),[[E,e.line2]])]),h("div",W,[e.help?(m(),c("div",{key:0,class:"form-item-help-text",textContent:b(e.help)},null,8,["textContent"])):g("",!0),e.error?(m(),c("div",{key:1,class:"form-item-error-text",textContent:b(e.error)},null,8,["textContent"])):g("",!0)])],64)};var Y=n({components:{Modal:o,PersonEditAddress:z,SForm:t,SFInput:a,SFSelect:P,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const n=r(null);const o=r({}),t=r(!0);const a=r("");const s=r("");const l=r(!1);return{loading:t,modal:n,onCancel:function(){n.value.close(!1)},onSubmit:async function(){var t=new FormData;t.append("email",o.value.email),t.append("email2",o.value.email2),t.append("cellPhone",o.value.cellPhone),t.append("homePhone",o.value.homePhone),t.append("workPhone",o.value.workPhone),o.value.homeAddress.address&&(t.append("homeAddress",o.value.homeAddress.address),t.append("homeAddressLatitude",(o.value.homeAddress.latitude||0).toString()),t.append("homeAddressLongitude",(o.value.homeAddress.longitude||0).toString())),o.value.workAddress.address?(t.append("workAddress",o.value.workAddress.address),t.append("workAddressLatitude",(o.value.workAddress.latitude||0).toString()),t.append("workAddressLongitude",(o.value.workAddress.longitude||0).toString())):t.append("workAddressSameAsHome",o.value.workAddress.sameAsHome.toString()),o.value.mailAddress.address?t.append("mailAddress",o.value.mailAddress.address):t.append("mailAddressSameAsHome",o.value.mailAddress.sameAsHome.toString()),o.value.canEditEmContacts&&(t.append("emContact1Name",o.value.emContacts[0].name),t.append("emContact1HomePhone",o.value.emContacts[0].homePhone),t.append("emContact1CellPhone",o.value.emContacts[0].cellPhone),t.append("emContact1Relationship",o.value.emContacts[0].relationship),t.append("emContact2Name",o.value.emContacts[1].name),t.append("emContact2HomePhone",o.value.emContacts[1].homePhone),t.append("emContact2CellPhone",o.value.emContacts[1].cellPhone),t.append("emContact2Relationship",o.value.emContacts[1].relationship)),l.value=!0;try{await d.post(`/api/people/${e.pid}/contact`,t),n.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;switch(e.response.data){case"email":a.value=o.value.email;break;case"cellPhone":s.value=o.value.cellPhone}}finally{l.value=!1}},person:o,show:function(){return async function(){if(t.value=!0,o.value=(await d.get(`/api/people/${e.pid}/contact`)).data,o.value.canEditEmContacts)for(;o.value.emContacts.length<2;)o.value.emContacts.push({name:"",homePhone:"",cellPhone:"",relationship:""});t.value=!1}(),n.value.show()},submitting:l,emailError:function(e){var n;return e&&(null==(n=o.value)?void 0:n.email)?o.value.email.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)?a.value===o.value.email?"Another user has this email address.":"":"This is not a valid email address.":""},email2Error:function(e){var n;return e&&(null==(n=o.value)?void 0:n.email2)?o.value.email2.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)?o.value.email===o.value.email2?"The two email addresses should not be the same.  (Leave this field empty if you only have one.)":"":"This is not a valid email address.":""},cellPhoneError:function(e){var n;return(null==(n=o.value)?void 0:n.cellPhone)?e&&10!==o.value.cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":s.value===o.value.cellPhone?"A different person has this cell phone number.":"":""},homePhoneError:function(e){var n;return e&&(null==(n=o.value)?void 0:n.homePhone)&&10!==o.value.homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},workPhoneError:function(e){var n;return e&&(null==(n=o.value)?void 0:n.workPhone)&&10!==o.value.workPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},emContact1HomePhoneError:function(e,n){var t,a;return e?n&&o.value.emContacts[0].name&&!o.value.emContacts[0].homePhone&&!o.value.emContacts[0].cellPhone?"The emergency contact must have at least one phone number.":(null==(t=o.value)?void 0:t.emContacts)&&(null==(a=o.value)?void 0:a.emContacts[0].homePhone)&&10!==o.value.emContacts[0].homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":"":""},emContact1CellPhoneError:function(e,n){var t;return e&&(null==(t=o.value)?void 0:t.emContacts[0].cellPhone)&&10!==o.value.emContacts[0].cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},emContact1RelationshipError:function(e,n){return e&&n&&o.value.emContacts[0].name&&!o.value.emContacts[0].relationship?"The relationship is required.":""},emContact2HomePhoneError:function(e,n){var t,a;return e?n&&o.value.emContacts[1].name&&!o.value.emContacts[1].homePhone&&!o.value.emContacts[1].cellPhone?"The emergency contact must have at least one phone number.":(null==(t=o.value)?void 0:t.emContacts)&&(null==(a=o.value)?void 0:a.emContacts[1].homePhone)&&10!==o.value.emContacts[1].homePhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":"":""},emContact2CellPhoneError:function(e,n){var t;return e&&(null==(t=o.value)?void 0:t.emContacts[1].cellPhone)&&10!==o.value.emContacts[1].cellPhone.replace(/[^0-9]/g,"").length?"A valid phone number must have 10 digits.":""},emContact2RelationshipError:function(e,n){return e&&n&&o.value.emContacts[1].name&&!o.value.emContacts[1].relationship?"The relationship is required.":""}}}});const G=h("div",{class:"form-item person-emContact"},"Emergency Contact 1",-1),Z=h("div",{class:"form-item person-emContact"},"Emergency Contact 2",-1);Y.render=function(e,n,o,t,a,s){const l=p("SSpinner"),r=p("SFInput"),i=p("PersonEditAddress"),d=p("SFSelect"),u=p("SForm"),w=p("Modal");return m(),c(w,{ref:"modal"},{default:v((()=>[h(u,{dialog:"",variant:"primary",title:"Edit Contact Information",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.loading?(m(),c(l,{key:0})):(m(),c(f,{key:1},[h(r,{id:"person-email",label:"Email",help:"This is the email address you log in with.",trim:"",autofocus:"",modelValue:e.person.email,"onUpdate:modelValue":n[1]||(n[1]=n=>e.person.email=n),errorFn:e.emailError,style:{"text-transform":"lowercase"}},null,8,["modelValue","errorFn"]),h(r,{id:"person-email2",label:"Alt. Email",trim:"",modelValue:e.person.email2,"onUpdate:modelValue":n[2]||(n[2]=n=>e.person.email2=n),errorFn:e.email2Error,style:{"text-transform":"lowercase"}},null,8,["modelValue","errorFn"]),h(r,{id:"person-cellPhone",label:"Cell Phone",trim:"",modelValue:e.person.cellPhone,"onUpdate:modelValue":n[3]||(n[3]=n=>e.person.cellPhone=n),errorFn:e.cellPhoneError},null,8,["modelValue","errorFn"]),h(r,{id:"person-homePhone",label:"Home Phone",trim:"",modelValue:e.person.homePhone,"onUpdate:modelValue":n[4]||(n[4]=n=>e.person.homePhone=n),errorFn:e.homePhoneError},null,8,["modelValue","errorFn"]),h(r,{id:"person-workPhone",label:"Work Phone",trim:"",modelValue:e.person.workPhone,"onUpdate:modelValue":n[5]||(n[5]=n=>e.person.workPhone=n),errorFn:e.workPhoneError},null,8,["modelValue","errorFn"]),h(i,{type:"Home",modelValue:e.person.homeAddress,"onUpdate:modelValue":n[6]||(n[6]=n=>e.person.homeAddress=n)},null,8,["modelValue"]),h(i,{type:"Work",modelValue:e.person.workAddress,"onUpdate:modelValue":n[7]||(n[7]=n=>e.person.workAddress=n),hasHome:!!e.person.homeAddress.address},null,8,["modelValue","hasHome"]),h(i,{type:"Mail",modelValue:e.person.mailAddress,"onUpdate:modelValue":n[8]||(n[8]=n=>e.person.mailAddress=n),hasHome:!!e.person.homeAddress.address},null,8,["modelValue","hasHome"]),e.person.canEditEmContacts?(m(),c(f,{key:0},[G,h(r,{id:"person-emContact1Name",label:"Name",trim:"",modelValue:e.person.emContacts[0].name,"onUpdate:modelValue":n[9]||(n[9]=n=>e.person.emContacts[0].name=n)},null,8,["modelValue"]),h(r,{id:"person-emContact1HomePhone",label:"Home Phone",trim:"",modelValue:e.person.emContacts[0].homePhone,"onUpdate:modelValue":n[10]||(n[10]=n=>e.person.emContacts[0].homePhone=n),errorFn:e.emContact1HomePhoneError},null,8,["modelValue","errorFn"]),h(r,{id:"person-emContact1CellPhone",label:"Cell Phone",trim:"",modelValue:e.person.emContacts[0].cellPhone,"onUpdate:modelValue":n[11]||(n[11]=n=>e.person.emContacts[0].cellPhone=n),errorFn:e.emContact1CellPhoneError},null,8,["modelValue","errorFn"]),h(d,{id:"person-emContact1Relationship",label:"Relationship",options:e.relationshipOptions,modelValue:e.person.emContacts[0].relationship,"onUpdate:modelValue":n[12]||(n[12]=n=>e.person.emContacts[0].relationship=n),errorFn:e.emContact1RelationshipError},null,8,["options","modelValue","errorFn"]),Z,h(r,{id:"person-emContact2Name",label:"Name",trim:"",modelValue:e.person.emContacts[1].name,"onUpdate:modelValue":n[13]||(n[13]=n=>e.person.emContacts[1].name=n)},null,8,["modelValue"]),h(r,{id:"person-emContact2HomePhone",label:"Home Phone",trim:"",modelValue:e.person.emContacts[1].homePhone,"onUpdate:modelValue":n[14]||(n[14]=n=>e.person.emContacts[1].homePhone=n),errorFn:e.emContact2HomePhoneError},null,8,["modelValue","errorFn"]),h(r,{id:"person-emContact2CellPhone",label:"Cell Phone",trim:"",modelValue:e.person.emContacts[1].cellPhone,"onUpdate:modelValue":n[15]||(n[15]=n=>e.person.emContacts[1].cellPhone=n),errorFn:e.emContact2CellPhoneError},null,8,["modelValue","errorFn"]),h(d,{id:"person-emContact2Relationship",label:"Relationship",options:e.relationshipOptions,modelValue:e.person.emContacts[1].relationship,"onUpdate:modelValue":n[16]||(n[16]=n=>e.person.emContacts[1].relationship=n),errorFn:e.emContact2RelationshipError},null,8,["options","modelValue","errorFn"])],64)):g("",!0)],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var j=n({components:{SButton:V},props:{title:{type:String,required:!0},editable:{type:Boolean,required:!0}},emits:["edit"]});const J={class:"person-view-section-header"},K={key:0,class:"person-view-section-edit"},Q=x("Edit");j.render=function(e,n,o,t,a,s){const l=p("SButton");return m(),c("div",{class:["person-view-section",{"person-view-section-editable":e.editable}]},[h("div",J,[h("div",{class:"person-view-section-header-text",textContent:b(e.title)},null,8,["textContent"]),e.editable?(m(),c("div",K,[h(l,{class:"person-view-section-ebtn",variant:"primary",small:"",onClick:n[1]||(n[1]=n=>e.$emit("edit"))},{default:v((()=>[Q])),_:1})])):g("",!0)]),A(e.$slots,"default")],2)};var X=n({components:{PersonEditContact:Y,PersonViewSection:j},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:n}){const o=R((()=>!!e.person.contact&&(e.person.contact.email||e.person.contact.email2||e.person.contact.cellPhone||e.person.contact.homePhone||e.person.contact.workPhone||e.person.contact.homeAddress||e.person.contact.workAddress||e.person.contact.mailAddress))),t=r(null);return{editContactModal:t,hasContactInfo:o,onEditContact:async function(){await t.value.show()&&n("reload")}}}});const ee={key:0,id:"person-view-emails"},ne={key:0},oe={key:1},te={key:1,class:"person-view-phone"},ae=h("span",{class:"person-view-phone-label"},"(Cell)",-1),se={key:2,class:"person-view-phone"},le=h("span",{class:"person-view-phone-label"},"(Home)",-1),re={key:3,class:"person-view-phone"},ie=h("span",{class:"person-view-phone-label"},"(Work)",-1),de={key:4,class:"person-view-address"},ue={key:0},pe={key:1},ce={key:5,class:"person-view-address"},me=h("span",null,"Work Address:",-1),ve={key:6,class:"person-view-address"},he=h("div",null,"Mailing Address:",-1);X.render=function(e,n,o,t,a,s){const l=p("PersonEditContact"),r=p("PersonViewSection");return e.hasContactInfo||e.person.canEdit?(m(),c(r,{key:0,title:"Contact Information",editable:e.person.canEdit,onEdit:e.onEditContact},{default:v((()=>[e.person.contact.email||e.person.contact.email2?(m(),c("div",ee,[e.person.contact.email?(m(),c("div",ne,[h("a",{href:`mailto:${e.person.contact.email}`,textContent:b(e.person.contact.email)},null,8,["href","textContent"])])):g("",!0),e.person.contact.email2?(m(),c("div",oe,[h("a",{href:`mailto:${e.person.contact.email2}`,textContent:b(e.person.contact.email2)},null,8,["href","textContent"])])):g("",!0)])):g("",!0),e.person.contact.cellPhone?(m(),c("div",te,[h("a",{href:`tel:${e.person.contact.cellPhone}`,textContent:b(e.person.contact.cellPhone)},null,8,["href","textContent"]),ae])):g("",!0),e.person.contact.homePhone?(m(),c("div",se,[h("a",{href:`tel:${e.person.contact.homePhone}`,textContent:b(e.person.contact.homePhone)},null,8,["href","textContent"]),le])):g("",!0),e.person.contact.workPhone?(m(),c("div",re,[h("a",{href:`tel:${e.person.contact.workPhone}`,textContent:b(e.person.contact.workPhone)},null,8,["href","textContent"]),ie])):g("",!0),e.person.contact.homeAddress&&e.person.contact.homeAddress.address?(m(),c("div",de,[h("div",null,[e.person.contact.workAddress&&e.person.contact.workAddress.sameAsHome?(m(),c("span",ue,"Home Address (all day):")):(m(),c("span",pe,"Home Address:")),h("a",{class:"person-view-map",target:"_blank",href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.person.contact.homeAddress.address)}`},"Map",8,["href"])]),h("div",{textContent:b(e.person.contact.homeAddress.address.split(",")[0])},null,8,["textContent"]),h("div",{textContent:b(e.person.contact.homeAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"]),e.person.contact.homeAddress.fireDistrict?(m(),c("div",{key:0,textContent:b(`Sunnyvale Fire District ${e.person.contact.homeAddress.fireDistrict}`)},null,8,["textContent"])):g("",!0)])):g("",!0),e.person.contact.workAddress&&e.person.contact.workAddress.address?(m(),c("div",ce,[h("div",null,[me,h("a",{class:"person-view-map",target:"_blank",href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.person.contact.workAddress.address)}`},"Map",8,["href"])]),h("div",{textContent:b(e.person.contact.workAddress.address.split(",")[0])},null,8,["textContent"]),h("div",{textContent:b(e.person.contact.workAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"]),e.person.contact.workAddress.fireDistrict?(m(),c("div",{key:0,textContent:b(`Sunnyvale Fire District ${e.person.contact.workAddress.fireDistrict}`)},null,8,["textContent"])):g("",!0)])):g("",!0),e.person.contact.mailAddress&&e.person.contact.mailAddress.address?(m(),c("div",ve,[he,h("div",{textContent:b(e.person.contact.mailAddress.address.split(",")[0])},null,8,["textContent"]),h("div",{textContent:b(e.person.contact.mailAddress.address.replace(/^[^,]*, */,""))},null,8,["textContent"])])):g("",!0),e.person.emContacts?(m(),c("div",{key:7,id:"person-view-emContacts",textContent:b(`${e.person.emContacts} emergency contact${e.person.emContacts>1?"s":""} on file`)},null,8,["textContent"])):g("",!0),e.person.canEdit?(m(),c(l,{key:8,ref:"editContactModal",pid:e.person.id},null,8,["pid"])):g("",!0)])),_:1},8,["editable","onEdit"])):g("",!0)};var fe=n({components:{Modal:o,SForm:t,SFInput:a,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const n=r(null);const o=r({}),t=r(!0);const a=r(""),s=r("");function l(e){if(!e)return e;const n=e.split(/\s+/,2);return n.length>1?`${n[1]}, ${n[0]}`:e}C((()=>o.value.informalName),((e,n)=>{o.value.formalName===n&&(o.value.formalName=e),o.value.sortName===l(n)&&(o.value.sortName=l(e))}));const i=r(!1);return{callSignError:function(e){var n;return o.value.callSign?e&&!o.value.callSign.match(/^[AKNW][A-Z]?[0-9][A-Z]{1,3}$/i)?"This is not a valid call sign.":a.value===(null==(n=o.value)?void 0:n.callSign)?"A different person has this call sign.":"":""},formalNameError:function(e){return e?o.value.formalName?"":"A name is required.":""},informalNameError:function(e){return e?o.value.informalName?"":"A name is required.":""},loading:t,modal:n,onCancel:function(){n.value.close(!1)},onSubmit:async function(){var t=new FormData;t.append("informalName",o.value.informalName),t.append("formalName",o.value.formalName),t.append("sortName",o.value.sortName),t.append("callSign",o.value.callSign),i.value=!0;try{await d.post(`/api/people/${e.pid}/names`,t),n.value.close(!0)}catch(e){if(!e.response||409!==e.response.status)throw e;switch(e.response.data){case"sortName":s.value=o.value.sortName;break;case"callSign":a.value=o.value.callSign}}finally{i.value=!1}},person:o,show:function(){return async function(){t.value=!0,o.value=(await d.get(`/api/people/${e.pid}/names`)).data,t.value=!1}(),n.value.show()},sortNameError:function(e){var n;return o.value.sortName?s.value===(null==(n=o.value)?void 0:n.sortName)?"A different person has this name.":"":e?"A name is required.":""},submitting:i}}});fe.render=function(e,n,o,t,a,s){const l=p("SSpinner"),r=p("SFInput"),i=p("SForm"),d=p("Modal");return m(),c(d,{ref:"modal"},{default:v((()=>[h(i,{dialog:"",variant:"primary",title:"Edit Names",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.loading?(m(),c(l,{key:0})):(m(),c(f,{key:1},[h(r,{id:"person-informalName",label:"Name",trim:"",autofocus:"",modelValue:e.person.informalName,"onUpdate:modelValue":n[1]||(n[1]=n=>e.person.informalName=n),errorFn:e.informalNameError,help:"What you like to be called, e.g. “Joe Banks”"},null,8,["modelValue","errorFn"]),h(r,{id:"person-formalName",label:"Formal name",trim:"",modelValue:e.person.formalName,"onUpdate:modelValue":n[2]||(n[2]=n=>e.person.formalName=n),errorFn:e.formalNameError,help:"For formal documents, e.g. “Joseph A. Banks, Jr.”"},null,8,["modelValue","errorFn"]),h(r,{id:"person-sortName",label:"Sort name",trim:"",modelValue:e.person.sortName,"onUpdate:modelValue":n[3]||(n[3]=n=>e.person.sortName=n),errorFn:e.sortNameError,help:"For appearance in sorted lists, e.g. “Banks, Joe”"},null,8,["modelValue","errorFn"]),h(r,{id:"person-callSign",label:"Call sign",trim:"",modelValue:e.person.callSign,"onUpdate:modelValue":n[4]||(n[4]=n=>e.person.callSign=n),errorFn:e.callSignError,help:"FCC amateur radio license",style:{"text-transform":"uppercase"}},null,8,["modelValue","errorFn"])],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var ge=n({components:{PersonEditNames:fe,SButton:V},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:n}){const o=r(null);return{editNamesModal:o,onEditNames:async function(){await o.value.show()&&n("reload")}}}});const we={id:"person-view-names"},Ce={id:"person-view-names-ifc"},ye={id:"person-view-names-ic"},be={key:0,id:"person-view-names-edit"},ke=x("Edit");ge.render=function(e,n,o,t,a,s){const l=p("SButton"),r=p("PersonEditNames");return m(),c("div",we,[h("div",Ce,[h("div",ye,[h("div",{id:"person-view-names-i",textContent:b(e.person.informalName)},null,8,["textContent"]),e.person.callSign?(m(),c("div",{key:0,id:"person-view-names-c",textContent:b(e.person.callSign)},null,8,["textContent"])):g("",!0)]),e.person.formalName!==e.person.informalName?(m(),c("div",{key:0,id:"person-view-names-f",textContent:b(`(${e.person.formalName})`)},null,8,["textContent"])):g("",!0)]),e.person.canEdit?(m(),c("div",be,[h(l,{variant:"primary",small:"",onClick:e.onEditNames},{default:v((()=>[ke])),_:1},8,["onClick"])])):g("",!0),e.person.canEdit?(m(),c(r,{key:1,ref:"editNamesModal",pid:e.person.id},null,8,["pid"])):g("",!0)])};const Se={webmaster:"Webmasters only",admin:"DPS staff only",leader:"SERV leads only",contact:"Anyone who can see contact info",person:"Anyone"};let Ee=[{value:"webmaster",label:"Webmasters only"},{value:"admin",label:"DPS staff only"},{value:"leader",label:"SERV leads only"},{value:"contact",label:"Anyone who can see contact info"},{value:"person",label:"Anyone"}];var Pe=n({components:{Modal:o,SButton:V,SForm:t,SFInput:a,SFSelect:P,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const n=r(null);const o=r([]),t=r([]),a=r({}),s=r(!0);const l=r(null);const i=r(!1);return{editNote:function(e){a.value.date&&a.value.note&&o.value.push(a.value),t.value.forEach((e=>o.value.push(e)));const n=o.value.findIndex((n=>n===e));t.value=o.value.splice(n+1),a.value=o.value.splice(n,1)[0],u((()=>{l.value.focus()}))},loading:s,modal:n,noteEditing:a,noteRef:l,notesAfter:t,notesBefore:o,onAdd:function(){a.value.date&&a.value.note&&o.value.push(a.value),t.value.forEach((e=>o.value.push(e))),t.value=[],a.value={date:F().format("YYYY-MM-DD"),note:"",visibility:Ee[0].value},u((()=>{l.value.focus()}))},onCancel:function(){n.value.close(!1)},onSubmit:async function(){var s=new FormData;o.value.forEach((e=>{s.append("note",e.note),s.append("date",e.date),s.append("visibility",e.visibility)})),a.value.date&&a.value.note&&(s.append("note",a.value.note),s.append("date",a.value.date),s.append("visibility",a.value.visibility)),t.value.forEach((e=>{s.append("note",e.note),s.append("date",e.date),s.append("visibility",e.visibility)})),i.value=!0,await d.post(`/api/people/${e.pid}/notes`,s),i.value=!1,n.value.close(!0)},show:function(){return async function(){s.value=!0;const n=(await d.get(`/api/people/${e.pid}/notes`)).data;o.value=n.notes,o.value.sort(((e,n)=>e.date!==n.date?e.date<n.date?-1:1:e.note.localeCompare(n.note))),t.value=[],Ee=Ee.filter((e=>n.visibilities.includes(e.value))),o.value.length?a.value={date:"",note:"",visibility:""}:a.value={date:F().format("YYYY-MM-DD"),note:"",visibility:Ee[0].value};s.value=!1}(),n.value.show()},submitting:i,visibilityLabels:Se,visibilityOptions:Ee}}});const Ve={key:0,class:"form-item",id:"person-edit-note-help"},Ae=h("div",null,"Date",-1),xe=h("div",null,"Note",-1),Re=h("div",null,"Vis.",-1),Fe=h("div",null,"Date",-1),Ne=h("div",null,"Note",-1),Te=h("div",null,"Vis.",-1),$e=x("Add");Pe.render=function(e,n,o,t,a,s){const l=p("SSpinner"),r=p("SFInput"),i=p("SFSelect"),d=p("SButton"),u=p("SForm"),w=p("Modal");return m(),c(w,{ref:"modal"},{default:v((()=>[h(u,{dialog:"",variant:"primary",title:"Edit Notes",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{extraButtons:v((()=>[h(d,{variant:"primary",onClick:e.onAdd},{default:v((()=>[$e])),_:1},8,["onClick"])])),default:v((()=>[e.loading?(m(),c(l,{key:0})):(m(),c(f,{key:1},[e.notesBefore.length||e.notesAfter.length?(m(),c("div",Ve,"Click on a note to edit it, or click the Add button to add one.")):g("",!0),(m(!0),c(f,null,N(e.notesBefore,(n=>(m(),c("div",{class:"person-edit-note form-item",onClick:o=>e.editNote(n)},[Ae,h("div",{textContent:b(n.date)},null,8,["textContent"]),xe,h("div",{textContent:b(n.note)},null,8,["textContent"]),Re,h("div",{textContent:b(e.visibilityLabels[n.visibility])},null,8,["textContent"])],8,["onClick"])))),256)),e.noteEditing.date?(m(),c(f,{key:1},[h(r,{id:"person-edit-note-date",label:"Date",type:"date",modelValue:e.noteEditing.date,"onUpdate:modelValue":n[1]||(n[1]=n=>e.noteEditing.date=n)},null,8,["modelValue"]),h(r,{id:"person-edit-note-note",ref:"noteRef",label:"Note Text",trim:"",modelValue:e.noteEditing.note,"onUpdate:modelValue":n[2]||(n[2]=n=>e.noteEditing.note=n)},null,8,["modelValue"]),h(i,{id:"person-edit-note-visibility",label:"Visibility",options:e.visibilityOptions,modelValue:e.noteEditing.visibility,"onUpdate:modelValue":n[3]||(n[3]=n=>e.noteEditing.visibility=n)},null,8,["options","modelValue"])],64)):g("",!0),(m(!0),c(f,null,N(e.notesAfter,(n=>(m(),c("div",{class:"person-edit-note form-item",onClick:o=>e.editNote(n)},[Fe,h("div",{textContent:b(n.date)},null,8,["textContent"]),Ne,h("div",{textContent:b(n.note)},null,8,["textContent"]),Te,h("div",{textContent:b(e.visibilityLabels[n.visibility])},null,8,["textContent"])],8,["onClick"])))),256))],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var Me=n({components:{PersonEditNotes:Pe,PersonViewSection:j},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:n}){const o=r(null);return{editNotesModal:o,onEditNotes:async function(){await o.value.show()&&n("reload")}}}});const Be={id:"person-view-notes"},De={class:"person-view-note"},Ue={key:0};Me.render=function(e,n,o,t,a,s){const l=p("PersonEditNotes"),r=p("PersonViewSection");return e.person.notes.length||e.person.canEditNotes?(m(),c(r,{key:0,title:"Notes",editable:e.person.canEditNotes,onEdit:e.onEditNotes},{default:v((()=>[h("div",Be,[(m(!0),c(f,null,N(e.person.notes,(e=>(m(),c("div",De,[h("div",{class:"person-view-note-date",textContent:b(e.date)},null,8,["textContent"]),h("div",{class:"person-view-note-text",textContent:b(e.note)},null,8,["textContent"])])))),256)),e.person.notes.length?g("",!0):(m(),c("div",Ue,"No notes on file."))]),e.person.canEdit?(m(),c(l,{key:0,ref:"editNotesModal",pid:e.person.id},null,8,["pid"])):g("",!0)])),_:1},8,["editable","onEdit"])):g("",!0)};const He={admin:"Admin","cert-d":"CERT Deployment","cert-t":"CERT Training",listos:"Listos",sares:"SARES",snap:"SNAP"};var _e=n({components:{Modal:o,SFCheckGroup:T,SForm:t,SFSelect:P,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const n=r(null);const o=r([]),t=r("");const a=r([]),s=r(new Set);C(t,(()=>{if(!o.value.length)return;const e=o.value.find((e=>e.org===t.value)).roles;s.value=new Set(e.filter((e=>e.held)).map((e=>e.id)))})),C([s,t],((e,n)=>{if(!o.value.length)return;let l=e[1]!=n[1];if(e[0].forEach((e=>{n[0].has(e)||(l=!0)})),n[0].forEach((n=>{e[0].has(n)||(l=!0)})),!l)return;const r=new Set,i=new Set;o.value.forEach((e=>{e.org===t.value?e.roles.filter((e=>(!e.held||e.direct)&&s.value.has(e.id))).forEach((e=>{r.add(e.id),e.implies.forEach((e=>i.add(e)))})):e.roles.filter((e=>e.held&&e.direct)).forEach((e=>{r.add(e.id),e.implies.forEach((e=>i.add(e)))}))})),o.value.forEach((e=>{e.roles.forEach((e=>{r.has(e.id)?e.held=e.direct=!0:i.has(e.id)?(e.held=!0,e.direct=!1):e.held=e.direct=!1}))}));const d=o.value.find((e=>e.org===t.value)).roles;s.value=new Set(d.filter((e=>e.held)).map((e=>e.id))),a.value=d.map((e=>({value:e.id,label:e.name,disabled:e.implicitOnly||e.held&&!e.direct})))}));const l=r(!1);return{modal:n,onCancel:function(){n.value.close(!1)},onSubmit:async function(){var t=new FormData;o.value.forEach((e=>{e.roles.filter((e=>e.held&&e.direct)).forEach((e=>{t.append("role",e.id.toString())}))})),l.value=!0,await d.post(`/api/people/${e.pid}/roles`,t),l.value=!1,n.value.close(!0)},org:t,orgRoleOptions:a,orgRoles:s,orgs:o,show:function(){return async function(){o.value=[],t.value="",o.value=(await d.get(`/api/people/${e.pid}/roles`)).data,o.value.forEach((e=>{e.fmtOrg=He[e.org]})),t.value=o.value[0].org}(),n.value.show()},submitting:l}}});function Ie(e){return"admin"===e.org&&e.title.startsWith("OES")?"dps":"admin"===e.org?"serv":e.org.replace(/-.*/,"")}_e.render=function(e,n,o,t,a,s){const l=p("SSpinner"),r=p("SFSelect"),i=p("SFCheckGroup"),d=p("SForm"),u=p("Modal");return m(),c(u,{ref:"modal"},{default:v((()=>[h(d,{dialog:"",variant:"primary",title:"Edit Roles",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{default:v((()=>[e.orgs.length?(m(),c(f,{key:1},[e.orgs.length>1?(m(),c(r,{key:0,id:"person-roles-org",label:"Org",options:e.orgs,valueKey:"org",labelKey:"fmtOrg",modelValue:e.org,"onUpdate:modelValue":n[1]||(n[1]=n=>e.org=n)},null,8,["options","modelValue"])):g("",!0),h(i,{id:"person-roles-roles",label:e.orgs.length>1?"Roles":"",options:e.orgRoleOptions,disabledKey:"disabled",modelValue:e.orgRoles,"onUpdate:modelValue":n[2]||(n[2]=n=>e.orgRoles=n)},null,8,["label","options","modelValue"])],64)):(m(),c(l,{key:0}))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var qe=n({components:{OrgBadge:$,PersonEditRoles:_e,PersonViewSection:j},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:n}){const o=r([]);M((()=>{o.value=[],e.person.roles.forEach((e=>{const n=o.value.findIndex((n=>n.org===Ie(e)));n<0?o.value.push({org:Ie(e),titles:[e.title]}):o.value[n].titles.push(e.title)}))}));const t=r(null);return{editRolesModal:t,onEditRoles:async function(){await t.value.show()&&n("reload")},badges:o}}});const ze={id:"person-view-roles-badges"},Oe={class:"person-view-roles-titles"},Le={key:0,class:"person-view-roles-title"};qe.render=function(e,n,o,t,a,s){const l=p("OrgBadge"),r=p("PersonEditRoles"),i=p("PersonViewSection");return e.badges.length||e.person.canEditRoles?(m(),c(i,{key:0,title:"SERV "+(1===e.person.roles.length?"Role":"Roles"),editable:e.person.canEditRoles,onEdit:e.onEditRoles},{default:v((()=>[h("div",ze,[(m(!0),c(f,null,N(e.badges,(e=>(m(),c(f,null,[h(l,{class:"person-view-roles-badge",org:e.org},null,8,["org"]),h("div",Oe,[(m(!0),c(f,null,N(e.titles,(e=>(m(),c("div",{class:"person-view-roles-title",textContent:b(e)},null,8,["textContent"])))),256))])],64)))),256)),e.badges.length?g("",!0):(m(),c("div",Le,"No current role in any SERV org."))]),e.person.canEditRoles?(m(),c(r,{key:0,ref:"editRolesModal",pid:e.person.id},null,8,["pid"])):g("",!0)])),_:1},8,["title","editable","onEdit"])):g("",!0)};const We=n({name:"PersonEditBGChecks",props:{checks:{type:Array,required:!0},types:{type:Array,required:!0}},setup(e,{expose:n}){const o=r([...e.checks]),t=r([]),a=r({date:"",types:new Set,assumed:!1}),s=r(0===e.checks.length);function l(){return!s.value||!(a.value.date&&!a.value.date.match(/^20\d\d-\d\d-\d\d$/))&&(a.value.types.size&&o.value.push({date:a.value.date,types:e.types.filter((e=>a.value.types.has(e))),assumed:a.value.assumed}),o.value.splice(o.value.length,0,...t.value.splice(0)),o.value.sort(((e,n)=>e.date.localeCompare(n.date))),s.value=!1,!0)}function i(e){if(!l())return;a.value.date=e.date,a.value.types=new Set(e.types),a.value.assumed=e.assumed;const n=o.value.findIndex((n=>n===e));t.value.splice(t.value.length,0,...o.value.splice(n+1)),o.value.splice(n),s.value=!0}return n({startAdd:function(){console.log("startAdd called"),l()&&(a.value.date=F().format("YYYY-MM-DD"),a.value.types=new Set,a.value.assumed=!1,s.value=!0)},prepareForSave:function(){l(),e.checks.splice(0,e.checks.length,...o.value)}}),function(){return[(n=e.checks,[B("div",{id:"person-edbg-header",class:"form-item"},"Background Checks"),n.length?B("div",{id:"person-edbg-help",class:"form-item"},"Click on a check to edit it, or click Add to add one."):null]),Ye(o.value,i),s.value?Ge(a.value,e.types):null,Ye(t.value,i)];var n}}});function Ye(e,n){return e.map((e=>B("div",{class:"form-item-input",onClick:()=>{n(e)}},`${e.date||"Unknown date"}: ${e.types.join(", ")}${e.assumed?" (assumed)":""}`)))}function Ge(e,n){return[B(a,{id:"person-edbg-date",label:"Date",help:"Date on which the background check was cleared (empty if not known)",type:"date",modelValue:e.date,"onUpdate:modelValue":n=>e.date=n,errorFn:n=>n&&""!==e.date?e.date.match(/^20\d\d-\d\d-\d\d$/)?"":"This is not a valid date.":""}),B(T,{id:"person-edbg-types",label:"Type(s)",options:n,inline:!0,modelValue:e.types,"onUpdate:modelValue":n=>e.types=n}),B(D,{id:"person-edbg-assumed",label:"Assumed (no paper record)",help:"Checks are assumed for long-standing volunteers whose historical records are missing.",modelValue:e.assumed,"onUpdate:modelValue":n=>e.assumed=n})]}function Ze(e){return e.replace(/[^0-9]/g,"")}var je=n({components:{Modal:o,PersonEditBGChecks:We,SButton:V,SForm:t,SFCheckGroup:T,SFInput:a,SSpinner:l},props:{pid:{type:Number,required:!0}},setup(e){const n=r(null);const o=r({}),t=r(""),a=r(new Set),s=r([]),l=r(!0);const i=r(null);const u=r(!1);return{bgChecksRef:i,digitsOnly:Ze,dswCERTError:function(e){return e&&o.value.dswCERT?o.value.dswCERT.match(/^20\d\d-\d\d-\d\d$/)?"":"This is not a valid YYYY-MM-DD date.":""},dswCommError:function(e){return e&&o.value.dswComm?o.value.dswComm.match(/^20\d\d-\d\d-\d\d$/)?"":"This is not a valid YYYY-MM-DD date.":""},identification:a,identTypes:s,loading:l,modal:n,onAddBGCheck:function(){var e;console.log("onAddBGCheck called"),null==(e=i.value)||e.startAdd()},onCancel:function(){n.value.close(!1)},onSubmit:async function(){var s;null==(s=i.value)||s.prepareForSave();var l=new FormData;l.append("volgistics",t.value),l.append("dswCERT",o.value.dswCERT||""),l.append("dswComm",o.value.dswComm||""),a.value.forEach((e=>{l.append("identification",e)})),o.value.bgChecks.forEach((e=>{l.append("bgCheck",`${e.date}:${e.types.join(",")}:${e.assumed}`)})),u.value=!0,await d.post(`/api/people/${e.pid}/status`,l),u.value=!1,n.value.close(!0)},person:o,show:function(){return async function(){l.value=!0,o.value=(await d.get(`/api/people/${e.pid}/status`)).data,t.value=o.value.volgistics?o.value.volgistics.toString():"",s.value=o.value.identification.map((e=>({label:e.type,value:e.type}))),a.value=new Set(o.value.identification.filter((e=>e.held)).map((e=>e.type))),l.value=!1}(),n.value.show()},submitting:u,volgistics:t,volgisticsError:function(e){return e&&t.value&&parseInt(t.value)<1?"This is not a valid Volgistics ID number.":""}}}});const Je=x("Add");je.render=function(e,n,o,t,a,s){const l=p("SSpinner"),r=p("SFInput"),i=p("SFCheckGroup"),d=p("PersonEditBGChecks"),u=p("SButton"),g=p("SForm"),w=p("Modal");return m(),c(w,{ref:"modal"},{default:v((()=>[h(g,{dialog:"",variant:"primary",title:"Edit Volunteer Status",submitLabel:"Save",disabled:e.submitting,onSubmit:e.onSubmit,onCancel:e.onCancel},{extraButtons:v((()=>[h(u,{variant:"primary",onClick:U(e.onAddBGCheck,["prevent"])},{default:v((()=>[Je])),_:1},8,["onClick"])])),default:v((()=>[e.loading?(m(),c(l,{key:0})):(m(),c(f,{key:1},[h(r,{id:"person-volgistics",label:"Volgistics ID",modelValue:e.volgistics,"onUpdate:modelValue":n[1]||(n[1]=n=>e.volgistics=n),autofocus:"",errorFn:e.volgisticsError,restrictFn:e.digitsOnly},null,8,["modelValue","errorFn","restrictFn"]),h(r,{id:"person-dsw-cert",type:"date",label:"DSW CERT",modelValue:e.person.dswCERT,"onUpdate:modelValue":n[2]||(n[2]=n=>e.person.dswCERT=n),errorFn:e.dswCERTError,help:"Date when CERT DSW registration form was signed."},null,8,["modelValue","errorFn","help"]),h(r,{id:"person-dsw-comm",type:"date",label:"DSW Communications",modelValue:e.person.dswComm,"onUpdate:modelValue":n[3]||(n[3]=n=>e.person.dswComm=n),errorFn:e.dswCommError,help:"Date when Communications DSW registration form was signed."},null,8,["modelValue","errorFn","help"]),h(i,{id:"person-identification",label:"IDs Issued",modelValue:e.identification,"onUpdate:modelValue":n[4]||(n[4]=n=>e.identification=n),options:e.identTypes},null,8,["modelValue","options"]),h(d,{ref:"bgChecksRef",checks:e.person.bgChecks,types:e.person.bgCheckTypes},null,8,["checks","types"])],64))])),_:1},8,["disabled","onSubmit","onCancel"])])),_:1},512)};var Ke=n({components:{PersonEditStatus:je,PersonViewSection:j},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:n}){const o=i("me"),t=R((()=>e.person.status&&!e.person.status.dswCERT.registered&&!e.person.status.dswCERT.needed&&!e.person.status.dswComm.registered&&!e.person.status.dswComm.needed&&(e.person.status.backgroundCheck.admin?!e.person.status.backgroundCheck.needed&&!e.person.status.backgroundCheck.checks.length:!e.person.status.backgroundCheck.cleared&&!e.person.status.backgroundCheck.needed)&&!e.person.status.identification.length)),a=R((()=>!(!(e.person.status&&e.person.status.backgroundCheck.admin&&e.person.status.backgroundCheck.needed)||e.person.status.backgroundCheck.checks.find((n=>n.type.indexOf(e.person.status.backgroundCheck.needed)>=0)))&&e.person.status.backgroundCheck.needed)),s=r(null);return{editStatusModal:s,onEditStatus:async function(){await s.value.show()&&n("reload")},me:o,missingBGCheck:a,nothingElseToShow:t}}});const Qe={id:"person-view-status-grid"},Xe=h("div",null,"Volgistics",-1),en=h("div",null,"City volunteer",-1),nn={key:0},on=h("a",{href:"https://www.volgistics.com/ex/portal.dll/ap?AP=929478828",target:"_blank"},"Please register",-1),tn={key:1,style:{color:"red"}},an={key:0},sn={key:1},ln=h("div",null,"DSW CERT",-1),rn={key:1},dn={key:2},un={key:3},pn={key:4},cn=h("div",null,"DSW CERT",-1),mn=h("div",{style:{color:"red"}},"Not registered",-1),vn=h("div",null,"DSW SARES",-1),hn={key:1},fn={key:2},gn={key:3},wn={key:4},Cn=h("div",null,"DSW SARES",-1),yn=h("div",{style:{color:"red"}},"Not registered",-1),bn=h("div",null,"Background Checks",-1),kn={id:"person-view-status-checks"},Sn={key:0,style:{color:"red"}},En=h("div",null,"Background check",-1),Pn=h("div",null,"Cleared",-1),Vn=h("div",null,"Background check",-1),An=h("div",null,"Background check",-1),xn=h("div",{style:{color:"red"}},"Not cleared",-1),Rn=h("div",null,"IDs issued",-1),Fn={id:"person-view-status-identification"};Ke.render=function(e,n,o,t,a,s){const l=p("PersonEditStatus"),r=p("PersonViewSection");return e.person.status?(m(),c(r,{key:0,title:"Volunteer Status",editable:e.person.status.canEdit,onEdit:e.onEditStatus},{default:v((()=>[h("div",Qe,["admin"===e.person.status.level?(m(),c(f,{key:0},[Xe,e.person.status.volgistics.id?(m(),c("div",{key:0,textContent:b(`#${e.person.status.volgistics.id}`)},null,8,["textContent"])):(m(),c("div",{key:1,style:{color:e.person.status.volgistics.needed?"red":null}},"Not registered",4))],64)):e.person.status.volgistics.needed&&!e.person.status.volgistics.id?(m(),c(f,{key:1},[en,e.me.id===e.person.id?(m(),c("div",nn,[on])):(m(),c("div",tn,"Not registered"))],64)):e.nothingElseToShow?(m(),c(f,{key:2},[e.person.status.volgistics.id?(m(),c("div",an,"Registered")):(m(),c("div",sn,"Not registered"))],64)):g("",!0),e.person.status.dswCERT.registered?(m(),c(f,{key:3},[ln,e.person.status.dswCERT.expired?(m(),c("div",{key:0,style:{color:e.person.status.dswCERT.needed?"red":null}},"Expired on "+b(e.person.status.dswCERT.expires),5)):"admin"==e.person.status.level&&e.person.status.dswCERT.expires?(m(),c("div",rn,"Registered "+b(e.person.status.dswCERT.registered)+", expires "+b(e.person.status.dswCERT.expires.replace(/-/g,"‑")),1)):"admin"==e.person.status.level?(m(),c("div",dn,"Registered "+b(e.person.status.dswCERT.registered),1)):e.person.status.dswCERT.expires?(m(),c("div",un,"Expires on "+b(e.person.status.dswCERT.expires),1)):(m(),c("div",pn,"Registered"))],64)):e.person.status.dswCERT.needed?(m(),c(f,{key:4},[cn,mn],64)):g("",!0),e.person.status.dswComm.registered?(m(),c(f,{key:5},[vn,e.person.status.dswComm.expired?(m(),c("div",{key:0,style:{color:e.person.status.dswComm.needed?"red":null}},"Expired on "+b(e.person.status.dswComm.expires),5)):"admin"==e.person.status.level&&e.person.status.dswComm.expires?(m(),c("div",hn,"Registered "+b(e.person.status.dswComm.registered)+", expires "+b(e.person.status.dswComm.expires.replace(/-/g,"‑")),1)):"admin"==e.person.status.level?(m(),c("div",fn,"Registered "+b(e.person.status.dswComm.registered),1)):e.person.status.dswComm.expires?(m(),c("div",gn,"Expires on "+b(e.person.status.dswComm.expires),1)):(m(),c("div",wn,"Registered"))],64)):e.person.status.dswComm.needed?(m(),c(f,{key:6},[Cn,yn],64)):g("",!0),e.person.status.backgroundCheck.admin?(m(),c(f,{key:7},[bn,h("div",kn,[(m(!0),c(f,null,N(e.person.status.backgroundCheck.checks,(e=>(m(),c("div",{class:{"person-view-status-assumed":e.assumed}},[e.date?(m(),c("span",{key:0,class:"person-view-status-date",textContent:b(`${e.date} `)},null,8,["textContent"])):g("",!0),h("span",{textContent:b(e.type.join("+"))},null,8,["textContent"]),e.assumed?(m(),c("span",{key:1,textContent:b(" (assumed)")},null,8,["textContent"])):e.date?g("",!0):(m(),c("span",{key:2,textContent:b(" (date unknown)")},null,8,["textContent"]))],2)))),256)),e.missingBGCheck?(m(),c("div",Sn,"Missing required "+b(e.missingBGCheck)+" check",1)):g("",!0)])],64)):(m(),c(f,{key:8},["true"===e.person.status.backgroundCheck.cleared?(m(),c(f,{key:0},[En,Pn],64)):e.person.status.backgroundCheck.cleared?(m(),c(f,{key:1},[Vn,h("div",null,"Cleared on "+b(e.person.status.backgroundCheck.cleared),1)],64)):e.person.status.backgroundCheck.needed?(m(),c(f,{key:2},[An,xn],64)):g("",!0)],64)),e.person.status.identification.length?(m(),c(f,{key:9},[Rn,h("div",Fn,[(m(!0),c(f,null,N(e.person.status.identification,(e=>(m(),c("div",{textContent:b(e)},null,8,["textContent"])))),256))])],64)):g("",!0)]),e.person.canEdit?(m(),c(l,{key:0,ref:"editStatusModal",pid:e.person.id},null,8,["pid"])):g("",!0)])),_:1},8,["editable","onEdit"])):g("",!0)};var Nn=n({components:{Modal:o,SubscriptionsForm:I},props:{pid:{type:Number,required:!0}},setup(e){const n=r(null);return{modal:n,onDone:function(e){n.value.close(e)},show:function(){return n.value.show()}}}});Nn.render=function(e,n,o,t,a,s){const l=p("SubscriptionsForm"),r=p("Modal");return m(),c(r,{ref:"modal"},{default:v((()=>[h(l,{inModal:"",pid:e.pid,onDone:e.onDone},null,8,["pid","onDone"])])),_:1},512)};var Tn=n({components:{PersonEditSubscriptions:Nn,PersonViewSection:j},props:{person:{type:Object,required:!0}},emits:["reload"],setup(e,{emit:n}){const o=r(null);return{editSubscriptionsModal:o,onEditSubscriptions:async function(){await o.value.show()&&n("reload")}}}});const $n={id:"person-view-lists-list"},Mn={key:0,style:{color:"red"}},Bn={key:1,style:{color:"red"}};Tn.render=function(e,n,o,t,a,s){const l=p("PersonEditSubscriptions"),r=p("PersonViewSection");return e.person.noEmail||e.person.noText||e.person.lists.length||e.person.canEditLists?(m(),c(r,{key:0,title:"Subscriptions",editable:e.person.canEditLists,onEdit:e.onEditSubscriptions},{default:v((()=>[h("div",$n,[e.person.noEmail?(m(),c("div",Mn,"Unsubcribed from all email.")):g("",!0),e.person.noText?(m(),c("div",Bn,"Unsubscribed from all text messaging.")):g("",!0),(m(!0),c(f,null,N(e.person.lists,(e=>(m(),c("div",{textContent:b(e)},null,8,["textContent"])))),256))]),e.person.canEditLists?(m(),c(l,{key:0,ref:"editSubscriptionsModal",pid:e.person.id},null,8,["pid"])):g("",!0)])),_:1},8,["editable","onEdit"])):g("",!0)};var Dn=n({components:{MessageBox:H,PersonEditPassword:q,PersonViewContact:X,PersonViewNames:ge,PersonViewNotes:Me,PersonViewRoles:qe,PersonViewSection:j,PersonViewStatus:Ke,PersonViewSubscriptions:Tn,SButton:V,SSpinner:l},props:{onLoadPerson:{type:Function,required:!0}},setup(e){const n=_(),o=r(null);d.get(`/api/people/${n.params.id}`).then((n=>{o.value=n.data,e.onLoadPerson(o.value)}));const t=r(null);const a=r(null);return{changePasswordModal:t,onChangePassword:function(){t.value.show()},onResetPassword:function(){a.value.show()&&d.post(`/api/people/${n.params.id}/pwreset`)},onReload:async function(){o.value=(await d.get(`/api/people/${n.params.id}`)).data},person:o,resetPasswordModal:a}}});const Un={key:0,id:"person-view-spinner"},Hn={key:1,id:"person-view"},_n={id:"person-view-grid"},In=h("div",{class:"person-view-spacer"},null,-1),qn={id:"person-view-chpw"},zn=x("Change Password"),On=x("Reset Password");Dn.render=function(e,n,o,t,a,s){const l=p("SSpinner"),r=p("PersonViewNames"),i=p("PersonViewRoles"),d=p("PersonViewContact"),u=p("PersonViewStatus"),f=p("PersonViewNotes"),w=p("PersonViewSubscriptions"),C=p("SButton"),y=p("PersonViewSection"),k=p("PersonEditPassword"),S=p("MessageBox");return e.person?(m(),c("div",Hn,[h("div",_n,[h(r,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),In,h(i,{person:e.person,onReload:e.onReload,style:{"grid-row":"2/3"}},null,8,["person","onReload"]),h(d,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),h(u,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),h(f,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),h(w,{person:e.person,onReload:e.onReload},null,8,["person","onReload"]),e.person.canChangePassword||e.person.canResetPassword?(m(),c(y,{key:0,title:"Password",editable:!1},{default:v((()=>[h("div",qn,[e.person.canChangePassword?(m(),c(C,{key:0,variant:"primary",small:"",onClick:e.onChangePassword},{default:v((()=>[zn])),_:1},8,["onClick"])):g("",!0),e.person.canResetPassword?(m(),c(C,{key:1,variant:"primary",small:"",onClick:e.onResetPassword},{default:v((()=>[On])),_:1},8,["onClick"])):g("",!0)])])),_:1})):g("",!0)]),e.person.canChangePassword?(m(),c(k,{key:0,ref:"changePasswordModal",pid:e.person.id},null,8,["pid"])):g("",!0),h(S,{ref:"resetPasswordModal",title:"Reset Password",variant:"warning",okLabel:"Reset Password"},{default:v((()=>[x("This will replace "+b(e.person.informalName)+"’s current password with a new, randomly generated one, and send it to them by email. You should do this only if they have explicitly asked you to. Are you sure you want to reset "+b(e.person.informalName)+"’s password?",1)])),_:1},512)])):(m(),c("div",Un,[h(l)]))};export default Dn;
