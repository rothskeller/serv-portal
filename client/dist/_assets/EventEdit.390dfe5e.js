let e=document.createElement("style");e.innerHTML="#event-edit-spinner{margin:1.5rem .75rem}",document.head.appendChild(e);import{d as a,h as n,s as t,l as r,m as l,n as u,p as o,L as v,M as s,e as i,f as d,_ as p,I as m,u as c,v as g,D as h,x as y,N as f,r as S,c as b,a as V,y as w,w as E,o as F,F as D,z,b as U}from"./index.c7c02bd7.js";import{s as W}from"./page.839d73b9.js";var T=a({components:{MessageBox:n,SButton:t,SForm:r,SFCheckGroup:l,SFInput:u,SFSelect:o,SFTextArea:v,SFTimeRange:s,SSpinner:i},props:{onLoadEvent:{type:Function,required:!0}},setup(e){const a=g(),n=y();W({title:"Events"});const t=d(null),r=d([]),l=d([]),u=d([]),o=d([]);p.get(`/api/events/${a.params.id}?edit=1`).then((n=>{t.value=n.data.event,r.value=n.data.groups,l.value=n.data.venues,l.value.unshift({id:0,name:"TBD"}),l.value.push({id:-1,name:"(create a new venue)"}),u.value=n.data.types,t.value.type||u.value.unshift("(select type)"),o.value=n.data.organizations,t.value.organization||o.value.unshift("(select organization)"),"NEW"===a.params.id?W({title:"New Event"}):W({title:`${t.value.date} ${t.value.name}`,browserTitle:t.value.date}),e.onLoadEvent(t.value)}));const v=d(null);const s=d(null);m((()=>t.value?.venue.id),(()=>{t.value&&-1===t.value.venue.id&&(t.value.venue.name=t.value.venue.address="",t.value.venue.city=t.value.venue.url="",f((()=>{s.value.focus()})))}));const i=c({get:()=>{const e=new Set;return t.value.renewsDSW&&e.add("renewsDSW"),t.value.coveredByDSW&&e.add("coveredByDSW"),t.value.private&&e.add("private"),e},set:e=>{t.value.renewsDSW=e.has("renewsDSW"),t.value.coveredByDSW=e.has("coveredByDSW"),t.value.private=e.has("private")}}),S=c((()=>r.value.filter((e=>e.organization===t.value.organization||!e.organization)))),b=c({get:()=>new Set(t.value.groups),set:e=>{t.value.groups=Array.from(e.values())}});d(!1);const V=d(null);return{event:t,nameError:function(e){return e&&t.value?t.value.name?v.value&&v.value.date===t.value.date&&v.value.name===t.value.name?"Another event on this date has this name.":"":"The event name is required.":""},types:u,typeError:function(e){return e&&t.value?t.value.type&&"(select type)"!==t.value.type?"":"The event type is required.":""},organizations:o,organizationError:function(e){return e&&t.value?t.value.organization&&"(select organization)"!==t.value.organization?"":"The organization is required.":""},dateError:function(e){return e&&t.value?t.value.date?t.value.date.match(/^20\d\d-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/)?"":"This is not a valid date.":"The event date is required.":""},allVenues:l,venueName:s,venueNameError:function(e){return e&&t.value&&-1===t.value.venue.id?t.value.venue.name?"":"The venue name is required.":""},venueAddressError:function(e){return e&&t.value&&-1===t.value.venue.id?t.value.venue.address?"":"The venue address is required.":""},venueCityError:function(e){return e&&t.value&&-1===t.value.venue.id?t.value.venue.city?"":"The venue city is required.":""},venueURLError:function(e){return e&&t.value&&-1===t.value.venue.id&&t.value.venue.url&&!t.value.venue.url.startsWith("https://www.google.com/maps/")?"The venue map URL must start with https://www.google.com/maps/.":""},flags:i,flagOptions:[{value:"renewsDSW",label:"Attendance renews DSW registration"},{value:"coveredByDSW",label:"Event is covered by DSW insurance"},{value:"private",label:"Event is visible only to invited groups"}],filteredGroups:S,groups:b,groupsError:function(e,a){return a&&0===b.value.size?"At least one group must be invited.":""},onSubmit:async function(){if(!t.value)return;const e=new FormData;e.append("name",t.value.name),e.append("type",t.value.type),e.append("organization",t.value.organization),e.append("date",t.value.date),e.append("start",t.value.start),e.append("end",t.value.end),-1===t.value.venue.id?(e.append("venue","NEW"),e.append("venueName",t.value.venue.name),e.append("venueAddress",t.value.venue.address),e.append("venueCity",t.value.venue.city),e.append("venueURL",t.value.venue.url)):e.append("venue",t.value.venue.id.toString()),e.append("renewsDSW",t.value.renewsDSW.toString()),e.append("coveredByDSW",t.value.coveredByDSW.toString()),e.append("private",t.value.private.toString()),e.append("details",t.value.details),t.value.groups.forEach((a=>{e.append("group",a.toString())}));const r=(await p.post("/api/events/"+a.params.id,e)).data;r.nameError?v.value={name:t.value.name,date:t.value.date}:(h.set("serv-events-month",t.value.date.substr(0,7)),n.push("/events/"+r.id))},onDelete:async function(){if(V.value){if(await V.value.show()){const e=new FormData;e.append("delete","true"),await p.post("/api/events/"+a.params.id,e),n.push({path:"/events",params:{year:t.value.date.substr(0,4)}})}}},deleteModal:V}}});const L={key:0,id:"event-edit-spinner"},B=U("Delete Event"),A=U("Are you sure you want to delete this event? All associated data, including attendance records, will be permanently lost.");T.render=function(e,a,n,t,r,l){const u=S("SSpinner"),o=S("SFInput"),v=S("SFSelect"),s=S("SFTimeRange"),i=S("SFTextArea"),d=S("SFCheckGroup"),p=S("SButton"),m=S("MessageBox"),c=S("SForm");return e.event?(F(),b(c,{key:1,onSubmit:e.onSubmit,submitLabel:"Save Event",onCancel:a[15]||(a[15]=()=>{})},w({default:E((()=>[V(o,{id:"event-name",label:"Event name",autofocus:"",trim:"",modelValue:e.event.name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.event.name=a),errorFn:e.nameError},null,8,["modelValue","errorFn"]),V(v,{id:"event-type",label:"Event type",options:e.types,modelValue:e.event.type,"onUpdate:modelValue":a[2]||(a[2]=a=>e.event.type=a),errorFn:e.typeError},null,8,["options","modelValue","errorFn"]),V(v,{id:"event-type",label:"Organization",options:e.organizations,modelValue:e.event.organization,"onUpdate:modelValue":a[3]||(a[3]=a=>e.event.organization=a),errorFn:e.organizationError},null,8,["options","modelValue","errorFn"]),V(o,{id:"event-date",label:"Event date",type:"date",modelValue:e.event.date,"onUpdate:modelValue":a[4]||(a[4]=a=>e.event.date=a),errorFn:e.dateError},null,8,["modelValue","errorFn"]),V(s,{id:"event-times",label:"Event time",start:e.event.start,"onUpdate:start":a[5]||(a[5]=a=>e.event.start=a),end:e.event.end,"onUpdate:end":a[6]||(a[6]=a=>e.event.end=a)},null,8,["start","end"]),V(v,{id:"event-venue",label:"Location",options:e.allVenues,valueKey:"id",labelKey:"name",modelValue:e.event.venue.id,"onUpdate:modelValue":a[7]||(a[7]=a=>e.event.venue.id=a)},null,8,["options","modelValue"]),-1===e.event.venue.id?(F(),b(D,{key:0},[V(o,{id:"venue-name",label:"Venue name",ref:"venueName",trim:"",modelValue:e.event.venue.name,"onUpdate:modelValue":a[8]||(a[8]=a=>e.event.venue.name=a),errorFn:e.venueNameError},null,8,["modelValue","errorFn"]),V(o,{id:"venue-address",label:"Address",trim:"",modelValue:e.event.venue.address,"onUpdate:modelValue":a[9]||(a[9]=a=>e.event.venue.address=a),errorFn:e.venueAddressError},null,8,["modelValue","errorFn"]),V(o,{id:"venue-city",label:"City",trim:"",modelValue:e.event.venue.city,"onUpdate:modelValue":a[10]||(a[10]=a=>e.event.venue.city=a),errorFn:e.venueCityError},null,8,["modelValue","errorFn"]),V(o,{id:"venue-url",label:"Map URL",trim:"",modelValue:e.event.venue.url,"onUpdate:modelValue":a[11]||(a[11]=a=>e.event.venue.url=a),errorFn:e.venueURLError,help:"Generate this by opening Google Maps and searching for the venue. (Search by the venue’s name rather than its address, if it has a name, so that Google’s sidebar of information about the venue appears.)  Once the venue is found, zoom out a few steps until the nearest freeways are shown — enough to give the viewer an idea of where in the Bay Area the venue is.  Copy the URL from the browser address bar and paste it here."},null,8,["modelValue","errorFn"])],64)):z("",!0),V(i,{id:"event-details",label:"Details",trim:"",rows:"3",wrap:"soft",modelValue:e.event.details,"onUpdate:modelValue":a[12]||(a[12]=a=>e.event.details=a),help:"This may contain HTML <a> tags for links, but no other tags."},null,8,["modelValue"]),V(d,{id:"event-flags",label:"Flags",options:e.flagOptions,modelValue:e.flags,"onUpdate:modelValue":a[13]||(a[13]=a=>e.flags=a)},null,8,["options","modelValue"]),V(d,{id:"event-groups",label:"Invited groups",options:e.filteredGroups,valueKey:"id",labelKey:"name",modelValue:e.groups,"onUpdate:modelValue":a[14]||(a[14]=a=>e.groups=a),errorFn:e.groupsError},null,8,["options","modelValue","errorFn"]),V(m,{ref:"deleteModal",title:"Delete Event",cancelLabel:"Keep",okLabel:"Delete",variant:"danger"},{default:E((()=>[A])),_:1},512)])),_:2},[e.event.id?{name:"extraButtons",fn:E((()=>[V(p,{onClick:e.onDelete,variant:"danger"},{default:E((()=>[B])),_:1},8,["onClick"])]))}:void 0]),1032,["onSubmit"])):(F(),b("div",L,[V(u)]))};export default T;
