{"version":3,"sources":["webpack:///./client/pages/texts/TextsSend.vue?06b9","webpack:///client/pages/texts/TextsSend.vue","webpack:///./client/pages/texts/TextsSend.vue?5d3e","webpack:///./client/pages/texts/TextsSend.vue","webpack:///./client/pages/texts/TextsSend.vue?193a","webpack:///./node_modules/@babel/runtime/regenerator/index.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","groups","attrs","on","$event","preventDefault","onSubmit","messageError","model","value","callback","$$v","message","expression","class","countClass","_v","_s","countMessage","_e","groupsError","recipients","staticClass","sending","valid","staticRenderFns","data","watch","computed","methods","validate","submitted","runes","chars","length","component","module","exports"],"mappings":"oHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAASF,EAAIM,OAAqFF,EAAG,SAAS,CAACG,MAAM,CAAC,GAAK,cAAcC,GAAG,CAAC,OAAS,SAASC,GAAgC,OAAxBA,EAAOC,iBAAwBV,EAAIW,SAASF,MAAW,CAACL,EAAG,eAAe,CAACG,MAAM,CAAC,MAAQ,UAAU,YAAY,qBAAqB,gBAAgB,OAAO,cAAc,mBAAmB,OAAQP,EAAIY,cAAsB,KAAK,gBAAkBZ,EAAIY,eAAe,CAACR,EAAG,aAAa,CAACG,MAAM,CAAC,GAAK,qBAAqB,KAAO,IAAI,UAAY,IAAIM,MAAM,CAACC,MAAOd,EAAW,QAAEe,SAAS,SAAUC,GAAMhB,EAAIiB,QAAQD,GAAKE,WAAW,aAAclB,EAAgB,aAAEI,EAAG,cAAc,CAACe,MAAMnB,EAAIoB,YAAY,CAACpB,EAAIqB,GAAGrB,EAAIsB,GAAGtB,EAAIuB,iBAAiBvB,EAAIwB,MAAM,GAAGpB,EAAG,eAAe,CAACG,MAAM,CAAC,MAAQ,aAAa,YAAY,oBAAoB,gBAAgB,OAAO,cAAc,wBAAwB,OAAQP,EAAIyB,aAAsB,KAAK,gBAAkBzB,EAAIyB,cAAc,CAACrB,EAAG,wBAAwB,CAACG,MAAM,CAAC,GAAK,oBAAoB,QAAUP,EAAIM,OAAO,QAAU,GAAG,aAAa,OAAO,cAAc,MAAMO,MAAM,CAACC,MAAOd,EAAc,WAAEe,SAAS,SAAUC,GAAMhB,EAAI0B,WAAWV,GAAKE,WAAW,iBAAiB,GAAGd,EAAG,MAAM,CAACuB,YAAY,QAAQ,CAACvB,EAAG,WAAW,CAACG,MAAM,CAAC,KAAO,SAAS,QAAU,UAAU,SAAWP,EAAI4B,UAAY5B,EAAI6B,QAAQ,CAAE7B,EAAW,QAAEI,EAAG,YAAY,CAACG,MAAM,CAAC,MAAQ,MAAMH,EAAG,OAAO,CAACJ,EAAIqB,GAAG,mBAAmB,IAAI,IAAI,GAA31CjB,EAAG,MAAM,CAACuB,YAAY,aAAa,CAACvB,EAAG,YAAY,CAACG,MAAM,CAAC,MAAQ,OAAO,IACpLuB,EAAkB,G,iVCmBtB,OACEC,KAAM,WAAR,OACA,YACA,WACA,cACA,cACA,qBACA,kBACA,iBACA,aACA,aAEE,QAZF,kIAaA,gCAbA,OAaA,EAbA,OAaA,KACA,qBAdA,wGAgBEC,MAAO,CACLf,QAAS,WACTS,WAAY,YAEdO,SAAU,CACRJ,MADJ,WACA,8CAEEK,QAAS,CACP,SADJ,uHAEA,kBACA,gBACA,WAJA,wDAKA,eACA,iCACA,mEACA,gBARA,UASA,+BATA,QASA,EATA,OASA,KACA,gBACA,0CAXA,yGAaIC,SAbJ,WAcM,IAAN,KACA,IACA,IAHA,uBAIA,uFACA,IACA,iJACA,IACA,6BACA,KAEA,MAXA,kFAaUlC,KAAKmC,YAAcC,GACrBpC,KAAKW,aAAe,yCACpBX,KAAKsB,aAAe,GACpBtB,KAAKmB,WAAa,IAC1B,GACQnB,KAAKW,aAAe,GACpBX,KAAKsB,aAAe,GAA5B,gBACQtB,KAAKmB,WAAaiB,EAAQ,GAAK,kBAAoB,KAEnDpC,KAAKW,aAAe,GACpBX,KAAKsB,aAAe,GAA5B,iBACQtB,KAAKmB,WAAakB,EAAQ,IAAM,kBAAoB,IAElDrC,KAAKmC,YAAcnC,KAAKyB,WAAWa,OAC7C,iEAEA,yBCrFkW,I,wBCQ9VC,EAAY,eACd,EACAzC,EACA+B,GACA,EACA,KACA,KACA,MAIa,aAAAU,E,6CCnBf,yBAAqiB,EAAG,G,qBCAxiBC,EAAOC,QAAU,EAAQ,S","file":"js/TextsSend.39b33d4d.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (!_vm.groups)?_c('div',{staticClass:\"mt-3 ml-2\"},[_c('b-spinner',{attrs:{\"small\":\"\"}})],1):_c('b-form',{attrs:{\"id\":\"texts-send\"},on:{\"submit\":function($event){$event.preventDefault();return _vm.onSubmit($event)}}},[_c('b-form-group',{attrs:{\"label\":\"Message\",\"label-for\":\"texts-send-message\",\"label-cols-sm\":\"auto\",\"label-class\":\"texts-send-label\",\"state\":_vm.messageError ? false: null,\"invalidFeedback\":_vm.messageError}},[_c('b-textarea',{attrs:{\"id\":\"texts-send-message\",\"rows\":\"5\",\"autofocus\":\"\"},model:{value:(_vm.message),callback:function ($$v) {_vm.message=$$v},expression:\"message\"}}),(_vm.countMessage)?_c('b-form-text',{class:_vm.countClass},[_vm._v(_vm._s(_vm.countMessage))]):_vm._e()],1),_c('b-form-group',{attrs:{\"label\":\"Recipients\",\"label-for\":\"texts-send-groups\",\"label-cols-sm\":\"auto\",\"label-class\":\"texts-send-label pt-0\",\"state\":_vm.groupsError ? false : null,\"invalidFeedback\":_vm.groupsError}},[_c('b-form-checkbox-group',{attrs:{\"id\":\"texts-send-groups\",\"options\":_vm.groups,\"stacked\":\"\",\"text-field\":\"name\",\"value-field\":\"id\"},model:{value:(_vm.recipients),callback:function ($$v) {_vm.recipients=$$v},expression:\"recipients\"}})],1),_c('div',{staticClass:\"mt-3\"},[_c('b-button',{attrs:{\"type\":\"submit\",\"variant\":\"primary\",\"disabled\":_vm.sending || !_vm.valid}},[(_vm.sending)?_c('b-spinner',{attrs:{\"small\":\"\"}}):_c('span',[_vm._v(\"Send Message\")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<!--\nTextsSend sends a new text message.\n-->\n\n<template lang=\"pug\">\ndiv.mt-3.ml-2(v-if=\"!groups\")\n  b-spinner(small)\nb-form#texts-send(v-else @submit.prevent=\"onSubmit\")\n  b-form-group(label=\"Message\" label-for=\"texts-send-message\" label-cols-sm=\"auto\" label-class=\"texts-send-label\" :state=\"messageError ? false: null\" :invalidFeedback=\"messageError\")\n    b-textarea#texts-send-message(v-model=\"message\" rows=\"5\" autofocus)\n    b-form-text(v-if=\"countMessage\" :class=\"countClass\") {{countMessage}}\n  b-form-group(label=\"Recipients\" label-for=\"texts-send-groups\" label-cols-sm=\"auto\" label-class=\"texts-send-label pt-0\" :state=\"groupsError ? false : null\" :invalidFeedback=\"groupsError\")\n    b-form-checkbox-group#texts-send-groups(v-model=\"recipients\" :options=\"groups\" stacked text-field=\"name\" value-field=\"id\")\n  div.mt-3\n    b-button(type=\"submit\" variant=\"primary\" :disabled=\"sending || !valid\")\n      b-spinner(v-if=\"sending\" small)\n      span(v-else) Send Message\n</template>\n\n<script>\nexport default {\n  data: () => ({\n    groups: null,\n    message: '',\n    recipients: [],\n    countClass: '',\n    countMessage: '0/160',\n    messageError: null,\n    groupsError: null,\n    submitted: false,\n    sending: false,\n  }),\n  async created() {\n    const data = (await this.$axios.get('/api/sms/NEW')).data\n    this.groups = data.groups\n  },\n  watch: {\n    message: 'validate',\n    recipients: 'validate',\n  },\n  computed: {\n    valid() { return !this.messageError && !this.groupsError }\n  },\n  methods: {\n    async onSubmit() {\n      this.submitted = true\n      this.validate()\n      if (!this.valid) return\n      const body = new FormData\n      body.append('message', this.message)\n      this.recipients.forEach(r => body.append('group', r))\n      this.sending = true\n      const resp = (await this.$axios.post('/api/sms', body)).data\n      this.sending = false\n      this.$router.push(`/texts/${resp.id}`)\n    },\n    validate() {\n      let unicode = false\n      let runes = 0\n      let chars = 0\n      for (const ch of this.message) {\n        runes++\n        if ('£$¥èéùìòÇ\\nØø\\rÅåΔ_ΦΓΛΩΠΨΣΘΞ\\x1bÆæßÉ !\"#¤%&\\'()*+,-./0123456789:;<=>?¡ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÑÜ§¿abcdefghijklmnopqrstuvwxyzäöñüà'.includes(ch))\n          chars++\n        else if ('\\f\\n^{}\\\\[~]|€'.includes(ch))\n          chars += 2\n        else\n          unicode = true\n      }\n      if (this.submitted && !runes) {\n        this.messageError = 'Please enter the text of your message.'\n        this.countMessage = ''\n        this.countClass = ''\n      } else if (unicode) {\n        this.messageError = ''\n        this.countMessage = `${runes}/70`\n        this.countClass = runes > 70 ? 'texts-send-long' : ''\n      } else {\n        this.messageError = ''\n        this.countMessage = `${chars}/160`\n        this.countClass = chars > 160 ? 'texts-send-long' : ''\n      }\n      if (this.submitted && !this.recipients.length)\n        this.groupsError = 'Please select the recipients of your message.'\n      else\n        this.groupsError = null\n    },\n  },\n}\n</script>\n\n<style lang=\"stylus\">\n#texts-send\n  padding 1.5rem 0.75rem\n.texts-send-label\n  width 7rem\n#texts-send-message\n  min-width 12rem\n  max-width 20rem\n.texts-send-long\n  color red !important\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TextsSend.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TextsSend.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TextsSend.vue?vue&type=template&id=6bebf4df&lang=pug&\"\nimport script from \"./TextsSend.vue?vue&type=script&lang=js&\"\nexport * from \"./TextsSend.vue?vue&type=script&lang=js&\"\nimport style0 from \"./TextsSend.vue?vue&type=style&index=0&lang=stylus&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TextsSend.vue?vue&type=style&index=0&lang=stylus&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TextsSend.vue?vue&type=style&index=0&lang=stylus&\"","module.exports = require(\"regenerator-runtime\");\n"],"sourceRoot":""}