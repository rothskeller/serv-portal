(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["EventEdit"],{2581:function(e,t,n){"use strict";var a=n("b1da"),r=n.n(a);r.a},a34a:function(e,t,n){e.exports=n("96cf")},b1da:function(e,t,n){},e461:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.event?n("form",{attrs:{id:"event-edit"},on:{submit:function(t){return t.preventDefault(),e.onSubmit(t)}}},[n("b-form-group",{attrs:{label:"Event name","label-for":"event-name","label-cols-sm":"auto","label-class":"event-edit-label",state:!e.nameError&&null,"invalid-feedback":e.nameError}},[n("b-input",{attrs:{id:"event-name",autofocus:"",state:!e.nameError&&null,trim:""},model:{value:e.event.name,callback:function(t){e.$set(e.event,"name",t)},expression:"event.name"}})],1),n("b-form-group",{attrs:{label:"Event type","label-for":"event-type","label-cols-sm":"auto","label-class":"event-edit-label",state:!e.typeError&&null,"invalid-feedback":e.typeError}},[n("b-form-select",{attrs:{id:"event-type",options:e.types,state:!e.typeError&&null},model:{value:e.event.type,callback:function(t){e.$set(e.event,"type",t)},expression:"event.type"}})],1),n("b-form-group",{attrs:{label:"Organization","label-for":"event-organization","label-cols-sm":"auto","label-class":"event-edit-label",state:!e.organizationError&&null,"invalid-feedback":e.organizationError}},[n("b-form-select",{attrs:{id:"event-organization",options:e.organizations,state:!e.organizationError&&null},model:{value:e.event.organization,callback:function(t){e.$set(e.event,"organization",t)},expression:"event.organization"}})],1),n("b-form-group",{attrs:{label:"Event date","label-for":"event-date","label-cols-sm":"auto","label-class":"event-edit-label",state:!e.dateError&&null,"invalid-feedback":e.dateError}},[n("b-input",{attrs:{id:"event-date",type:"date",state:!e.dateError&&null},model:{value:e.event.date,callback:function(t){e.$set(e.event,"date",t)},expression:"event.date"}})],1),n("b-form-group",{attrs:{label:"Event time","label-cols-sm":"auto","label-class":"event-edit-label",state:!e.timeError&&null,"invalid-feedback":e.timeError}},[n("div",{attrs:{id:"event-time"}},[n("b-input",{attrs:{id:"event-start",type:"time",state:!e.timeError&&null},model:{value:e.event.start,callback:function(t){e.$set(e.event,"start",t)},expression:"event.start"}}),n("span",[e._v("to")]),n("b-input",{attrs:{id:"event-end",type:"time",state:!e.timeError&&null},model:{value:e.event.end,callback:function(t){e.$set(e.event,"end",t)},expression:"event.end"}})],1)]),n("b-form-group",{attrs:{label:"Location","label-for":"event-venue","label-cols-sm":"auto","label-class":"event-edit-label"}},[n("b-select",{attrs:{id:"event-venue",options:e.venues,"text-field":"name","value-field":"id"},scopedSlots:e._u([{key:"first",fn:function(){return[n("b-select-option",{attrs:{value:"0"}},[e._v("TBD")])]},proxy:!0}]),model:{value:e.event.venue.id,callback:function(t){e.$set(e.event.venue,"id",t)},expression:"event.venue.id"}},[n("b-select-option",{attrs:{value:"NEW"}},[e._v("(create a new venue)")])],1)],1),"NEW"===e.event.venue.id?[n("b-form-group",{attrs:{label:"Venue name","label-for":"venue-name","label-cols-sm":"auto","label-class":"event-edit-label",state:!e.venueNameError&&null,"invalid-feedback":e.venueNameError}},[n("b-input",{ref:"venueName",attrs:{id:"venue-name",state:!e.venueNameError&&null,trim:""},model:{value:e.event.venue.name,callback:function(t){e.$set(e.event.venue,"name",t)},expression:"event.venue.name"}})],1),n("b-form-group",{attrs:{label:"Address","label-for":"venue-address","label-cols-sm":"auto","label-class":"event-edit-label",state:!e.venueAddressError&&null,"invalid-feedback":e.venueAddressError}},[n("b-input",{attrs:{id:"venue-address",state:!e.venueAddressError&&null,trim:""},model:{value:e.event.venue.address,callback:function(t){e.$set(e.event.venue,"address",t)},expression:"event.venue.address"}})],1),n("b-form-group",{attrs:{label:"City","label-for":"venue-city","label-cols-sm":"auto","label-class":"event-edit-label",state:!e.venueCityError&&null,"invalid-feedback":e.venueCityError}},[n("b-input",{attrs:{id:"venue-city",state:!e.venueCityError&&null,trim:""},model:{value:e.event.venue.city,callback:function(t){e.$set(e.event.venue,"city",t)},expression:"event.venue.city"}})],1),n("b-form-group",{attrs:{label:"Map URL","label-for":"venue-url","label-cols-sm":"auto","label-class":"event-edit-label",state:!e.venueURLError&&null,"invalid-feedback":e.venueURLError}},[n("b-input",{attrs:{id:"venue-url",state:!e.venueURLError&&null,trim:""},model:{value:e.event.venue.url,callback:function(t){e.$set(e.event.venue,"url",t)},expression:"event.venue.url"}}),n("b-form-text",[e._v("Generate this by opening Google Maps and searching for the venue.\n(Search by the venue’s name rather than its address, if it has a\nname, so that Google’s sidebar of information about the venue\nappears.)  Once the venue is found, zoom out a few steps until the\nnearest freeways are shown — enough to give the viewer an idea of\nwhere in the Bay Area the venue is.  Copy the URL from the browser\naddress bar and paste it here.")])],1)]:e._e(),n("b-form-group",{attrs:{label:"Details","label-for":"event-details","label-cols-sm":"auto","label-class":"event-edit-label"}},[n("b-textarea",{attrs:{id:"event-details",rows:"3"},model:{value:e.event.details,callback:function(t){e.$set(e.event,"details",t)},expression:"event.details"}}),n("b-form-text",[e._v("This may contain HTML <a> tags for links, but no other tags.")])],1),e.event.canEditDSWFlags?n("b-form-group",{attrs:{label:"Flags","label-cols-sm":"auto","label-class":"event-edit-label pt-0"}},[n("div",{attrs:{id:"event-edit-flags"}},[n("b-checkbox",{model:{value:e.event.renewsDSW,callback:function(t){e.$set(e.event,"renewsDSW",t)},expression:"event.renewsDSW"}},[e._v("Attendance renews DSW registration")]),n("b-checkbox",{model:{value:e.event.coveredByDSW,callback:function(t){e.$set(e.event,"coveredByDSW",t)},expression:"event.coveredByDSW"}},[e._v("Event is covered by DSW insurance")])],1)]):e._e(),n("b-form-group",{attrs:{label:"Event is for these groups:",state:!e.groupsError&&null,"invalid-feedback":e.groupsError}},[n("b-form-checkbox-group",{attrs:{stacked:"",options:e.groups,"text-field":"name","value-field":"id"},model:{value:e.event.groups,callback:function(t){e.$set(e.event,"groups",t)},expression:"event.groups"}})],1),n("b-form-group",{attrs:{label:"Visibility","label-for":"event-private","label-cols-sm":"auto","label-class":"event-edit-label pt-0"}},[n("b-form-radio-group",{attrs:{stacked:""},model:{value:e.event.private,callback:function(t){e.$set(e.event,"private",t)},expression:"event.private"}},[n("b-form-radio",{attrs:{value:!1}},[e._v("Visible to everyone")]),n("b-form-radio",{attrs:{value:!0}},[e._v("Visible only to selected groups")])],1)],1),n("div",{staticClass:"mt-3"},[n("b-btn",{attrs:{type:"submit",variant:"primary",disabled:!e.valid},domProps:{textContent:e._s(e.event.id?"Save Event":"Create Event")}}),n("b-btn",{staticClass:"ml-2",on:{click:e.onCancel}},[e._v("Cancel")]),e.event.id?n("b-btn",{staticClass:"ml-5",attrs:{variant:"danger"},on:{click:e.onDelete}},[e._v("Delete Event")]):e._e()],1)],2):n("div",{staticClass:"mt-3 ml-2"},[n("b-spinner",{attrs:{small:""}})],1)},r=[],s=n("a34a"),i=n.n(s);function l(e,t,n,a,r,s,i){try{var l=e[s](i),o=l.value}catch(v){return void n(v)}l.done?t(o):Promise.resolve(o).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var s=e.apply(t,n);function i(e){l(s,a,r,i,o,"next",e)}function o(e){l(s,a,r,i,o,"throw",e)}i(void 0)}))}}var v={props:{onLoadEvent:Function},data:function(){return{event:null,groups:null,organizations:null,venues:null,types:null,submitted:!1,dateError:null,timeError:null,nameError:null,duplicateName:null,venueNameError:null,venueAddressError:null,venueCityError:null,venueURLError:null,organizationError:null,typeError:null,groupsError:null,valid:!0}},watch:{"event.name":"validate","event.date":"validate","event.start":"validate","event.end":"validate","event.venue.name":"validate","event.venue.address":"validate","event.venue.city":"validate","event.venue.url":"validate","event.organization":"validate","event.type":"validate","event.groups":"validate","event.venue.id":function(){var e=this;"NEW"===this.event.venue.id&&(this.event.venue.name=this.event.venue.address=this.event.venue.city=this.event.venue.url="",this.validate(),this.$nextTick((function(){e.$refs.venueName.focus()})))}},created:function(){var e=o(i.a.mark((function e(){var t;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.get("/api/events/".concat(this.$route.params.id,"?edit=1"));case 2:t=e.sent.data,this.event=t.event,this.groups=t.groups,this.venues=t.venues,this.types=t.types,this.organizations=t.organizations,this.onLoadEvent(this.event);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{onCancel:function(){this.$router.go(-1)},onDelete:function(){var e=o(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$bvModal.msgBoxConfirm("Are you sure you want to delete this event?  All associated data, including attendance records, will be permanently lost.",{title:"Delete Event",headerBgVariant:"danger",headerTextVariant:"white",okTitle:"Delete",okVariant:"danger",cancelTitle:"Keep"}).catch((function(e){}));case 2:if(t=e.sent,t){e.next=5;break}return e.abrupt("return");case 5:return n=new FormData,n.append("delete","true"),e.next=9,this.$axios.post("/api/events/".concat(this.$route.params.id),n);case 9:this.$router.push({path:"/events",params:{year:this.event.date.substr(0,4)}});case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onSubmit:function(){var e=o(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.submitted=!0,this.validate(),this.valid){e.next=4;break}return e.abrupt("return");case 4:return t=new FormData,t.append("name",this.event.name),t.append("type",this.event.type),t.append("organization",this.event.organization),t.append("date",this.event.date),t.append("start",this.event.start),t.append("end",this.event.end),t.append("private",this.event.private),t.append("venue",this.event.venue.id),"NEW"===this.event.venue.id&&(t.append("venueName",this.event.venue.name),t.append("venueAddress",this.event.venue.address),t.append("venueCity",this.event.venue.city),t.append("venueURL",this.event.venue.url)),t.append("details",this.event.details),this.event.canEditDSWFlags&&(t.append("renewsDSW",this.event.renewsDSW),t.append("coveredByDSW",this.event.coveredByDSW)),this.event.groups.forEach((function(e){t.append("group",e)})),e.next=19,this.$axios.post("/api/events/".concat(this.$route.params.id),t);case 19:n=e.sent.data,n&&n.nameError?this.duplicateName={date:this.event.date,name:this.event.name}:n&&this.$router.push("/events/".concat(n.id));case 21:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),validate:function(){this.submitted&&(this.event.name?this.duplicateName&&this.duplicateName.date===this.event.date&&this.duplicateName.name===this.event.name?this.nameError="Another event on this date has this name.":this.nameError=this.duplicateName=null:this.nameError="The event name is required.",this.event.type?this.typeError=null:this.typeError="The event type is required.",this.event.organization?this.organizationError=null:this.organizationError="The organization is required.",this.event.date?this.event.date.match(/^20\d\d-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/)?this.dateError=null:this.dateError="This is not a valid date.":this.dateError="The event date is required.",this.event.start&&this.event.end?this.event.start.match(/^(?:[01][0-9]|2[0-3]):[0-5][0-9]$/)?this.event.end.match(/^(?:[01][0-9]|2[0-3]):[0-5][0-9]$/)?this.event.end<this.event.start?this.timeError="The end time must come after the start time.":this.timeError=null:this.timeError="The end time is not valid.":this.timeError="The start time is not valid.":this.timeError="The event times are required.","NEW"===this.event.venue.id?(this.event.venue.name?this.venueNameError=null:this.venueNameError="The venue name is required.",this.event.venue.address?this.venueAddressError=null:this.venueAddressError="The venue address is required.",this.event.venue.city?this.venueCityError=null:this.venueCityError="The venue city is required.",this.event.venue.url&&!this.event.venue.url.startsWith("https://www.google.com/maps/")?this.venueURLError="The venue map URL must start with https://www.google.com/maps/.":this.venueURLError=null):this.venueNameError=this.venueAddressError=this.venueCityError=this.venueURLError=null,this.event.groups.length?this.groupsError=null:this.groupsError="At least one group must be selected.",this.valid=!this.nameError&&!this.dateError&&!this.timeError&&!this.venueNameError&&!this.venueAddressError&&!this.venueCityError&&!this.venueURLError&&!this.organizationError&&!this.typeError&&!this.groupsError)}}},u=v,d=(n("2581"),n("2877")),c=Object(d["a"])(u,a,r,!1,null,null,null);t["default"]=c.exports}}]);
//# sourceMappingURL=EventEdit.3e1541f6.js.map